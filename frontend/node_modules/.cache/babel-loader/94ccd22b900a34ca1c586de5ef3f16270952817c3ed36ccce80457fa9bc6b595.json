{"ast":null,"code":"var _s = $RefreshSig$();\n// frontend/src/lib/lookups.js\n// ดึง lookup เดียวจบ พร้อมแคชในหน่วยความจำ + ตัวช่วย hook\n\nimport axios from 'axios';\nimport { useEffect, useState, useCallback } from 'react'; // ✅ ย้ายมาไว้บนสุด\n\nconst ENV = typeof import.meta !== 'undefined' && import.meta.env || {};\nconst API_BASE = ENV.VITE_API_BASE || process.env.REACT_APP_API_BASE || 'http://localhost:3001';\nconst cache = {\n  all: null,\n  published: null,\n  ts_all: 0,\n  ts_pub: 0,\n  ttl_ms: 60000 // 1 นาที (เปลี่ยนได้)\n};\nexport async function fetchLookups({\n  published = false\n} = {}) {\n  const usePublished = !!published;\n  const now = Date.now();\n  const key = usePublished ? 'published' : 'all';\n  const tsKey = usePublished ? 'ts_pub' : 'ts_all';\n  if (cache[key] && now - cache[tsKey] < cache.ttl_ms) {\n    return cache[key];\n  }\n  const url = new URL('/api/lookups', API_BASE);\n  if (usePublished) url.searchParams.set('published', '1');\n  const res = await axios.get(url.toString(), {\n    withCredentials: true\n  }).catch(e => {\n    console.error('lookups fetch error:', e);\n    throw e;\n  });\n  const data = (res === null || res === void 0 ? void 0 : res.data) || {};\n  cache[key] = data;\n  cache[tsKey] = Date.now();\n  return data;\n}\n\n// React hook: ใช้ง่ายในหน้าแอดมิน\nexport function useLookups(options = {\n  published: false\n}) {\n  _s();\n  const [data, setData] = useState({\n    ok: false,\n    product_categories: [],\n    subcategories: [],\n    product_units: [],\n    size_units: [],\n    order_statuses: []\n  });\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  const load = useCallback(async () => {\n    setLoading(true);\n    setError('');\n    try {\n      const d = await fetchLookups(options);\n      setData(d);\n    } catch (e) {\n      setError('โหลดข้อมูล lookup ล้มเหลว');\n    } finally {\n      setLoading(false);\n    }\n  }, [options === null || options === void 0 ? void 0 : options.published]); // ✅ dependency ถูกต้อง\n\n  useEffect(() => {\n    load();\n  }, [load]);\n  return {\n    data,\n    loading,\n    error,\n    reload: load\n  };\n}\n_s(useLookups, \"4fs9wK4IRFHECyQlH6igEXOukEI=\");","map":{"version":3,"names":["axios","useEffect","useState","useCallback","ENV","import","meta","env","API_BASE","VITE_API_BASE","process","REACT_APP_API_BASE","cache","all","published","ts_all","ts_pub","ttl_ms","fetchLookups","usePublished","now","Date","key","tsKey","url","URL","searchParams","set","res","get","toString","withCredentials","catch","e","console","error","data","useLookups","options","_s","setData","ok","product_categories","subcategories","product_units","size_units","order_statuses","loading","setLoading","setError","load","d","reload"],"sources":["D:/project19/frontend/src/lib/lookups.js"],"sourcesContent":["// frontend/src/lib/lookups.js\r\n// ดึง lookup เดียวจบ พร้อมแคชในหน่วยความจำ + ตัวช่วย hook\r\n\r\nimport axios from 'axios';\r\nimport { useEffect, useState, useCallback } from 'react'; // ✅ ย้ายมาไว้บนสุด\r\n\r\nconst ENV = (typeof import.meta !== 'undefined' && import.meta.env) || {};\r\nconst API_BASE =\r\n  ENV.VITE_API_BASE ||\r\n  process.env.REACT_APP_API_BASE ||\r\n  'http://localhost:3001';\r\n\r\nconst cache = {\r\n  all: null,\r\n  published: null,\r\n  ts_all: 0,\r\n  ts_pub: 0,\r\n  ttl_ms: 60_000, // 1 นาที (เปลี่ยนได้)\r\n};\r\n\r\nexport async function fetchLookups({ published = false } = {}) {\r\n  const usePublished = !!published;\r\n  const now = Date.now();\r\n  const key = usePublished ? 'published' : 'all';\r\n  const tsKey = usePublished ? 'ts_pub' : 'ts_all';\r\n\r\n  if (cache[key] && now - cache[tsKey] < cache.ttl_ms) {\r\n    return cache[key];\r\n  }\r\n\r\n  const url = new URL('/api/lookups', API_BASE);\r\n  if (usePublished) url.searchParams.set('published', '1');\r\n\r\n  const res = await axios.get(url.toString(), { withCredentials: true }).catch((e) => {\r\n    console.error('lookups fetch error:', e);\r\n    throw e;\r\n  });\r\n\r\n  const data = res?.data || {};\r\n  cache[key] = data;\r\n  cache[tsKey] = Date.now();\r\n  return data;\r\n}\r\n\r\n// React hook: ใช้ง่ายในหน้าแอดมิน\r\nexport function useLookups(options = { published: false }) {\r\n  const [data, setData] = useState({\r\n    ok: false,\r\n    product_categories: [],\r\n    subcategories: [],\r\n    product_units: [],\r\n    size_units: [],\r\n    order_statuses: [],\r\n  });\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n\r\n  const load = useCallback(async () => {\r\n    setLoading(true);\r\n    setError('');\r\n    try {\r\n      const d = await fetchLookups(options);\r\n      setData(d);\r\n    } catch (e) {\r\n      setError('โหลดข้อมูล lookup ล้มเหลว');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [options?.published]); // ✅ dependency ถูกต้อง\r\n\r\n  useEffect(() => {\r\n    load();\r\n  }, [load]);\r\n\r\n  return { data, loading, error, reload: load };\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}