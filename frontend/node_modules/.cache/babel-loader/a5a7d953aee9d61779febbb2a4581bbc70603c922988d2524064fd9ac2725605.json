{"ast":null,"code":"var _jsxFileName = \"D:\\\\project19\\\\frontend\\\\src\\\\admin\\\\VariantsManager.js\",\n  _s = $RefreshSig$();\n// src/admin/VariantsManager.js\n// ======================================================================\n// VariantsManager (final) — แบบ \"พิมพ์แล้ว Enter\" + โหลด/แก้ไขข้อมูลเดิมครบ\n// - แสดงช่อง \"ชื่อตัวเลือก 1–3\" และช่องเพิ่มค่า (chips) ด้วย Enter ตลอดเวลา\n// - โหลด variants เดิมทั้งหมดจากหลาย endpoint และแปลงเป็นแถวแก้ไขได้\n// - เติม chips เริ่มต้นจากค่าที่มีอยู่จริงใน DB (unique ต่อคอลัมน์)\n// - เมื่อเพิ่ม chip ใหม่ → ระบบสร้างคอมโบที่ยังไม่มี โดย \"คงค่าที่แก้ไขไว้\" ของแถวเดิม\n// - ตาราง: รูปภาพ / ตัวเลือก1 / ตัวเลือก2 / ตัวเลือก3 / ราคา / SKU / ลบ\n// - บันทึกทั้งหมด: พยายามหลาย endpoint (upsert-batch → PUT/POST variants → generate)\n// - ลบ: เก็บรายการที่จะลบไว้ ส่ง delete-batch หากมี และกันเคส backend ไม่รองรับ (จะข้าม)\n// ======================================================================\n\nimport React, { useEffect, useMemo, useState, useCallback } from \"react\";\nimport { useParams, Link } from \"react-router-dom\";\nimport { api, path, mediaSrc } from \"../lib/api\";\nimport \"./VariantsManager.css\";\n\n/* ---------- Helpers ---------- */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst authHeader = () => {\n  const t = localStorage.getItem(\"token\");\n  return t ? {\n    Authorization: `Bearer ${t}`\n  } : {};\n};\nconst byKey = (a, b) => a < b ? -1 : a > b ? 1 : 0;\nconst uniq = arr => Array.from(new Set(arr.filter(x => x !== null && x !== undefined && String(x).trim() !== \"\"))).sort(byKey);\nconst pickStr = (...xs) => {\n  var _xs$find;\n  return ((_xs$find = xs.find(v => typeof v === \"string\" && v.trim())) === null || _xs$find === void 0 ? void 0 : _xs$find.trim()) || \"\";\n};\nconst rand2 = () => String(Math.floor(Math.random() * 99) + 1).padStart(2, \"0\");\nconst keyOf = r => [r.opt1 || \"\", r.opt2 || \"\", r.opt3 || \"\"].join(\"␟\"); // safe join\n\n/* ---------- Upload ---------- */\nconst extractUrl = data => {\n  var _data$file, _data$file2, _data$data, _data$data2, _data$data3;\n  if (!data) return null;\n  if (typeof data === \"string\") return data;\n  const direct = data.url || data.path || data.imageUrl || data.Location || data.location || ((_data$file = data.file) === null || _data$file === void 0 ? void 0 : _data$file.url) || ((_data$file2 = data.file) === null || _data$file2 === void 0 ? void 0 : _data$file2.path) || ((_data$data = data.data) === null || _data$data === void 0 ? void 0 : _data$data.url) || ((_data$data2 = data.data) === null || _data$data2 === void 0 ? void 0 : _data$data2.path) || ((_data$data3 = data.data) === null || _data$data3 === void 0 ? void 0 : _data$data3.imageUrl);\n  if (direct) return direct;\n  try {\n    const flat = JSON.stringify(data);\n    const m = flat.match(/\"([^\"]+\\.(?:png|jpe?g|webp|gif))\"/i);\n    return m ? m[1] : null;\n  } catch {\n    return null;\n  }\n};\nconst tryUpload = async file => {\n  const fd = new FormData();\n  fd.append(\"file\", file);\n  const res = await api.post(path(\"/upload\"), fd, {\n    headers: {\n      ...authHeader(),\n      \"Content-Type\": \"multipart/form-data\"\n    }\n  });\n  const url = extractUrl(res === null || res === void 0 ? void 0 : res.data);\n  if (!url) throw new Error(\"UPLOAD_OK_BUT_NO_URL\");\n  return url;\n};\n\n/* ---------- Normalize product ---------- */\nconst normalizeProduct = raw => {\n  if (!raw) return null;\n  const d = raw.data || raw.item || raw.product || raw.result || raw;\n  return d || null;\n};\n\n/* ---------- Option parse helpers ---------- */\nfunction parseFromOptionText(optionText) {\n  // ตัวอย่าง: \"สี:ชมพู | ขนาด:81 | วัสดุ:พลาสติก\"\n  const res = {\n    names: [\"\", \"\", \"\"],\n    values: [\"\", \"\", \"\"]\n  };\n  const s = String(optionText || \"\").trim();\n  if (!s) return res;\n  const parts = s.split(\"|\").map(x => x.trim()).filter(Boolean);\n  for (let i = 0; i < Math.min(3, parts.length); i++) {\n    const p = parts[i];\n    const j = p.indexOf(\":\");\n    if (j >= 0) {\n      res.names[i] = p.slice(0, j).trim();\n      res.values[i] = p.slice(j + 1).trim();\n    } else {\n      res.values[i] = p;\n    }\n  }\n  return res;\n}\nfunction firstNonEmpty(...xs) {\n  for (const x of xs) {\n    if (x !== undefined && x !== null) {\n      const s = String(x).trim();\n      if (s) return s;\n    }\n  }\n  return \"\";\n}\n\n/* ---------- Variant normalize ---------- */\nconst normVariant = v => {\n  var _ref, _ref2, _v$price, _ref3, _ref4, _v$variant_id;\n  if (!v) return null;\n  const price = (_ref = (_ref2 = (_v$price = v.price) !== null && _v$price !== void 0 ? _v$price : v.unit_price) !== null && _ref2 !== void 0 ? _ref2 : v.sale_price) !== null && _ref !== void 0 ? _ref : \"\";\n  const sku = firstNonEmpty(v.sku, v.SKU, v.code);\n  const image = firstNonEmpty(v.image_url, v.image, v.imageUrl, v.variant_image);\n\n  // details[] / options[]\n  const details = Array.isArray(v.details) ? v.details : Array.isArray(v.options) ? v.options : null;\n  let names = [\"ตัวเลือก 1\", \"ตัวเลือก 2\", \"ตัวเลือก 3\"];\n  let values = [\"\", \"\", \"\"];\n  if (details && details.length) {\n    for (let i = 0; i < 3; i++) {\n      if (!details[i]) break;\n      names[i] = firstNonEmpty(details[i].name, details[i].label, names[i]);\n      values[i] = firstNonEmpty(details[i].value, details[i].val, \"\");\n    }\n  } else {\n    names[0] = firstNonEmpty(v.opt1_name, v.option1_name, v.name1, v.option1, names[0]);\n    names[1] = firstNonEmpty(v.opt2_name, v.option2_name, v.name2, v.option2, names[1]);\n    names[2] = firstNonEmpty(v.opt3_name, v.option3_name, v.name3, v.option3, \"\");\n    values[0] = firstNonEmpty(v.option1_value, v.opt1, v.value1, v.color, \"\");\n    values[1] = firstNonEmpty(v.option2_value, v.opt2, v.value2, v.size, \"\");\n    values[2] = firstNonEmpty(v.option3_value, v.opt3, v.value3, v.material, \"\");\n    if (!values[0] && !values[1] && !values[2]) {\n      const parsed = parseFromOptionText(firstNonEmpty(v.option_text, v.options_text));\n      names = parsed.names.map((x, i) => firstNonEmpty(names[i], x));\n      values = parsed.values.map(x => firstNonEmpty(x));\n    }\n  }\n  return {\n    variant_id: (_ref3 = (_ref4 = (_v$variant_id = v.variant_id) !== null && _v$variant_id !== void 0 ? _v$variant_id : v.id) !== null && _ref4 !== void 0 ? _ref4 : v.product_variant_id) !== null && _ref3 !== void 0 ? _ref3 : null,\n    sku,\n    price: typeof price === \"number\" ? String(price) : String(price || \"\"),\n    image: image || null,\n    opt1_name: names[0] || \"ตัวเลือก 1\",\n    opt2_name: names[1] || \"ตัวเลือก 2\",\n    opt3_name: names[2] || \"\",\n    opt1: values[0] || \"\",\n    opt2: values[1] || \"\",\n    opt3: values[2] || \"\"\n  };\n};\n\n/* ====================================================================== */\nexport default function VariantsManager() {\n  _s();\n  const {\n    id,\n    productId: pid\n  } = useParams();\n  const productId = Number(id || pid);\n  const [product, setProduct] = useState(null);\n\n  // ชื่อหัวคอลัมน์\n  const [opt1Name, setOpt1Name] = useState(\"สี\");\n  const [opt2Name, setOpt2Name] = useState(\"ขนาด\");\n  const [opt3Name, setOpt3Name] = useState(\"\");\n\n  // chips (ค่าที่เพิ่มด้วย Enter)\n  const [opt1Values, setOpt1Values] = useState([]);\n  const [opt2Values, setOpt2Values] = useState([]);\n  const [opt3Values, setOpt3Values] = useState([]);\n\n  // แถวในตาราง\n  const [rows, setRows] = useState([]);\n  const [deletedIds, setDeletedIds] = useState([]);\n  const [saving, setSaving] = useState(false);\n  const [msg, setMsg] = useState(\"\");\n\n  /* ---------- Load product ---------- */\n  const loadProduct = useCallback(async () => {\n    if (!productId) return;\n    let p = null;\n    try {\n      const r = await api.get(path(`/admin/products/${productId}`));\n      p = normalizeProduct(r === null || r === void 0 ? void 0 : r.data);\n    } catch {}\n    if (!p) {\n      try {\n        const r = await api.get(path(`/products/${productId}`));\n        p = normalizeProduct(r === null || r === void 0 ? void 0 : r.data);\n      } catch {}\n    }\n    if (!p) {\n      try {\n        var _r$data;\n        const r = await api.get(path(`/admin/products`), {\n          params: {\n            include_archived: 1\n          }\n        });\n        const arr = Array.isArray(r === null || r === void 0 ? void 0 : (_r$data = r.data) === null || _r$data === void 0 ? void 0 : _r$data.items) ? r.data.items : Array.isArray(r === null || r === void 0 ? void 0 : r.data) ? r.data : [];\n        p = (arr || []).find(x => Number(x.product_id) === productId) || null;\n      } catch {}\n    }\n    setProduct(p || null);\n  }, [productId]);\n\n  /* ---------- Load variants ---------- */\n  const loadVariants = useCallback(async () => {\n    if (!productId) return;\n    let list = [];\n    const endpoints = [path(`/admin/products/${productId}/variants`), path(`/products/${productId}/variants`), path(`/api/variants/by-product/${productId}`), path(`/api/variants?product_id=${productId}`)];\n    for (const url of endpoints) {\n      try {\n        var _r$data2, _r$data3;\n        const r = await api.get(url, {\n          headers: authHeader()\n        });\n        const arr = (r === null || r === void 0 ? void 0 : (_r$data2 = r.data) === null || _r$data2 === void 0 ? void 0 : _r$data2.items) || (r === null || r === void 0 ? void 0 : (_r$data3 = r.data) === null || _r$data3 === void 0 ? void 0 : _r$data3.rows) || (r === null || r === void 0 ? void 0 : r.data) || [];\n        if (Array.isArray(arr) && arr.length) {\n          list = arr;\n          break;\n        }\n      } catch {}\n    }\n    if (list.length) {\n      const mapped = list.map(v => {\n        const n = normVariant(v);\n        return {\n          __existing: true,\n          variant_id: n.variant_id,\n          opt1: n.opt1,\n          opt2: n.opt2,\n          opt3: n.opt3,\n          price: n.price,\n          sku: n.sku,\n          image: n.image,\n          opt1_name: n.opt1_name,\n          opt2_name: n.opt2_name,\n          opt3_name: n.opt3_name\n        };\n      });\n      setRows(mapped);\n\n      // ตั้งชื่อหัวคอลัมน์จากของจริง\n      const first = mapped[0];\n      if (first) {\n        if (first.opt1_name) setOpt1Name(first.opt1_name);\n        if (first.opt2_name) setOpt2Name(first.opt2_name);\n        if (first.opt3_name) setOpt3Name(first.opt3_name);\n      }\n\n      // เติม chips เริ่มต้นจากค่าที่ DB มี (เพื่อแสดงในกล่อง chips)\n      setOpt1Values(uniq(mapped.map(r => r.opt1)));\n      setOpt2Values(uniq(mapped.map(r => r.opt2)));\n      setOpt3Values(uniq(mapped.map(r => r.opt3)));\n    } else {\n      // ไม่มี variant เดิม: เคลียร์แถวเพื่อให้ผู้ใช้ใส่ chips แล้วระบบค่อย generate\n      setRows([]);\n      setOpt1Values([]);\n      setOpt2Values([]);\n      setOpt3Values([]);\n    }\n    setDeletedIds([]);\n  }, [productId]);\n  useEffect(() => {\n    loadProduct();\n    loadVariants();\n  }, [loadProduct, loadVariants]);\n  const productName = useMemo(() => pickStr(product === null || product === void 0 ? void 0 : product.product_name, product === null || product === void 0 ? void 0 : product.name, product === null || product === void 0 ? void 0 : product.title), [product]);\n  const productCode = useMemo(() => pickStr(product === null || product === void 0 ? void 0 : product.product_code, product === null || product === void 0 ? void 0 : product.code, `P${productId}`), [product, productId]);\n\n  /* ---------- rebuild combos when chips changed (merge) ---------- */\n  const mergeGenerate = useCallback(() => {\n    // ชุดค่าที่ต้องมีหลังเพิ่ม chip\n    const v1 = opt1Values.length ? opt1Values : [\"\"];\n    const v2 = opt2Values.length ? opt2Values : [\"\"];\n    const v3 = opt3Values.length ? opt3Values : [\"\"];\n    const should = new Map(); // key -> {opt1,opt2,opt3}\n    for (const a of v1) for (const b of v2) for (const c of v3) {\n      should.set(keyOf({\n        opt1: a || \"\",\n        opt2: b || \"\",\n        opt3: c || \"\"\n      }), {\n        opt1: a || \"\",\n        opt2: b || \"\",\n        opt3: c || \"\"\n      });\n    }\n\n    // สร้าง map ของแถวปัจจุบัน\n    const cur = new Map();\n    for (const r of rows) cur.set(keyOf(r), r);\n    const next = [];\n    for (const [k, want] of should.entries()) {\n      if (cur.has(k)) {\n        // มีอยู่แล้ว → คงข้อมูลที่แก้ไว้\n        next.push({\n          ...cur.get(k)\n        });\n      } else {\n        // คอมโบใหม่ → แถวใหม่ว่าง ๆ\n        next.push({\n          __existing: false,\n          variant_id: null,\n          opt1: want.opt1,\n          opt2: want.opt2,\n          opt3: want.opt3,\n          price: \"\",\n          sku: \"\",\n          image: null,\n          opt1_name: opt1Name,\n          opt2_name: opt2Name,\n          opt3_name: opt3Name\n        });\n      }\n    }\n    setRows(next);\n  }, [rows, opt1Values, opt2Values, opt3Values, opt1Name, opt2Name, opt3Name]);\n\n  // เมื่อ chips เปลี่ยน ให้ merge สร้างคอมโบที่ยังขาด\n  useEffect(() => {\n    mergeGenerate();\n  }, [opt1Values, opt2Values, opt3Values]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  /* ---------- chips add/remove ---------- */\n  const addTag = (list, setList, txt) => {\n    const v = String(txt || \"\").trim();\n    if (!v) return;\n    if (!list.includes(v)) setList(uniq([...list, v]));\n  };\n  const removeTag = (list, setList, idx) => {\n    const v = list[idx];\n    const nextList = list.filter((_, i) => i !== idx);\n    setList(nextList);\n\n    // ลบแถวที่ใช้ค่านี้ออกด้วย (จะถือว่า delete ทั้งคอมโบ)\n    setRows(prev => prev.filter(r => r[`opt${setList === setOpt1Values ? 1 : setList === setOpt2Values ? 2 : 3}`] !== v));\n  };\n\n  /* ---------- per-row upload ---------- */\n  const onUploadRowImage = async (file, idx) => {\n    if (!file) return;\n    const tempUrl = URL.createObjectURL(file);\n    setRows(prev => {\n      const a = [...prev];\n      a[idx] = {\n        ...a[idx],\n        image: tempUrl,\n        __temp: true\n      };\n      return a;\n    });\n    try {\n      const serverUrl = await tryUpload(file);\n      setRows(prev => {\n        const a = [...prev];\n        a[idx] = {\n          ...a[idx],\n          image: serverUrl,\n          __temp: false\n        };\n        return a;\n      });\n    } catch (e) {\n      setRows(prev => {\n        const a = [...prev];\n        a[idx] = {\n          ...a[idx],\n          image: null,\n          __temp: false\n        };\n        return a;\n      });\n      alert((e === null || e === void 0 ? void 0 : e.message) || \"Upload failed\");\n    } finally {\n      setTimeout(() => URL.revokeObjectURL(tempUrl), 2500);\n    }\n  };\n\n  /* ---------- delete row ---------- */\n  const onDeleteRow = i => {\n    setRows(prev => {\n      const r = prev[i];\n      if (r !== null && r !== void 0 && r.variant_id) setDeletedIds(ids => uniq([...ids, r.variant_id]));\n      const a = [...prev];\n      a.splice(i, 1);\n      return a;\n    });\n  };\n\n  /* ---------- Auto SKU ---------- */\n  const autoSku = () => {\n    const base = productCode || `P${productId}`;\n    setRows(prev => prev.map(r => {\n      const parts = [base, r.opt1, r.opt2, r.opt3].filter(x => String(x || \"\").trim() !== \"\");\n      return {\n        ...r,\n        sku: parts.join(\"-\") + \"-\" + rand2()\n      };\n    }));\n  };\n\n  /* ---------- Save batch ---------- */\n  const saveAll = async () => {\n    setSaving(true);\n    try {\n      // ข้อมูลสำหรับ upsert\n      const payloadRows = rows.map(r => ({\n        variant_id: r.variant_id || null,\n        details: [r.opt1 ? {\n          name: opt1Name,\n          value: r.opt1\n        } : null, r.opt2 ? {\n          name: opt2Name,\n          value: r.opt2\n        } : null, r.opt3 && (opt3Name || r.opt3) ? {\n          name: opt3Name || \"ตัวเลือก 3\",\n          value: r.opt3\n        } : null].filter(Boolean),\n        sku: r.sku || null,\n        price: r.price !== \"\" ? Number(r.price) : null,\n        image_url: r.image || null\n      }));\n\n      // 0) ลบ batch ถ้ามี\n      if (deletedIds.length) {\n        try {\n          await api.post(path(`/api/variants/delete-batch`), {\n            variant_ids: deletedIds\n          }, {\n            headers: authHeader()\n          });\n        } catch {}\n        try {\n          await api.delete(path(`/admin/products/${productId}/variants`), {\n            data: {\n              variant_ids: deletedIds\n            },\n            headers: authHeader()\n          });\n        } catch {}\n      }\n      let done = false;\n\n      // 1) upsert-batch\n      try {\n        await api.post(path(`/api/variants/upsert-batch`), {\n          product_id: productId,\n          rows: payloadRows\n        }, {\n          headers: authHeader()\n        });\n        done = true;\n      } catch {}\n      if (!done) {\n        // 2) PUT /admin/products/:id/variants\n        try {\n          await api.put(path(`/admin/products/${productId}/variants`), {\n            rows: payloadRows\n          }, {\n            headers: authHeader()\n          });\n          done = true;\n        } catch {}\n      }\n      if (!done) {\n        // 3) POST /admin/products/:id/variants/save\n        try {\n          await api.post(path(`/admin/products/${productId}/variants/save`), {\n            rows: payloadRows\n          }, {\n            headers: authHeader()\n          });\n          done = true;\n        } catch {}\n      }\n      if (!done) {\n        // 4) generate\n        await api.post(path(`/admin/products/${productId}/variants/generate`), {\n          rows: payloadRows\n        }, {\n          headers: authHeader()\n        });\n      }\n      setMsg(\"✅ บันทึกแล้ว\");\n      setTimeout(() => setMsg(\"\"), 1800);\n      await loadVariants(); // reload ให้ตรง DB\n    } catch (e) {\n      var _e$response, _e$response$data;\n      console.error(e);\n      alert((e === null || e === void 0 ? void 0 : (_e$response = e.response) === null || _e$response === void 0 ? void 0 : (_e$response$data = _e$response.data) === null || _e$response$data === void 0 ? void 0 : _e$response$data.message) || \"❌ Save failed\");\n    } finally {\n      setSaving(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"vm-page\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"vm-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"vm-title\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"vm-product-name\",\n          children: productName || `#${productId}`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 419,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"vm-product-code\",\n          children: productCode\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 420,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 418,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Link, {\n        to: \"/admin/products\",\n        className: \"vm-back\",\n        children: \"\\u2190 \\u0E01\\u0E25\\u0E31\\u0E1A\\u0E44\\u0E1B\\u0E2B\\u0E19\\u0E49\\u0E32\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 422,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 417,\n      columnNumber: 7\n    }, this), msg && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"vm-msg\",\n      children: msg\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 425,\n      columnNumber: 15\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"vm-options\",\n      style: {\n        display: \"grid\",\n        gridTemplateColumns: \"1fr 1fr 1fr\",\n        gap: \"16px\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"vm-opt\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"\\u0E0A\\u0E37\\u0E48\\u0E2D\\u0E15\\u0E31\\u0E27\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01 1\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 431,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          value: opt1Name,\n          onChange: e => setOpt1Name(e.target.value),\n          placeholder: \"\\u0E2A\\u0E35\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 432,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"vm-chips\",\n          style: {\n            marginTop: 8\n          },\n          children: [opt1Values.map((v, i) => /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"vm-chip\",\n            children: [v, /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => removeTag(opt1Values, setOpt1Values, i),\n              children: \"\\xD7\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 437,\n              columnNumber: 17\n            }, this)]\n          }, i, true, {\n            fileName: _jsxFileName,\n            lineNumber: 435,\n            columnNumber: 15\n          }, this)), /*#__PURE__*/_jsxDEV(\"input\", {\n            placeholder: \"\\u0E40\\u0E0A\\u0E48\\u0E19 \\u0E40\\u0E02\\u0E35\\u0E22\\u0E27 \\u0E41\\u0E25\\u0E49\\u0E27 Enter\",\n            onKeyDown: e => {\n              if (e.key === \"Enter\") {\n                e.preventDefault();\n                addTag(opt1Values, setOpt1Values, e.currentTarget.value);\n                e.currentTarget.value = \"\";\n              }\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 440,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 433,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 430,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"vm-opt\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"\\u0E0A\\u0E37\\u0E48\\u0E2D\\u0E15\\u0E31\\u0E27\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01 2 (\\u0E16\\u0E49\\u0E32\\u0E21\\u0E35)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 455,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          value: opt2Name,\n          onChange: e => setOpt2Name(e.target.value),\n          placeholder: \"\\u0E02\\u0E19\\u0E32\\u0E14\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 456,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"vm-chips\",\n          style: {\n            marginTop: 8\n          },\n          children: [opt2Values.map((v, i) => /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"vm-chip\",\n            children: [v, /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => removeTag(opt2Values, setOpt2Values, i),\n              children: \"\\xD7\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 461,\n              columnNumber: 17\n            }, this)]\n          }, i, true, {\n            fileName: _jsxFileName,\n            lineNumber: 459,\n            columnNumber: 15\n          }, this)), /*#__PURE__*/_jsxDEV(\"input\", {\n            placeholder: \"\\u0E40\\u0E0A\\u0E48\\u0E19 M / 6 \\u0E19\\u0E34\\u0E49\\u0E27 \\u0E41\\u0E25\\u0E49\\u0E27 Enter\",\n            onKeyDown: e => {\n              if (e.key === \"Enter\") {\n                e.preventDefault();\n                addTag(opt2Values, setOpt2Values, e.currentTarget.value);\n                e.currentTarget.value = \"\";\n              }\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 464,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 457,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 454,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"vm-opt\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"\\u0E0A\\u0E37\\u0E48\\u0E2D\\u0E15\\u0E31\\u0E27\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01 3 (\\u0E16\\u0E49\\u0E32\\u0E21\\u0E35)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 479,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          value: opt3Name,\n          onChange: e => setOpt3Name(e.target.value),\n          placeholder: \"\\u0E40\\u0E0A\\u0E48\\u0E19 \\u0E27\\u0E31\\u0E2A\\u0E14\\u0E38\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 480,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"vm-chips\",\n          style: {\n            marginTop: 8\n          },\n          children: [opt3Values.map((v, i) => /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"vm-chip\",\n            children: [v, /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => removeTag(opt3Values, setOpt3Values, i),\n              children: \"\\xD7\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 485,\n              columnNumber: 17\n            }, this)]\n          }, i, true, {\n            fileName: _jsxFileName,\n            lineNumber: 483,\n            columnNumber: 15\n          }, this)), /*#__PURE__*/_jsxDEV(\"input\", {\n            placeholder: \"\\u0E40\\u0E0A\\u0E48\\u0E19 \\u0E40\\u0E0B\\u0E23\\u0E32\\u0E21\\u0E34\\u0E01 \\u0E41\\u0E25\\u0E49\\u0E27 Enter\",\n            onKeyDown: e => {\n              if (e.key === \"Enter\") {\n                e.preventDefault();\n                addTag(opt3Values, setOpt3Values, e.currentTarget.value);\n                e.currentTarget.value = \"\";\n              }\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 488,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 481,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 478,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 428,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"vm-table-wrap\",\n      children: /*#__PURE__*/_jsxDEV(\"table\", {\n        className: \"vm-table\",\n        children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n          children: /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: [/*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"\\u0E23\\u0E39\\u0E1B\\u0E20\\u0E32\\u0E1E\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 507,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: opt1Name || \"ตัวเลือก 1\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 508,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: opt2Name || \"ตัวเลือก 2\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 509,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: opt3Name || \"ตัวเลือก 3\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 510,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"\\u0E23\\u0E32\\u0E04\\u0E32\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 511,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"SKU\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 512,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"\\u0E25\\u0E1A\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 513,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 506,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 505,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n          children: [rows.map((r, i) => /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: [/*#__PURE__*/_jsxDEV(\"td\", {\n              children: r.image ? /*#__PURE__*/_jsxDEV(\"img\", {\n                src: mediaSrc(r.image),\n                alt: \"\",\n                className: \"vm-thumb\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 521,\n                columnNumber: 21\n              }, this) : /*#__PURE__*/_jsxDEV(\"label\", {\n                className: \"vm-upload\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  children: \"+\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 524,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"file\",\n                  accept: \"image/*\",\n                  onChange: e => {\n                    var _e$target$files;\n                    return onUploadRowImage((_e$target$files = e.target.files) === null || _e$target$files === void 0 ? void 0 : _e$target$files[0], i);\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 525,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 523,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 519,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: r.opt1 || \"-\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 529,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: r.opt2 || \"-\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 530,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: r.opt3 || \"-\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 531,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"number\",\n                min: \"0\",\n                placeholder: \"\\u0E44\\u0E21\\u0E48\\u0E23\\u0E30\\u0E1A\\u0E38\",\n                value: r.price,\n                onChange: e => {\n                  const v = e.target.value;\n                  setRows(prev => {\n                    const a = [...prev];\n                    a[i] = {\n                      ...a[i],\n                      price: v\n                    };\n                    return a;\n                  });\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 533,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 532,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: /*#__PURE__*/_jsxDEV(\"input\", {\n                placeholder: \"SKU\",\n                value: r.sku,\n                onChange: e => {\n                  const v = e.target.value;\n                  setRows(prev => {\n                    const a = [...prev];\n                    a[i] = {\n                      ...a[i],\n                      sku: v\n                    };\n                    return a;\n                  });\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 543,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 542,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"btn\",\n                onClick: () => onDeleteRow(i),\n                title: \"\\u0E25\\u0E1A\\u0E41\\u0E16\\u0E27\",\n                children: \"\\uD83D\\uDDD1\\uFE0F\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 553,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 552,\n              columnNumber: 17\n            }, this)]\n          }, i, true, {\n            fileName: _jsxFileName,\n            lineNumber: 518,\n            columnNumber: 15\n          }, this)), rows.length === 0 && /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: /*#__PURE__*/_jsxDEV(\"td\", {\n              colSpan: 7,\n              style: {\n                textAlign: \"center\",\n                padding: 16\n              },\n              children: \"\\u0E40\\u0E1E\\u0E34\\u0E48\\u0E21\\u0E04\\u0E48\\u0E32\\u0E43\\u0E19\\u0E01\\u0E25\\u0E48\\u0E2D\\u0E07\\u0E14\\u0E49\\u0E32\\u0E19\\u0E1A\\u0E19 (\\u0E1E\\u0E34\\u0E21\\u0E1E\\u0E4C\\u0E41\\u0E25\\u0E49\\u0E27\\u0E01\\u0E14 Enter) \\u0E40\\u0E1E\\u0E37\\u0E48\\u0E2D\\u0E2A\\u0E23\\u0E49\\u0E32\\u0E07\\u0E0A\\u0E38\\u0E14\\u0E15\\u0E31\\u0E27\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01 \\u0E41\\u0E25\\u0E49\\u0E27\\u0E01\\u0E14 \\u201C\\u0E1A\\u0E31\\u0E19\\u0E17\\u0E36\\u0E01\\u0E17\\u0E31\\u0E49\\u0E07\\u0E2B\\u0E21\\u0E14\\u201D\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 559,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 558,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 516,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 504,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 503,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"vm-actions\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        onClick: autoSku,\n        disabled: saving,\n        children: \"\\u2728 \\u0E40\\u0E15\\u0E34\\u0E21 SKU \\u0E2D\\u0E31\\u0E15\\u0E42\\u0E19\\u0E21\\u0E31\\u0E15\\u0E34\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 570,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn-primary\",\n        onClick: saveAll,\n        disabled: saving,\n        children: saving ? \"กำลังบันทึก…\" : \"บันทึกทั้งหมด\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 571,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 569,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"vm-hint\",\n      children: \"\\u0E40\\u0E21\\u0E37\\u0E48\\u0E2D\\u0E40\\u0E1E\\u0E34\\u0E48\\u0E21\\u0E40\\u0E2A\\u0E23\\u0E47\\u0E08 \\u0E43\\u0E2B\\u0E49\\u0E01\\u0E14\\u0E1B\\u0E38\\u0E48\\u0E21 \\u201C\\u0E1A\\u0E31\\u0E19\\u0E17\\u0E36\\u0E01\\u201D \\u0E14\\u0E49\\u0E32\\u0E19\\u0E1A\\u0E19 \\u0E40\\u0E1E\\u0E37\\u0E48\\u0E2D\\u0E1A\\u0E31\\u0E19\\u0E17\\u0E36\\u0E01\\u0E15\\u0E31\\u0E27\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\\u0E17\\u0E31\\u0E49\\u0E07\\u0E2B\\u0E21\\u0E14\\u0E1E\\u0E23\\u0E49\\u0E2D\\u0E21\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 577,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 415,\n    columnNumber: 5\n  }, this);\n}\n_s(VariantsManager, \"QDBbVp/wFvfIT4iXgCvlpfzTJxU=\", false, function () {\n  return [useParams];\n});\n_c = VariantsManager;\nvar _c;\n$RefreshReg$(_c, \"VariantsManager\");","map":{"version":3,"names":["React","useEffect","useMemo","useState","useCallback","useParams","Link","api","path","mediaSrc","jsxDEV","_jsxDEV","authHeader","t","localStorage","getItem","Authorization","byKey","a","b","uniq","arr","Array","from","Set","filter","x","undefined","String","trim","sort","pickStr","xs","_xs$find","find","v","rand2","Math","floor","random","padStart","keyOf","r","opt1","opt2","opt3","join","extractUrl","data","_data$file","_data$file2","_data$data","_data$data2","_data$data3","direct","url","imageUrl","Location","location","file","flat","JSON","stringify","m","match","tryUpload","fd","FormData","append","res","post","headers","Error","normalizeProduct","raw","d","item","product","result","parseFromOptionText","optionText","names","values","s","parts","split","map","Boolean","i","min","length","p","j","indexOf","slice","firstNonEmpty","normVariant","_ref","_ref2","_v$price","_ref3","_ref4","_v$variant_id","price","unit_price","sale_price","sku","SKU","code","image","image_url","variant_image","details","isArray","options","name","label","value","val","opt1_name","option1_name","name1","option1","opt2_name","option2_name","name2","option2","opt3_name","option3_name","name3","option3","option1_value","value1","color","option2_value","value2","size","option3_value","value3","material","parsed","option_text","options_text","variant_id","id","product_variant_id","VariantsManager","_s","productId","pid","Number","setProduct","opt1Name","setOpt1Name","opt2Name","setOpt2Name","opt3Name","setOpt3Name","opt1Values","setOpt1Values","opt2Values","setOpt2Values","opt3Values","setOpt3Values","rows","setRows","deletedIds","setDeletedIds","saving","setSaving","msg","setMsg","loadProduct","get","_r$data","params","include_archived","items","product_id","loadVariants","list","endpoints","_r$data2","_r$data3","mapped","n","__existing","first","productName","product_name","title","productCode","product_code","mergeGenerate","v1","v2","v3","should","Map","c","set","cur","next","k","want","entries","has","push","addTag","setList","txt","includes","removeTag","idx","nextList","_","prev","onUploadRowImage","tempUrl","URL","createObjectURL","__temp","serverUrl","e","alert","message","setTimeout","revokeObjectURL","onDeleteRow","ids","splice","autoSku","base","saveAll","payloadRows","variant_ids","delete","done","put","_e$response","_e$response$data","console","error","response","className","children","fileName","_jsxFileName","lineNumber","columnNumber","to","style","display","gridTemplateColumns","gap","onChange","target","placeholder","marginTop","onClick","onKeyDown","key","preventDefault","currentTarget","src","alt","type","accept","_e$target$files","files","colSpan","textAlign","padding","disabled","_c","$RefreshReg$"],"sources":["D:/project19/frontend/src/admin/VariantsManager.js"],"sourcesContent":["// src/admin/VariantsManager.js\r\n// ======================================================================\r\n// VariantsManager (final) — แบบ \"พิมพ์แล้ว Enter\" + โหลด/แก้ไขข้อมูลเดิมครบ\r\n// - แสดงช่อง \"ชื่อตัวเลือก 1–3\" และช่องเพิ่มค่า (chips) ด้วย Enter ตลอดเวลา\r\n// - โหลด variants เดิมทั้งหมดจากหลาย endpoint และแปลงเป็นแถวแก้ไขได้\r\n// - เติม chips เริ่มต้นจากค่าที่มีอยู่จริงใน DB (unique ต่อคอลัมน์)\r\n// - เมื่อเพิ่ม chip ใหม่ → ระบบสร้างคอมโบที่ยังไม่มี โดย \"คงค่าที่แก้ไขไว้\" ของแถวเดิม\r\n// - ตาราง: รูปภาพ / ตัวเลือก1 / ตัวเลือก2 / ตัวเลือก3 / ราคา / SKU / ลบ\r\n// - บันทึกทั้งหมด: พยายามหลาย endpoint (upsert-batch → PUT/POST variants → generate)\r\n// - ลบ: เก็บรายการที่จะลบไว้ ส่ง delete-batch หากมี และกันเคส backend ไม่รองรับ (จะข้าม)\r\n// ======================================================================\r\n\r\nimport React, { useEffect, useMemo, useState, useCallback } from \"react\";\r\nimport { useParams, Link } from \"react-router-dom\";\r\nimport { api, path, mediaSrc } from \"../lib/api\";\r\nimport \"./VariantsManager.css\";\r\n\r\n/* ---------- Helpers ---------- */\r\nconst authHeader = () => {\r\n  const t = localStorage.getItem(\"token\");\r\n  return t ? { Authorization: `Bearer ${t}` } : {};\r\n};\r\n\r\nconst byKey = (a, b) => (a < b ? -1 : a > b ? 1 : 0);\r\nconst uniq = (arr) => Array.from(new Set(arr.filter((x) => x !== null && x !== undefined && String(x).trim() !== \"\"))).sort(byKey);\r\nconst pickStr = (...xs) => xs.find((v) => typeof v === \"string\" && v.trim())?.trim() || \"\";\r\nconst rand2 = () => String(Math.floor(Math.random() * 99) + 1).padStart(2, \"0\");\r\nconst keyOf = (r) => [r.opt1 || \"\", r.opt2 || \"\", r.opt3 || \"\"].join(\"␟\"); // safe join\r\n\r\n/* ---------- Upload ---------- */\r\nconst extractUrl = (data) => {\r\n  if (!data) return null;\r\n  if (typeof data === \"string\") return data;\r\n  const direct =\r\n    data.url || data.path || data.imageUrl || data.Location || data.location ||\r\n    data.file?.url || data.file?.path || data.data?.url || data.data?.path || data.data?.imageUrl;\r\n  if (direct) return direct;\r\n  try {\r\n    const flat = JSON.stringify(data);\r\n    const m = flat.match(/\"([^\"]+\\.(?:png|jpe?g|webp|gif))\"/i);\r\n    return m ? m[1] : null;\r\n  } catch { return null; }\r\n};\r\n\r\nconst tryUpload = async (file) => {\r\n  const fd = new FormData();\r\n  fd.append(\"file\", file);\r\n  const res = await api.post(path(\"/upload\"), fd, {\r\n    headers: { ...authHeader(), \"Content-Type\": \"multipart/form-data\" },\r\n  });\r\n  const url = extractUrl(res?.data);\r\n  if (!url) throw new Error(\"UPLOAD_OK_BUT_NO_URL\");\r\n  return url;\r\n};\r\n\r\n/* ---------- Normalize product ---------- */\r\nconst normalizeProduct = (raw) => {\r\n  if (!raw) return null;\r\n  const d = raw.data || raw.item || raw.product || raw.result || raw;\r\n  return d || null;\r\n};\r\n\r\n/* ---------- Option parse helpers ---------- */\r\nfunction parseFromOptionText(optionText) {\r\n  // ตัวอย่าง: \"สี:ชมพู | ขนาด:81 | วัสดุ:พลาสติก\"\r\n  const res = { names: [\"\", \"\", \"\"], values: [\"\", \"\", \"\"] };\r\n  const s = String(optionText || \"\").trim();\r\n  if (!s) return res;\r\n  const parts = s.split(\"|\").map((x) => x.trim()).filter(Boolean);\r\n  for (let i = 0; i < Math.min(3, parts.length); i++) {\r\n    const p = parts[i];\r\n    const j = p.indexOf(\":\");\r\n    if (j >= 0) {\r\n      res.names[i] = p.slice(0, j).trim();\r\n      res.values[i] = p.slice(j + 1).trim();\r\n    } else {\r\n      res.values[i] = p;\r\n    }\r\n  }\r\n  return res;\r\n}\r\n\r\nfunction firstNonEmpty(...xs) {\r\n  for (const x of xs) {\r\n    if (x !== undefined && x !== null) {\r\n      const s = String(x).trim();\r\n      if (s) return s;\r\n    }\r\n  }\r\n  return \"\";\r\n}\r\n\r\n/* ---------- Variant normalize ---------- */\r\nconst normVariant = (v) => {\r\n  if (!v) return null;\r\n\r\n  const price = v.price ?? v.unit_price ?? v.sale_price ?? \"\";\r\n  const sku = firstNonEmpty(v.sku, v.SKU, v.code);\r\n  const image = firstNonEmpty(v.image_url, v.image, v.imageUrl, v.variant_image);\r\n\r\n  // details[] / options[]\r\n  const details = Array.isArray(v.details) ? v.details : (Array.isArray(v.options) ? v.options : null);\r\n\r\n  let names = [\"ตัวเลือก 1\", \"ตัวเลือก 2\", \"ตัวเลือก 3\"];\r\n  let values = [\"\", \"\", \"\"];\r\n\r\n  if (details && details.length) {\r\n    for (let i = 0; i < 3; i++) {\r\n      if (!details[i]) break;\r\n      names[i]  = firstNonEmpty(details[i].name, details[i].label, names[i]);\r\n      values[i] = firstNonEmpty(details[i].value, details[i].val, \"\");\r\n    }\r\n  } else {\r\n    names[0] = firstNonEmpty(v.opt1_name, v.option1_name, v.name1, v.option1, names[0]);\r\n    names[1] = firstNonEmpty(v.opt2_name, v.option2_name, v.name2, v.option2, names[1]);\r\n    names[2] = firstNonEmpty(v.opt3_name, v.option3_name, v.name3, v.option3, \"\");\r\n\r\n    values[0] = firstNonEmpty(v.option1_value, v.opt1, v.value1, v.color, \"\");\r\n    values[1] = firstNonEmpty(v.option2_value, v.opt2, v.value2, v.size, \"\");\r\n    values[2] = firstNonEmpty(v.option3_value, v.opt3, v.value3, v.material, \"\");\r\n\r\n    if (!values[0] && !values[1] && !values[2]) {\r\n      const parsed = parseFromOptionText(firstNonEmpty(v.option_text, v.options_text));\r\n      names = parsed.names.map((x, i) => firstNonEmpty(names[i], x));\r\n      values = parsed.values.map((x) => firstNonEmpty(x));\r\n    }\r\n  }\r\n\r\n  return {\r\n    variant_id: v.variant_id ?? v.id ?? v.product_variant_id ?? null,\r\n    sku,\r\n    price: typeof price === \"number\" ? String(price) : String(price || \"\"),\r\n    image: image || null,\r\n    opt1_name: names[0] || \"ตัวเลือก 1\",\r\n    opt2_name: names[1] || \"ตัวเลือก 2\",\r\n    opt3_name: names[2] || \"\",\r\n    opt1: values[0] || \"\",\r\n    opt2: values[1] || \"\",\r\n    opt3: values[2] || \"\",\r\n  };\r\n};\r\n\r\n/* ====================================================================== */\r\nexport default function VariantsManager() {\r\n  const { id, productId: pid } = useParams();\r\n  const productId = Number(id || pid);\r\n\r\n  const [product, setProduct] = useState(null);\r\n\r\n  // ชื่อหัวคอลัมน์\r\n  const [opt1Name, setOpt1Name] = useState(\"สี\");\r\n  const [opt2Name, setOpt2Name] = useState(\"ขนาด\");\r\n  const [opt3Name, setOpt3Name] = useState(\"\");\r\n\r\n  // chips (ค่าที่เพิ่มด้วย Enter)\r\n  const [opt1Values, setOpt1Values] = useState([]);\r\n  const [opt2Values, setOpt2Values] = useState([]);\r\n  const [opt3Values, setOpt3Values] = useState([]);\r\n\r\n  // แถวในตาราง\r\n  const [rows, setRows] = useState([]);\r\n  const [deletedIds, setDeletedIds] = useState([]);\r\n\r\n  const [saving, setSaving] = useState(false);\r\n  const [msg, setMsg] = useState(\"\");\r\n\r\n  /* ---------- Load product ---------- */\r\n  const loadProduct = useCallback(async () => {\r\n    if (!productId) return;\r\n    let p = null;\r\n    try {\r\n      const r = await api.get(path(`/admin/products/${productId}`));\r\n      p = normalizeProduct(r?.data);\r\n    } catch {}\r\n    if (!p) {\r\n      try {\r\n        const r = await api.get(path(`/products/${productId}`));\r\n        p = normalizeProduct(r?.data);\r\n      } catch {}\r\n    }\r\n    if (!p) {\r\n      try {\r\n        const r = await api.get(path(`/admin/products`), { params: { include_archived: 1 } });\r\n        const arr = Array.isArray(r?.data?.items) ? r.data.items : (Array.isArray(r?.data) ? r.data : []);\r\n        p = (arr || []).find((x) => Number(x.product_id) === productId) || null;\r\n      } catch {}\r\n    }\r\n    setProduct(p || null);\r\n  }, [productId]);\r\n\r\n  /* ---------- Load variants ---------- */\r\n  const loadVariants = useCallback(async () => {\r\n    if (!productId) return;\r\n    let list = [];\r\n\r\n    const endpoints = [\r\n      path(`/admin/products/${productId}/variants`),\r\n      path(`/products/${productId}/variants`),\r\n      path(`/api/variants/by-product/${productId}`),\r\n      path(`/api/variants?product_id=${productId}`),\r\n    ];\r\n\r\n    for (const url of endpoints) {\r\n      try {\r\n        const r = await api.get(url, { headers: authHeader() });\r\n        const arr = r?.data?.items || r?.data?.rows || r?.data || [];\r\n        if (Array.isArray(arr) && arr.length) { list = arr; break; }\r\n      } catch {}\r\n    }\r\n\r\n    if (list.length) {\r\n      const mapped = list.map((v) => {\r\n        const n = normVariant(v);\r\n        return {\r\n          __existing: true,\r\n          variant_id: n.variant_id,\r\n          opt1: n.opt1, opt2: n.opt2, opt3: n.opt3,\r\n          price: n.price, sku: n.sku, image: n.image,\r\n          opt1_name: n.opt1_name, opt2_name: n.opt2_name, opt3_name: n.opt3_name,\r\n        };\r\n      });\r\n\r\n      setRows(mapped);\r\n\r\n      // ตั้งชื่อหัวคอลัมน์จากของจริง\r\n      const first = mapped[0];\r\n      if (first) {\r\n        if (first.opt1_name) setOpt1Name(first.opt1_name);\r\n        if (first.opt2_name) setOpt2Name(first.opt2_name);\r\n        if (first.opt3_name) setOpt3Name(first.opt3_name);\r\n      }\r\n\r\n      // เติม chips เริ่มต้นจากค่าที่ DB มี (เพื่อแสดงในกล่อง chips)\r\n      setOpt1Values(uniq(mapped.map((r) => r.opt1)));\r\n      setOpt2Values(uniq(mapped.map((r) => r.opt2)));\r\n      setOpt3Values(uniq(mapped.map((r) => r.opt3)));\r\n    } else {\r\n      // ไม่มี variant เดิม: เคลียร์แถวเพื่อให้ผู้ใช้ใส่ chips แล้วระบบค่อย generate\r\n      setRows([]);\r\n      setOpt1Values([]); setOpt2Values([]); setOpt3Values([]);\r\n    }\r\n    setDeletedIds([]);\r\n  }, [productId]);\r\n\r\n  useEffect(() => { loadProduct(); loadVariants(); }, [loadProduct, loadVariants]);\r\n\r\n  const productName = useMemo(\r\n    () => pickStr(product?.product_name, product?.name, product?.title),\r\n    [product]\r\n  );\r\n  const productCode = useMemo(\r\n    () => pickStr(product?.product_code, product?.code, `P${productId}`),\r\n    [product, productId]\r\n  );\r\n\r\n  /* ---------- rebuild combos when chips changed (merge) ---------- */\r\n  const mergeGenerate = useCallback(() => {\r\n    // ชุดค่าที่ต้องมีหลังเพิ่ม chip\r\n    const v1 = opt1Values.length ? opt1Values : [\"\"];\r\n    const v2 = opt2Values.length ? opt2Values : [\"\"];\r\n    const v3 = opt3Values.length ? opt3Values : [\"\"];\r\n\r\n    const should = new Map(); // key -> {opt1,opt2,opt3}\r\n    for (const a of v1) for (const b of v2) for (const c of v3) {\r\n      should.set(keyOf({ opt1: a||\"\", opt2: b||\"\", opt3: c||\"\" }), { opt1: a||\"\", opt2: b||\"\", opt3: c||\"\" });\r\n    }\r\n\r\n    // สร้าง map ของแถวปัจจุบัน\r\n    const cur = new Map();\r\n    for (const r of rows) cur.set(keyOf(r), r);\r\n\r\n    const next = [];\r\n    for (const [k, want] of should.entries()) {\r\n      if (cur.has(k)) {\r\n        // มีอยู่แล้ว → คงข้อมูลที่แก้ไว้\r\n        next.push({ ...cur.get(k) });\r\n      } else {\r\n        // คอมโบใหม่ → แถวใหม่ว่าง ๆ\r\n        next.push({\r\n          __existing: false,\r\n          variant_id: null,\r\n          opt1: want.opt1, opt2: want.opt2, opt3: want.opt3,\r\n          price: \"\", sku: \"\", image: null,\r\n          opt1_name: opt1Name, opt2_name: opt2Name, opt3_name: opt3Name,\r\n        });\r\n      }\r\n    }\r\n    setRows(next);\r\n  }, [rows, opt1Values, opt2Values, opt3Values, opt1Name, opt2Name, opt3Name]);\r\n\r\n  // เมื่อ chips เปลี่ยน ให้ merge สร้างคอมโบที่ยังขาด\r\n  useEffect(() => { mergeGenerate(); }, [opt1Values, opt2Values, opt3Values]); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  /* ---------- chips add/remove ---------- */\r\n  const addTag = (list, setList, txt) => {\r\n    const v = String(txt || \"\").trim();\r\n    if (!v) return;\r\n    if (!list.includes(v)) setList(uniq([...list, v]));\r\n  };\r\n  const removeTag = (list, setList, idx) => {\r\n    const v = list[idx];\r\n    const nextList = list.filter((_, i) => i !== idx);\r\n    setList(nextList);\r\n\r\n    // ลบแถวที่ใช้ค่านี้ออกด้วย (จะถือว่า delete ทั้งคอมโบ)\r\n    setRows((prev) => prev.filter((r) => r[`opt${setList === setOpt1Values ? 1 : setList === setOpt2Values ? 2 : 3}`] !== v));\r\n  };\r\n\r\n  /* ---------- per-row upload ---------- */\r\n  const onUploadRowImage = async (file, idx) => {\r\n    if (!file) return;\r\n    const tempUrl = URL.createObjectURL(file);\r\n    setRows((prev) => { const a = [...prev]; a[idx] = { ...a[idx], image: tempUrl, __temp: true }; return a; });\r\n    try {\r\n      const serverUrl = await tryUpload(file);\r\n      setRows((prev) => { const a = [...prev]; a[idx] = { ...a[idx], image: serverUrl, __temp: false }; return a; });\r\n    } catch (e) {\r\n      setRows((prev) => { const a = [...prev]; a[idx] = { ...a[idx], image: null, __temp: false }; return a; });\r\n      alert(e?.message || \"Upload failed\");\r\n    } finally {\r\n      setTimeout(() => URL.revokeObjectURL(tempUrl), 2500);\r\n    }\r\n  };\r\n\r\n  /* ---------- delete row ---------- */\r\n  const onDeleteRow = (i) => {\r\n    setRows((prev) => {\r\n      const r = prev[i];\r\n      if (r?.variant_id) setDeletedIds((ids) => uniq([...ids, r.variant_id]));\r\n      const a = [...prev];\r\n      a.splice(i, 1);\r\n      return a;\r\n    });\r\n  };\r\n\r\n  /* ---------- Auto SKU ---------- */\r\n  const autoSku = () => {\r\n    const base = productCode || `P${productId}`;\r\n    setRows((prev) =>\r\n      prev.map((r) => {\r\n        const parts = [base, r.opt1, r.opt2, r.opt3].filter((x) => String(x || \"\").trim() !== \"\");\r\n        return { ...r, sku: parts.join(\"-\") + \"-\" + rand2() };\r\n      })\r\n    );\r\n  };\r\n\r\n  /* ---------- Save batch ---------- */\r\n  const saveAll = async () => {\r\n    setSaving(true);\r\n    try {\r\n      // ข้อมูลสำหรับ upsert\r\n      const payloadRows = rows.map((r) => ({\r\n        variant_id: r.variant_id || null,\r\n        details: [\r\n          r.opt1 ? { name: opt1Name, value: r.opt1 } : null,\r\n          r.opt2 ? { name: opt2Name, value: r.opt2 } : null,\r\n          r.opt3 && (opt3Name || r.opt3) ? { name: opt3Name || \"ตัวเลือก 3\", value: r.opt3 } : null,\r\n        ].filter(Boolean),\r\n        sku: r.sku || null,\r\n        price: r.price !== \"\" ? Number(r.price) : null,\r\n        image_url: r.image || null,\r\n      }));\r\n\r\n      // 0) ลบ batch ถ้ามี\r\n      if (deletedIds.length) {\r\n        try {\r\n          await api.post(path(`/api/variants/delete-batch`), { variant_ids: deletedIds }, { headers: authHeader() });\r\n        } catch {}\r\n        try {\r\n          await api.delete(path(`/admin/products/${productId}/variants`), { data: { variant_ids: deletedIds }, headers: authHeader() });\r\n        } catch {}\r\n      }\r\n\r\n      let done = false;\r\n\r\n      // 1) upsert-batch\r\n      try {\r\n        await api.post(path(`/api/variants/upsert-batch`), { product_id: productId, rows: payloadRows }, { headers: authHeader() });\r\n        done = true;\r\n      } catch {}\r\n\r\n      if (!done) {\r\n        // 2) PUT /admin/products/:id/variants\r\n        try {\r\n          await api.put(path(`/admin/products/${productId}/variants`), { rows: payloadRows }, { headers: authHeader() });\r\n          done = true;\r\n        } catch {}\r\n      }\r\n\r\n      if (!done) {\r\n        // 3) POST /admin/products/:id/variants/save\r\n        try {\r\n          await api.post(path(`/admin/products/${productId}/variants/save`), { rows: payloadRows }, { headers: authHeader() });\r\n          done = true;\r\n        } catch {}\r\n      }\r\n\r\n      if (!done) {\r\n        // 4) generate\r\n        await api.post(path(`/admin/products/${productId}/variants/generate`), { rows: payloadRows }, { headers: authHeader() });\r\n      }\r\n\r\n      setMsg(\"✅ บันทึกแล้ว\");\r\n      setTimeout(() => setMsg(\"\"), 1800);\r\n      await loadVariants(); // reload ให้ตรง DB\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert(e?.response?.data?.message || \"❌ Save failed\");\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"vm-page\">\r\n      {/* Header */}\r\n      <div className=\"vm-header\">\r\n        <div className=\"vm-title\">\r\n          <div className=\"vm-product-name\">{productName || `#${productId}`}</div>\r\n          <div className=\"vm-product-code\">{productCode}</div>\r\n        </div>\r\n        <Link to=\"/admin/products\" className=\"vm-back\">← กลับไปหน้าสินค้า</Link>\r\n      </div>\r\n\r\n      {msg && <div className=\"vm-msg\">{msg}</div>}\r\n\r\n      {/* Options (ชื่อตัวเลือก + chips แบบ Enter) */}\r\n      <div className=\"vm-options\" style={{display:\"grid\", gridTemplateColumns:\"1fr 1fr 1fr\", gap:\"16px\"}}>\r\n        {/* option 1 */}\r\n        <div className=\"vm-opt\">\r\n          <label>ชื่อตัวเลือก 1</label>\r\n          <input value={opt1Name} onChange={(e) => setOpt1Name(e.target.value)} placeholder=\"สี\" />\r\n          <div className=\"vm-chips\" style={{marginTop:8}}>\r\n            {opt1Values.map((v, i) => (\r\n              <span key={i} className=\"vm-chip\">\r\n                {v}\r\n                <button onClick={() => removeTag(opt1Values, setOpt1Values, i)}>×</button>\r\n              </span>\r\n            ))}\r\n            <input\r\n              placeholder=\"เช่น เขียว แล้ว Enter\"\r\n              onKeyDown={(e) => {\r\n                if (e.key === \"Enter\") {\r\n                  e.preventDefault();\r\n                  addTag(opt1Values, setOpt1Values, e.currentTarget.value);\r\n                  e.currentTarget.value = \"\";\r\n                }\r\n              }}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* option 2 */}\r\n        <div className=\"vm-opt\">\r\n          <label>ชื่อตัวเลือก 2 (ถ้ามี)</label>\r\n          <input value={opt2Name} onChange={(e) => setOpt2Name(e.target.value)} placeholder=\"ขนาด\" />\r\n          <div className=\"vm-chips\" style={{marginTop:8}}>\r\n            {opt2Values.map((v, i) => (\r\n              <span key={i} className=\"vm-chip\">\r\n                {v}\r\n                <button onClick={() => removeTag(opt2Values, setOpt2Values, i)}>×</button>\r\n              </span>\r\n            ))}\r\n            <input\r\n              placeholder=\"เช่น M / 6 นิ้ว แล้ว Enter\"\r\n              onKeyDown={(e) => {\r\n                if (e.key === \"Enter\") {\r\n                  e.preventDefault();\r\n                  addTag(opt2Values, setOpt2Values, e.currentTarget.value);\r\n                  e.currentTarget.value = \"\";\r\n                }\r\n              }}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* option 3 */}\r\n        <div className=\"vm-opt\">\r\n          <label>ชื่อตัวเลือก 3 (ถ้ามี)</label>\r\n          <input value={opt3Name} onChange={(e) => setOpt3Name(e.target.value)} placeholder=\"เช่น วัสดุ\" />\r\n          <div className=\"vm-chips\" style={{marginTop:8}}>\r\n            {opt3Values.map((v, i) => (\r\n              <span key={i} className=\"vm-chip\">\r\n                {v}\r\n                <button onClick={() => removeTag(opt3Values, setOpt3Values, i)}>×</button>\r\n              </span>\r\n            ))}\r\n            <input\r\n              placeholder=\"เช่น เซรามิก แล้ว Enter\"\r\n              onKeyDown={(e) => {\r\n                if (e.key === \"Enter\") {\r\n                  e.preventDefault();\r\n                  addTag(opt3Values, setOpt3Values, e.currentTarget.value);\r\n                  e.currentTarget.value = \"\";\r\n                }\r\n              }}\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Table */}\r\n      <div className=\"vm-table-wrap\">\r\n        <table className=\"vm-table\">\r\n          <thead>\r\n            <tr>\r\n              <th>รูปภาพ</th>\r\n              <th>{opt1Name || \"ตัวเลือก 1\"}</th>\r\n              <th>{opt2Name || \"ตัวเลือก 2\"}</th>\r\n              <th>{opt3Name || \"ตัวเลือก 3\"}</th>\r\n              <th>ราคา</th>\r\n              <th>SKU</th>\r\n              <th>ลบ</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {rows.map((r, i) => (\r\n              <tr key={i}>\r\n                <td>\r\n                  {r.image ? (\r\n                    <img src={mediaSrc(r.image)} alt=\"\" className=\"vm-thumb\" />\r\n                  ) : (\r\n                    <label className=\"vm-upload\">\r\n                      <span>+</span>\r\n                      <input type=\"file\" accept=\"image/*\" onChange={(e) => onUploadRowImage(e.target.files?.[0], i)} />\r\n                    </label>\r\n                  )}\r\n                </td>\r\n                <td>{r.opt1 || \"-\"}</td>\r\n                <td>{r.opt2 || \"-\"}</td>\r\n                <td>{r.opt3 || \"-\"}</td>\r\n                <td>\r\n                  <input\r\n                    type=\"number\" min=\"0\" placeholder=\"ไม่ระบุ\"\r\n                    value={r.price}\r\n                    onChange={(e) => {\r\n                      const v = e.target.value;\r\n                      setRows((prev) => { const a = [...prev]; a[i] = { ...a[i], price: v }; return a; });\r\n                    }}\r\n                  />\r\n                </td>\r\n                <td>\r\n                  <input\r\n                    placeholder=\"SKU\"\r\n                    value={r.sku}\r\n                    onChange={(e) => {\r\n                      const v = e.target.value;\r\n                      setRows((prev) => { const a = [...prev]; a[i] = { ...a[i], sku: v }; return a; });\r\n                    }}\r\n                  />\r\n                </td>\r\n                <td>\r\n                  <button className=\"btn\" onClick={() => onDeleteRow(i)} title=\"ลบแถว\">🗑️</button>\r\n                </td>\r\n              </tr>\r\n            ))}\r\n            {rows.length === 0 && (\r\n              <tr>\r\n                <td colSpan={7} style={{ textAlign: \"center\", padding: 16 }}>\r\n                  เพิ่มค่าในกล่องด้านบน (พิมพ์แล้วกด Enter) เพื่อสร้างชุดตัวเลือก แล้วกด “บันทึกทั้งหมด”\r\n                </td>\r\n              </tr>\r\n            )}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n\r\n      {/* Actions */}\r\n      <div className=\"vm-actions\">\r\n        <button className=\"btn\" onClick={autoSku} disabled={saving}>✨ เติม SKU อัตโนมัติ</button>\r\n        <button className=\"btn-primary\" onClick={saveAll} disabled={saving}>\r\n          {saving ? \"กำลังบันทึก…\" : \"บันทึกทั้งหมด\"}\r\n        </button>\r\n      </div>\r\n\r\n      {/* Hints */}\r\n      <div className=\"vm-hint\">\r\n        เมื่อเพิ่มเสร็จ ให้กดปุ่ม “บันทึก” ด้านบน เพื่อบันทึกตัวเลือกทั้งหมดพร้อมสินค้า\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}