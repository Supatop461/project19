{"ast":null,"code":"// src/lib/api.js\n// รวมศูนย์การเรียก API ฝั่ง frontend ให้สะอาด/ปลอดภัย/ยืดหยุ่น\n\nimport axios from 'axios';\n\n/* -----------------------------------------------------------\r\n * 1) หา baseURL ให้ทำงานได้ทั้ง Vite และ CRA\r\n *    ถ้าไม่ตั้ง env → ใช้ http://localhost:3001/api\r\n * --------------------------------------------------------- */\nconst VITE = typeof import.meta !== 'undefined' && import.meta.env || {};\nconst BASE_URL = VITE.VITE_API_BASE || process.env.REACT_APP_API_BASE || 'http://localhost:3001/api';\n\n/* -----------------------------------------------------------\r\n * 2) helper: ทำพาธให้ปลอดภัยกับ baseURL เสมอ\r\n *    - ถ้า baseURL ลงท้ายด้วย /api → ตัด /api นำหน้าออกจากพาธ\r\n *    - ถ้า baseURL ไม่ลงท้ายด้วย /api → เติม /api ให้อัตโนมัติ\r\n *    ป้องกันเคส /api ซ้อน / ไม่ตรงกัน ทำให้ 404\r\n * --------------------------------------------------------- */\nexport const path = p => {\n  const base = String((BASE_URL || '').replace(/\\/+$/, ''));\n  const endsWithApi = base.endsWith('/api');\n  let s = '/' + String(p || '').replace(/^\\/+/, '');\n  s = s.replace(/\\/+/g, '/'); // normalize slash\n  return endsWithApi ? s.replace(/^\\/api\\//, '/') : s.startsWith('/api/') ? s : '/api' + s;\n};\n\n/* -----------------------------------------------------------\r\n * 3) axios instance กลาง\r\n * --------------------------------------------------------- */\nexport const api = axios.create({\n  baseURL: BASE_URL\n  // withCredentials: true, // ถ้าใช้ cookie auth ให้เปิดบรรทัดนี้\n});\n\n/* -----------------------------------------------------------\r\n * 4) Interceptors\r\n *    - แนบ Bearer token อัตโนมัติ\r\n *    - log 404 ช่วยดีบัก (อย่า alert ตรง ๆ)\r\n * --------------------------------------------------------- */\napi.interceptors.request.use(config => {\n  const token = localStorage.getItem('token');\n  if (token) config.headers.Authorization = `Bearer ${token}`;\n  return config;\n});\napi.interceptors.response.use(r => r, err => {\n  var _err$response;\n  const s = err === null || err === void 0 ? void 0 : (_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.status;\n  if (s === 404) {\n    var _err$config, _err$config$method, _err$config2, _err$response2;\n    // เห็นชัด ๆ ว่าพาธไหนพัง จะได้แก้ถูกจุด\n    console.warn('[API 404]', (_err$config = err.config) === null || _err$config === void 0 ? void 0 : (_err$config$method = _err$config.method) === null || _err$config$method === void 0 ? void 0 : _err$config$method.toUpperCase(), (_err$config2 = err.config) === null || _err$config2 === void 0 ? void 0 : _err$config2.url, (_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : _err$response2.data);\n  }\n  return Promise.reject(err); // ให้ caller จัดการเอง (เช่น toast)\n});\n\n/* -----------------------------------------------------------\r\n * 5) Auth APIs (แนะนำให้ใช้ในหน้า Login/Header)\r\n * --------------------------------------------------------- */\nexport const login = (email_or_username, password) => api.post(path('/auth/login'), {\n  email_or_username,\n  password\n}).then(r => r.data);\nexport const me = () => api.get(path('/auth/me')).then(r => r.data);\n\n/* -----------------------------------------------------------\r\n * 6) Admin: Products (เพิ่ม list + รองรับ pagination)\r\n * --------------------------------------------------------- */\nexport const listAdminProducts = (params = {}) => api.get(path('/admin/products'), {\n  params\n}).then(r => r.data);\n\n/* -----------------------------------------------------------\r\n * 7) Admin: Options / Values / Variants\r\n *    (เดิมของคุณ — เปลี่ยนให้เรียกผ่าน path() กันพลาด /api ซ้อน)\r\n * --------------------------------------------------------- */\n\n// โหลด meta ทั้งชุด: product + options(+values) + variants(+combos)\nexport const getProductMeta = productId => api.get(path(`/admin/products/${productId}/variants`)).then(r => r.data);\n\n// สร้าง option ใหม่ (เช่น “สี”, “ขนาด”)\nexport const addOption = (productId, option_name) => api.post(path(`/admin/products/${productId}/options`), {\n  option_name\n}).then(r => r.data);\n\n// เปลี่ยนชื่อ option ภายหลัง\nexport const renameOption = (productId, optionId, option_name) => api.put(path(`/admin/products/${productId}/options/${optionId}`), {\n  option_name\n}).then(r => r.data);\n\n// เพิ่ม value ให้ option (เช่น “แดง”, “XL”)\nexport const addValue = (option_id, value_name) => api.post(path(`/admin/options/${option_id}/values`), {\n  value_name\n}).then(r => r.data);\n\n// เปลี่ยนชื่อ value ภายหลัง\nexport const renameValue = (valueId, value_name) => api.put(path(`/admin/values/${valueId}`), {\n  value_name\n}).then(r => r.data);\n\n// สร้าง/อัปเดต variant (รวม combo ของ option-values)\nexport const createVariant = (productId, payload) => api.post(path(`/admin/products/${productId}/variants`), payload).then(r => r.data);\n\n// (ทางเลือก) สร้าง variants ครบทุกคอมโบอัตโนมัติ\nexport const generateVariants = (productId, body) => api.post(path(`/admin/products/${productId}/variants/generate`), body).then(r => r.data);\n\n// อัปเดตค่าเฉพาะของ variant (เช่น price_override, stock, sku)\nexport const updateVariant = (variantId, patch) => api.put(path(`/admin/variants/${variantId}`), patch).then(r => r.data);\n\n// ลบ variant\nexport const deleteVariant = variantId => api.delete(path(`/admin/variants/${variantId}`)).then(r => r.data);\n\n// ลบทั้ง option (รวม mapping/values ที่เกี่ยวข้อง)\nexport const deleteOption = option_id => api.delete(path(`/admin/options/${option_id}`)).then(r => r.data);\n\n// ลบ value (ถ้ายังผูกกับ variant อยู่ backend จะกันไว้)\nexport const deleteValue = value_id => api.delete(path(`/admin/values/${value_id}`)).then(r => r.data);","map":{"version":3,"names":["axios","VITE","import","meta","env","BASE_URL","VITE_API_BASE","process","REACT_APP_API_BASE","path","p","base","String","replace","endsWithApi","endsWith","s","startsWith","api","create","baseURL","interceptors","request","use","config","token","localStorage","getItem","headers","Authorization","response","r","err","_err$response","status","_err$config","_err$config$method","_err$config2","_err$response2","console","warn","method","toUpperCase","url","data","Promise","reject","login","email_or_username","password","post","then","me","get","listAdminProducts","params","getProductMeta","productId","addOption","option_name","renameOption","optionId","put","addValue","option_id","value_name","renameValue","valueId","createVariant","payload","generateVariants","body","updateVariant","variantId","patch","deleteVariant","delete","deleteOption","deleteValue","value_id"],"sources":["D:/project19/frontend/src/lib/api.js"],"sourcesContent":["// src/lib/api.js\r\n// รวมศูนย์การเรียก API ฝั่ง frontend ให้สะอาด/ปลอดภัย/ยืดหยุ่น\r\n\r\nimport axios from 'axios';\r\n\r\n/* -----------------------------------------------------------\r\n * 1) หา baseURL ให้ทำงานได้ทั้ง Vite และ CRA\r\n *    ถ้าไม่ตั้ง env → ใช้ http://localhost:3001/api\r\n * --------------------------------------------------------- */\r\nconst VITE = (typeof import.meta !== 'undefined' && import.meta.env) || {};\r\nconst BASE_URL =\r\n  VITE.VITE_API_BASE ||\r\n  process.env.REACT_APP_API_BASE ||\r\n  'http://localhost:3001/api';\r\n\r\n/* -----------------------------------------------------------\r\n * 2) helper: ทำพาธให้ปลอดภัยกับ baseURL เสมอ\r\n *    - ถ้า baseURL ลงท้ายด้วย /api → ตัด /api นำหน้าออกจากพาธ\r\n *    - ถ้า baseURL ไม่ลงท้ายด้วย /api → เติม /api ให้อัตโนมัติ\r\n *    ป้องกันเคส /api ซ้อน / ไม่ตรงกัน ทำให้ 404\r\n * --------------------------------------------------------- */\r\nexport const path = (p) => {\r\n  const base = String((BASE_URL || '').replace(/\\/+$/, ''));\r\n  const endsWithApi = base.endsWith('/api');\r\n  let s = '/' + String(p || '').replace(/^\\/+/, '');\r\n  s = s.replace(/\\/+/g, '/'); // normalize slash\r\n  return endsWithApi ? s.replace(/^\\/api\\//, '/') : (s.startsWith('/api/') ? s : '/api' + s);\r\n};\r\n\r\n/* -----------------------------------------------------------\r\n * 3) axios instance กลาง\r\n * --------------------------------------------------------- */\r\nexport const api = axios.create({\r\n  baseURL: BASE_URL,\r\n  // withCredentials: true, // ถ้าใช้ cookie auth ให้เปิดบรรทัดนี้\r\n});\r\n\r\n/* -----------------------------------------------------------\r\n * 4) Interceptors\r\n *    - แนบ Bearer token อัตโนมัติ\r\n *    - log 404 ช่วยดีบัก (อย่า alert ตรง ๆ)\r\n * --------------------------------------------------------- */\r\napi.interceptors.request.use((config) => {\r\n  const token = localStorage.getItem('token');\r\n  if (token) config.headers.Authorization = `Bearer ${token}`;\r\n  return config;\r\n});\r\n\r\napi.interceptors.response.use(\r\n  (r) => r,\r\n  (err) => {\r\n    const s = err?.response?.status;\r\n    if (s === 404) {\r\n      // เห็นชัด ๆ ว่าพาธไหนพัง จะได้แก้ถูกจุด\r\n      console.warn('[API 404]', err.config?.method?.toUpperCase(), err.config?.url, err.response?.data);\r\n    }\r\n    return Promise.reject(err); // ให้ caller จัดการเอง (เช่น toast)\r\n  }\r\n);\r\n\r\n/* -----------------------------------------------------------\r\n * 5) Auth APIs (แนะนำให้ใช้ในหน้า Login/Header)\r\n * --------------------------------------------------------- */\r\nexport const login = (email_or_username, password) =>\r\n  api.post(path('/auth/login'), { email_or_username, password }).then((r) => r.data);\r\n\r\nexport const me = () =>\r\n  api.get(path('/auth/me')).then((r) => r.data);\r\n\r\n/* -----------------------------------------------------------\r\n * 6) Admin: Products (เพิ่ม list + รองรับ pagination)\r\n * --------------------------------------------------------- */\r\nexport const listAdminProducts = (params = {}) =>\r\n  api.get(path('/admin/products'), { params }).then((r) => r.data);\r\n\r\n/* -----------------------------------------------------------\r\n * 7) Admin: Options / Values / Variants\r\n *    (เดิมของคุณ — เปลี่ยนให้เรียกผ่าน path() กันพลาด /api ซ้อน)\r\n * --------------------------------------------------------- */\r\n\r\n// โหลด meta ทั้งชุด: product + options(+values) + variants(+combos)\r\nexport const getProductMeta = (productId) =>\r\n  api.get(path(`/admin/products/${productId}/variants`)).then((r) => r.data);\r\n\r\n// สร้าง option ใหม่ (เช่น “สี”, “ขนาด”)\r\nexport const addOption = (productId, option_name) =>\r\n  api.post(path(`/admin/products/${productId}/options`), { option_name }).then((r) => r.data);\r\n\r\n// เปลี่ยนชื่อ option ภายหลัง\r\nexport const renameOption = (productId, optionId, option_name) =>\r\n  api.put(path(`/admin/products/${productId}/options/${optionId}`), { option_name }).then((r) => r.data);\r\n\r\n// เพิ่ม value ให้ option (เช่น “แดง”, “XL”)\r\nexport const addValue = (option_id, value_name) =>\r\n  api.post(path(`/admin/options/${option_id}/values`), { value_name }).then((r) => r.data);\r\n\r\n// เปลี่ยนชื่อ value ภายหลัง\r\nexport const renameValue = (valueId, value_name) =>\r\n  api.put(path(`/admin/values/${valueId}`), { value_name }).then((r) => r.data);\r\n\r\n// สร้าง/อัปเดต variant (รวม combo ของ option-values)\r\nexport const createVariant = (productId, payload) =>\r\n  api.post(path(`/admin/products/${productId}/variants`), payload).then((r) => r.data);\r\n\r\n// (ทางเลือก) สร้าง variants ครบทุกคอมโบอัตโนมัติ\r\nexport const generateVariants = (productId, body) =>\r\n  api.post(path(`/admin/products/${productId}/variants/generate`), body).then((r) => r.data);\r\n\r\n// อัปเดตค่าเฉพาะของ variant (เช่น price_override, stock, sku)\r\nexport const updateVariant = (variantId, patch) =>\r\n  api.put(path(`/admin/variants/${variantId}`), patch).then((r) => r.data);\r\n\r\n// ลบ variant\r\nexport const deleteVariant = (variantId) =>\r\n  api.delete(path(`/admin/variants/${variantId}`)).then((r) => r.data);\r\n\r\n// ลบทั้ง option (รวม mapping/values ที่เกี่ยวข้อง)\r\nexport const deleteOption = (option_id) =>\r\n  api.delete(path(`/admin/options/${option_id}`)).then((r) => r.data);\r\n\r\n// ลบ value (ถ้ายังผูกกับ variant อยู่ backend จะกันไว้)\r\nexport const deleteValue = (value_id) =>\r\n  api.delete(path(`/admin/values/${value_id}`)).then((r) => r.data);\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}