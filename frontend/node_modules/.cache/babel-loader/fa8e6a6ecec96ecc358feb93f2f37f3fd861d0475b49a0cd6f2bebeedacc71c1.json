{"ast":null,"code":"// backend/server.js\n// ðŸŒ¿ Project19 Backend â€” Hardened server (safe requires + stable mounts)\n\nrequire('dotenv').config();\nconst express = require('express');\nconst cors = require('cors');\nconst path = require('path');\nconst fs = require('fs');\nconst helmet = require('helmet');\nconst compression = require('compression');\nconst morgan = require('morgan');\nconst rateLimit = require('express-rate-limit');\nconst app = express();\napp.disable('x-powered-by');\napp.set('trust proxy', 1);\napp.set('etag', false); // à¸›à¸´à¸” ETag à¸à¸±à¸™ 304\n\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nfunction tryRequire(p) {\n  try {\n    return require(p);\n  } catch (e) {\n    console.warn('â›” SKIP require:', p, '-', e.code || e.message);\n    return null;\n  }\n}\nfunction mount(name, paths, router, ...guards) {\n  if (!router) return;\n  const arr = Array.isArray(paths) ? paths : [paths];\n  app.use(arr, ...guards.filter(Boolean), router);\n  console.log(`â–¶ ${name} router LOADED ->`, arr.join(', '));\n}\n\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ auth (safe default) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nlet requireAuth = (_req, _res, next) => next();\nlet requireRole = () => (_req, _res, next) => next();\n{\n  const m = tryRequire('./middleware/auth');\n  if (m) {\n    requireAuth = m.requireAuth || requireAuth;\n    requireRole = m.requireRole || requireRole;\n  }\n}\n\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ security & perf â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\napp.use(helmet({\n  crossOriginResourcePolicy: {\n    policy: 'cross-origin'\n  }\n}));\napp.use(compression());\napp.use(morgan(process.env.NODE_ENV === 'production' ? 'combined' : 'dev'));\n\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CORS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nconst rawOrigins = process.env.FRONTEND_ORIGIN || 'http://localhost:5173,http://localhost:3000,http://127.0.0.1:5173,http://127.0.0.1:3000,http://127.0.0.1:5500';\nconst allowlist = rawOrigins.split(',').map(s => s.trim()).filter(Boolean);\nconst corsOptions = {\n  origin: (origin, cb) => {\n    if (!origin) return cb(null, true);\n    if (allowlist.includes('*') || allowlist.includes(origin)) return cb(null, true);\n    const err = new Error(`Not allowed by CORS: ${origin}`);\n    err.status = 403;\n    return cb(err, false);\n  },\n  credentials: true,\n  allowedHeaders: ['Content-Type', 'Authorization']\n};\napp.use(cors(corsOptions));\napp.options('*', cors(corsOptions));\n\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ body parser â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\napp.use(express.json({\n  limit: '10mb'\n}));\napp.use(express.urlencoded({\n  extended: true,\n  limit: '10mb'\n}));\n\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ API cache headers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\napp.use((req, res, next) => {\n  if (req.originalUrl.startsWith('/api/')) {\n    var _res$removeHeader, _res$removeHeader2;\n    res.set('Cache-Control', 'no-store, no-cache, must-revalidate, proxy-revalidate');\n    res.set('Pragma', 'no-cache');\n    res.set('Expires', '0');\n    (_res$removeHeader = res.removeHeader) === null || _res$removeHeader === void 0 ? void 0 : _res$removeHeader.call(res, 'ETag');\n    (_res$removeHeader2 = res.removeHeader) === null || _res$removeHeader2 === void 0 ? void 0 : _res$removeHeader2.call(res, 'Last-Modified');\n  }\n  next();\n});\n\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ request debug â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\napp.use((req, _res, next) => {\n  console.log('>>>', req.method, req.originalUrl);\n  next();\n});\n\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ health/root â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\napp.get('/', (_req, res) => res.send('ðŸŒ± Plant Shop API is running...'));\napp.get('/_health', (_req, res) => res.json({\n  ok: true,\n  at: 'server.js',\n  ts: Date.now()\n}));\n\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ static uploads â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nconst uploadsDir = path.join(__dirname, 'uploads');\nif (!fs.existsSync(uploadsDir)) fs.mkdirSync(uploadsDir, {\n  recursive: true\n});\n\n// ðŸ”¹ à¹€à¸ªà¸´à¸£à¹Œà¸Ÿà¸—à¸±à¹‰à¸‡à¸ªà¸­à¸‡à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡: /uploads à¹à¸¥à¸° /api/uploads\napp.use('/uploads', express.static(uploadsDir, {\n  maxAge: '1h'\n}));\napp.use('/api/uploads', express.static(uploadsDir, {\n  maxAge: '1h'\n}));\n\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ rate limit (login) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\napp.use('/api/auth/login', rateLimit({\n  windowMs: 15 * 60 * 1000,\n  max: 100,\n  standardHeaders: true,\n  legacyHeaders: false\n}));\n\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ require routers (safe) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nconst productStatusRoutes = tryRequire('./routes/productStatus');\nconst adminProductRoutes = tryRequire('./routes/adminProducts');\nconst adminVariantsRoutes = tryRequire('./routes/adminVariants');\nconst uploadsRoutes = tryRequire('./routes/uploads');\nconst categoryRoutes = tryRequire('./routes/categories');\nconst orderRoutes = tryRequire('./routes/orders');\nconst authRoutes = tryRequire('./routes/auth');\nconst addressesRoutes = tryRequire('./routes/addresses');\nconst variantRoutes = tryRequire('./routes/variants');\nconst publicProductsRoutes = tryRequire('./routes/publicProducts');\nconst inventoryRoutes = tryRequire('./routes/inventory');\nconst productImagesRoutes = tryRequire('./routes/productImages');\nconst adminSubcatRoutes = tryRequire('./routes/adminSubcategories');\nconst subcategoryRoutes = tryRequire('./routes/subcategories');\nconst lookupsRouter = tryRequire('./routes/lookups');\nconst dashboardRoutes = tryRequire('./routes/dashboard');\nconst cartRoutes = tryRequire('./routes/cart');\nconst analyticsRoutes = tryRequire('./routes/analytics');\nconst adminUnitsRouter = tryRequire('./routes/adminUnits');\nconst publicUnitsRouter = tryRequire('./routes/publicUnits');\nconst sizeUnitsRouter = tryRequire('./routes/sizeUnits');\nconst adminSizeUnitsRouter = tryRequire('./routes/adminSizeUnits');\nconst meRoutes = tryRequire('./routes/me');\nconst adminUsersRouter = tryRequire('./routes/adminUsers');\n\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ public mounts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nmount('auth', ['/api/auth', '/auth'], authRoutes);\nmount('me', '/api/me', meRoutes);\nmount('categories', ['/api/categories', '/categories'], categoryRoutes);\nmount('subcategories', ['/api/subcategories', '/subcategories'], subcategoryRoutes);\nmount('publicProducts', '/api/products', publicProductsRoutes);\nmount('publicUnits', '/api', publicUnitsRouter);\nmount('lookups', '/api', lookupsRouter);\n\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ admin/protected mounts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nmount('adminUnits', '/api', adminUnitsRouter);\nmount('sizeUnits', '/api/size-units', sizeUnitsRouter);\nmount('adminSizeUnits', ['/api/admin/size-units', '/api/admin/sizes'], adminSizeUnitsRouter, requireAuth, requireRole(['admin']));\nmount('adminProducts', ['/api/admin/products', '/admin/products'], adminProductRoutes, requireAuth, requireRole(['admin']));\nmount('adminVariants', ['/api/admin/variants', '/admin/variants'], adminVariantsRoutes, requireAuth, requireRole(['admin']));\n// âœ… à¹€à¸žà¸´à¹ˆà¸¡ base à¸™à¸µà¹‰à¹€à¸žà¸·à¹ˆà¸­à¹ƒà¸«à¹‰ path à¹à¸šà¸š /api/admin/products/:id/variants/generate à¹ƒà¸Šà¹‰à¹„à¸Ÿà¸¥à¹Œà¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™à¹„à¸”à¹‰\nmount('adminVariants (products base)', '/api/admin/products', adminVariantsRoutes, requireAuth, requireRole(['admin']));\nmount('adminSubcats', ['/api/admin/subcategories', '/admin/subcategories'], adminSubcatRoutes, requireAuth, requireRole(['admin']));\nmount('productStatus', ['/api/product-status', '/product-status'], productStatusRoutes, requireAuth, requireRole(['admin']));\nmount('adminUsers', '/api', adminUsersRouter, requireAuth, requireRole(['admin']));\n\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ uploads/images guard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nfunction pathStartsWith(p, prefix) {\n  return p === prefix || p.startsWith(prefix + '/');\n}\nfunction lockAdminWrites(req, res, next) {\n  if (['GET', 'HEAD', 'OPTIONS'].includes(req.method)) return next();\n  if (pathStartsWith(req.baseUrl + req.path, '/api/upload')) return next();\n  if (pathStartsWith(req.baseUrl + req.path, '/api/uploads')) return next();\n  return requireAuth(req, res, () => requireRole(['admin'])(req, res, next));\n}\nif (productImagesRoutes) {\n  app.use(['/api/upload', '/api/uploads'], (req, res, next) => lockAdminWrites(req, res, next), productImagesRoutes);\n}\n\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ protected mounts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nmount('variants', '/api/variants', variantRoutes);\nmount('uploads', ['/api/uploads', '/api/upload', '/upload'], uploadsRoutes, requireAuth);\nmount('addresses', ['/api/addresses', '/addresses'], addressesRoutes, requireAuth);\nmount('user-addresses', ['/api/user-addresses', '/user-addresses'], addressesRoutes, requireAuth);\nmount('orders', ['/api/orders', '/orders'], orderRoutes, requireAuth);\nmount('inventory', '/api/inventory', inventoryRoutes, requireAuth);\nmount('cart', '/api/cart', cartRoutes, requireAuth);\nmount('analytics', '/api/analytics', analyticsRoutes, requireAuth);\nmount('dashboard', '/api/dashboard', dashboardRoutes, requireAuth);\n\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ route map debug â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\napp.get('/_routes', (_req, res) => {\n  const list = [];\n  (app._router.stack || []).forEach(s => {\n    if (s.route && s.route.path) {\n      const methods = Object.keys(s.route.methods).join(',').toUpperCase();\n      list.push(`${methods.padEnd(10)} ${s.route.path}`);\n    } else if (s.name === 'router' && s.regexp) {\n      list.push(`ROUTER ${s.regexp}`);\n    }\n  });\n  res.type('text').send(list.join('\\n'));\n});\n\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ shim: orders/new-count â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nconst db = tryRequire('./db');\napp.get('/api/orders/new-count', async (_req, res) => {\n  if (!db) return res.json({\n    count: 0\n  });\n  try {\n    var _rows$0$count, _rows$;\n    const {\n      rows\n    } = await db.query(`\n      SELECT COUNT(*)::int AS count\n      FROM orders\n      WHERE (status IS NULL OR status IN ('new','pending','unpaid'))\n    `).catch(() => ({\n      rows: [{\n        count: 0\n      }]\n    }));\n    res.json({\n      count: (_rows$0$count = rows === null || rows === void 0 ? void 0 : (_rows$ = rows[0]) === null || _rows$ === void 0 ? void 0 : _rows$.count) !== null && _rows$0$count !== void 0 ? _rows$0$count : 0\n    });\n  } catch {\n    res.json({\n      count: 0\n    });\n  }\n});\n\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ errors â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\napp.use((_req, res) => res.status(404).json({\n  message: 'Not found'\n}));\napp.use((err, _req, res, _next) => {\n  console.error('ðŸ’¥ Unhandled error:', err);\n  const isDev = process.env.NODE_ENV !== 'production';\n  const payload = {\n    message: 'Server error'\n  };\n  if (isDev && err !== null && err !== void 0 && err.message) payload.details = err.message;\n  if (isDev && err !== null && err !== void 0 && err.code) payload.code = err.code;\n  res.status(err.status || 500).json(payload);\n});\n\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ start â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nconst PORT = process.env.PORT || 3001;\napp.listen(PORT, () => {\n  console.log(`ðŸš€ Server is running on http://localhost:${PORT}`);\n  console.log(`ðŸ“ Static uploads at /uploads and /api/uploads -> ${uploadsDir}`);\n  console.log(`ðŸ”“ CORS allowlist: ${allowlist.join(', ')}`);\n});","map":{"version":3,"names":["require","config","express","cors","path","fs","helmet","compression","morgan","rateLimit","app","disable","set","tryRequire","p","e","console","warn","code","message","mount","name","paths","router","guards","arr","Array","isArray","use","filter","Boolean","log","join","requireAuth","_req","_res","next","requireRole","m","crossOriginResourcePolicy","policy","process","env","NODE_ENV","rawOrigins","FRONTEND_ORIGIN","allowlist","split","map","s","trim","corsOptions","origin","cb","includes","err","Error","status","credentials","allowedHeaders","options","json","limit","urlencoded","extended","req","res","originalUrl","startsWith","_res$removeHeader","_res$removeHeader2","removeHeader","call","method","get","send","ok","at","ts","Date","now","uploadsDir","__dirname","existsSync","mkdirSync","recursive","static","maxAge","windowMs","max","standardHeaders","legacyHeaders","productStatusRoutes","adminProductRoutes","adminVariantsRoutes","uploadsRoutes","categoryRoutes","orderRoutes","authRoutes","addressesRoutes","variantRoutes","publicProductsRoutes","inventoryRoutes","productImagesRoutes","adminSubcatRoutes","subcategoryRoutes","lookupsRouter","dashboardRoutes","cartRoutes","analyticsRoutes","adminUnitsRouter","publicUnitsRouter","sizeUnitsRouter","adminSizeUnitsRouter","meRoutes","adminUsersRouter","pathStartsWith","prefix","lockAdminWrites","baseUrl","list","_router","stack","forEach","route","methods","Object","keys","toUpperCase","push","padEnd","regexp","type","db","count","_rows$0$count","_rows$","rows","query","catch","_next","error","isDev","payload","details","PORT","listen"],"sources":["D:/project19/frontend/src/admin/VariantsManager.js"],"sourcesContent":["// backend/server.js\r\n// ðŸŒ¿ Project19 Backend â€” Hardened server (safe requires + stable mounts)\r\n\r\nrequire('dotenv').config();\r\nconst express = require('express');\r\nconst cors = require('cors');\r\nconst path = require('path');\r\nconst fs = require('fs');\r\nconst helmet = require('helmet');\r\nconst compression = require('compression');\r\nconst morgan = require('morgan');\r\nconst rateLimit = require('express-rate-limit');\r\n\r\nconst app = express();\r\napp.disable('x-powered-by');\r\napp.set('trust proxy', 1);\r\napp.set('etag', false); // à¸›à¸´à¸” ETag à¸à¸±à¸™ 304\r\n\r\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\r\nfunction tryRequire(p) {\r\n  try { return require(p); } catch (e) { console.warn('â›” SKIP require:', p, '-', e.code || e.message); return null; }\r\n}\r\nfunction mount(name, paths, router, ...guards) {\r\n  if (!router) return;\r\n  const arr = Array.isArray(paths) ? paths : [paths];\r\n  app.use(arr, ...guards.filter(Boolean), router);\r\n  console.log(`â–¶ ${name} router LOADED ->`, arr.join(', '));\r\n}\r\n\r\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ auth (safe default) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\r\nlet requireAuth = (_req, _res, next) => next();\r\nlet requireRole  = () => (_req, _res, next) => next();\r\n{\r\n  const m = tryRequire('./middleware/auth');\r\n  if (m) {\r\n    requireAuth = m.requireAuth || requireAuth;\r\n    requireRole = m.requireRole  || requireRole;\r\n  }\r\n}\r\n\r\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ security & perf â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\r\napp.use(helmet({ crossOriginResourcePolicy: { policy: 'cross-origin' } }));\r\napp.use(compression());\r\napp.use(morgan(process.env.NODE_ENV === 'production' ? 'combined' : 'dev'));\r\n\r\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CORS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\r\nconst rawOrigins =\r\n  process.env.FRONTEND_ORIGIN ||\r\n  'http://localhost:5173,http://localhost:3000,http://127.0.0.1:5173,http://127.0.0.1:3000,http://127.0.0.1:5500';\r\nconst allowlist = rawOrigins.split(',').map(s => s.trim()).filter(Boolean);\r\nconst corsOptions = {\r\n  origin: (origin, cb) => {\r\n    if (!origin) return cb(null, true);\r\n    if (allowlist.includes('*') || allowlist.includes(origin)) return cb(null, true);\r\n    const err = new Error(`Not allowed by CORS: ${origin}`);\r\n    err.status = 403;\r\n    return cb(err, false);\r\n  },\r\n  credentials: true,\r\n  allowedHeaders: ['Content-Type', 'Authorization'],\r\n};\r\napp.use(cors(corsOptions));\r\napp.options('*', cors(corsOptions));\r\n\r\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ body parser â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\r\napp.use(express.json({ limit: '10mb' }));\r\napp.use(express.urlencoded({ extended: true, limit: '10mb' }));\r\n\r\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ API cache headers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\r\napp.use((req, res, next) => {\r\n  if (req.originalUrl.startsWith('/api/')) {\r\n    res.set('Cache-Control', 'no-store, no-cache, must-revalidate, proxy-revalidate');\r\n    res.set('Pragma', 'no-cache');\r\n    res.set('Expires', '0');\r\n    res.removeHeader?.('ETag');\r\n    res.removeHeader?.('Last-Modified');\r\n  }\r\n  next();\r\n});\r\n\r\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ request debug â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\r\napp.use((req, _res, next) => { console.log('>>>', req.method, req.originalUrl); next(); });\r\n\r\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ health/root â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\r\napp.get('/', (_req, res) => res.send('ðŸŒ± Plant Shop API is running...'));\r\napp.get('/_health', (_req, res) => res.json({ ok: true, at: 'server.js', ts: Date.now() }));\r\n\r\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ static uploads â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\r\nconst uploadsDir = path.join(__dirname, 'uploads');\r\nif (!fs.existsSync(uploadsDir)) fs.mkdirSync(uploadsDir, { recursive: true });\r\n\r\n// ðŸ”¹ à¹€à¸ªà¸´à¸£à¹Œà¸Ÿà¸—à¸±à¹‰à¸‡à¸ªà¸­à¸‡à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡: /uploads à¹à¸¥à¸° /api/uploads\r\napp.use('/uploads',     express.static(uploadsDir, { maxAge: '1h' }));\r\napp.use('/api/uploads', express.static(uploadsDir, { maxAge: '1h' }));\r\n\r\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ rate limit (login) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\r\napp.use('/api/auth/login', rateLimit({\r\n  windowMs: 15 * 60 * 1000,\r\n  max: 100,\r\n  standardHeaders: true,\r\n  legacyHeaders: false,\r\n}));\r\n\r\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ require routers (safe) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\r\nconst productStatusRoutes  = tryRequire('./routes/productStatus');\r\nconst adminProductRoutes   = tryRequire('./routes/adminProducts');\r\nconst adminVariantsRoutes  = tryRequire('./routes/adminVariants');\r\nconst uploadsRoutes        = tryRequire('./routes/uploads');\r\nconst categoryRoutes       = tryRequire('./routes/categories');\r\nconst orderRoutes          = tryRequire('./routes/orders');\r\nconst authRoutes           = tryRequire('./routes/auth');\r\nconst addressesRoutes      = tryRequire('./routes/addresses');\r\nconst variantRoutes        = tryRequire('./routes/variants');\r\nconst publicProductsRoutes = tryRequire('./routes/publicProducts');\r\nconst inventoryRoutes      = tryRequire('./routes/inventory');\r\nconst productImagesRoutes  = tryRequire('./routes/productImages');\r\nconst adminSubcatRoutes    = tryRequire('./routes/adminSubcategories');\r\nconst subcategoryRoutes    = tryRequire('./routes/subcategories');\r\nconst lookupsRouter        = tryRequire('./routes/lookups');\r\nconst dashboardRoutes      = tryRequire('./routes/dashboard');\r\nconst cartRoutes           = tryRequire('./routes/cart');\r\nconst analyticsRoutes      = tryRequire('./routes/analytics');\r\nconst adminUnitsRouter     = tryRequire('./routes/adminUnits');\r\nconst publicUnitsRouter    = tryRequire('./routes/publicUnits');\r\nconst sizeUnitsRouter      = tryRequire('./routes/sizeUnits');\r\nconst adminSizeUnitsRouter = tryRequire('./routes/adminSizeUnits');\r\nconst meRoutes             = tryRequire('./routes/me');\r\nconst adminUsersRouter     = tryRequire('./routes/adminUsers');\r\n\r\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ public mounts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\r\nmount('auth',            ['/api/auth', '/auth'], authRoutes);\r\nmount('me',              '/api/me', meRoutes);\r\nmount('categories',      ['/api/categories', '/categories'], categoryRoutes);\r\nmount('subcategories',   ['/api/subcategories', '/subcategories'], subcategoryRoutes);\r\nmount('publicProducts',  '/api/products', publicProductsRoutes);\r\nmount('publicUnits',     '/api', publicUnitsRouter);\r\nmount('lookups',         '/api', lookupsRouter);\r\n\r\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ admin/protected mounts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\r\nmount('adminUnits',      '/api', adminUnitsRouter);\r\nmount('sizeUnits',       '/api/size-units', sizeUnitsRouter);\r\nmount('adminSizeUnits',  ['/api/admin/size-units','/api/admin/sizes'], adminSizeUnitsRouter, requireAuth, requireRole(['admin']));\r\nmount('adminProducts',   ['/api/admin/products','/admin/products'], adminProductRoutes, requireAuth, requireRole(['admin']));\r\nmount('adminVariants',   ['/api/admin/variants','/admin/variants'], adminVariantsRoutes, requireAuth, requireRole(['admin']));\r\n// âœ… à¹€à¸žà¸´à¹ˆà¸¡ base à¸™à¸µà¹‰à¹€à¸žà¸·à¹ˆà¸­à¹ƒà¸«à¹‰ path à¹à¸šà¸š /api/admin/products/:id/variants/generate à¹ƒà¸Šà¹‰à¹„à¸Ÿà¸¥à¹Œà¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™à¹„à¸”à¹‰\r\nmount('adminVariants (products base)', '/api/admin/products', adminVariantsRoutes, requireAuth, requireRole(['admin']));\r\nmount('adminSubcats',    ['/api/admin/subcategories','/admin/subcategories'], adminSubcatRoutes, requireAuth, requireRole(['admin']));\r\nmount('productStatus',   ['/api/product-status','/product-status'], productStatusRoutes, requireAuth, requireRole(['admin']));\r\nmount('adminUsers',      '/api', adminUsersRouter, requireAuth, requireRole(['admin']));\r\n\r\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ uploads/images guard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\r\nfunction pathStartsWith(p, prefix) { return p === prefix || p.startsWith(prefix + '/'); }\r\nfunction lockAdminWrites(req, res, next) {\r\n  if (['GET', 'HEAD', 'OPTIONS'].includes(req.method)) return next();\r\n  if (pathStartsWith(req.baseUrl + req.path, '/api/upload'))  return next();\r\n  if (pathStartsWith(req.baseUrl + req.path, '/api/uploads')) return next();\r\n  return requireAuth(req, res, () => requireRole(['admin'])(req, res, next));\r\n}\r\nif (productImagesRoutes) {\r\n  app.use(['/api/upload', '/api/uploads'], (req,res,next)=>lockAdminWrites(req,res,next), productImagesRoutes);\r\n}\r\n\r\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ protected mounts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\r\nmount('variants',   '/api/variants', variantRoutes);\r\nmount('uploads',    ['/api/uploads','/api/upload','/upload'], uploadsRoutes, requireAuth);\r\nmount('addresses',  ['/api/addresses','/addresses'], addressesRoutes, requireAuth);\r\nmount('user-addresses', ['/api/user-addresses','/user-addresses'], addressesRoutes, requireAuth);\r\nmount('orders',     ['/api/orders','/orders'], orderRoutes, requireAuth);\r\nmount('inventory',  '/api/inventory', inventoryRoutes, requireAuth);\r\nmount('cart',       '/api/cart', cartRoutes, requireAuth);\r\nmount('analytics',  '/api/analytics', analyticsRoutes, requireAuth);\r\nmount('dashboard',  '/api/dashboard', dashboardRoutes, requireAuth);\r\n\r\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ route map debug â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\r\napp.get('/_routes', (_req, res) => {\r\n  const list = [];\r\n  (app._router.stack || []).forEach((s) => {\r\n    if (s.route && s.route.path) {\r\n      const methods = Object.keys(s.route.methods).join(',').toUpperCase();\r\n      list.push(`${methods.padEnd(10)} ${s.route.path}`);\r\n    } else if (s.name === 'router' && s.regexp) {\r\n      list.push(`ROUTER ${s.regexp}`);\r\n    }\r\n  });\r\n  res.type('text').send(list.join('\\n'));\r\n});\r\n\r\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ shim: orders/new-count â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\r\nconst db = tryRequire('./db');\r\napp.get('/api/orders/new-count', async (_req, res) => {\r\n  if (!db) return res.json({ count: 0 });\r\n  try {\r\n    const { rows } = await db.query(`\r\n      SELECT COUNT(*)::int AS count\r\n      FROM orders\r\n      WHERE (status IS NULL OR status IN ('new','pending','unpaid'))\r\n    `).catch(() => ({ rows: [{ count: 0 }] }));\r\n    res.json({ count: rows?.[0]?.count ?? 0 });\r\n  } catch {\r\n    res.json({ count: 0 });\r\n  }\r\n});\r\n\r\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ errors â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\r\napp.use((_req, res) => res.status(404).json({ message: 'Not found' }));\r\napp.use((err, _req, res, _next) => {\r\n  console.error('ðŸ’¥ Unhandled error:', err);\r\n  const isDev = process.env.NODE_ENV !== 'production';\r\n  const payload = { message: 'Server error' };\r\n  if (isDev && err?.message) payload.details = err.message;\r\n  if (isDev && err?.code) payload.code = err.code;\r\n  res.status(err.status || 500).json(payload);\r\n});\r\n\r\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ start â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\r\nconst PORT = process.env.PORT || 3001;\r\napp.listen(PORT, () => {\r\n  console.log(`ðŸš€ Server is running on http://localhost:${PORT}`);\r\n  console.log(`ðŸ“ Static uploads at /uploads and /api/uploads -> ${uploadsDir}`);\r\n  console.log(`ðŸ”“ CORS allowlist: ${allowlist.join(', ')}`);\r\n});\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}