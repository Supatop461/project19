{"ast":null,"code":"var _jsxFileName = \"D:\\\\project19\\\\frontend\\\\src\\\\pages\\\\ProfileModal.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n// src/pages/ProfileModal.js\nimport React, { useEffect, useMemo, useState } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport axios from \"axios\";\nimport \"./ProfileModal.css\";\n\n/**\r\n * BACKEND ที่คาดหวัง:\r\n * - POST /api/uploads/avatar  (multipart/form-data, field: \"file\") -> { url }\r\n * - GET  /api/me              -> { id, fullname, email, phone, avatar_url, settings? }\r\n * - PUT  /api/me              -> body: { fullname, phone, avatar_url }\r\n * - GET  /api/orders/my?limit=5\r\n * - PUT  /api/settings        -> body: { order_updates, marketing_email }\r\n */\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst API_BASE = axios.defaults.baseURL || process.env.REACT_APP_API_BASE || \"http://localhost:3001\";\nconst UPLOAD_ENDPOINT = \"/api/uploads/avatar\";\n\n/* ---------------- helpers ป้องกันชื่อกลายเป็นอีเมล + map คีย์หลากหลาย ---------------- */\nconst pick = (o, keys) => {\n  for (const k of keys) {\n    const v = o === null || o === void 0 ? void 0 : o[k];\n    if (v !== undefined && v !== null && String(v).trim() !== \"\") return v;\n  }\n  return \"\";\n};\nconst deriveEmail = u => pick(u, [\"email\", \"user_email\", \"mail\", \"username\"]);\nconst deriveFullname = u => {\n  // 1) ลองฟิลด์ชื่อโดยตรงก่อน\n  const direct = pick(u, [\"fullname\", \"full_name\", \"name\", \"display_name\"]);\n  if (direct && !String(direct).includes(\"@\")) return String(direct).trim();\n\n  // 2) ลองต่อ first + last\n  const first = pick(u, [\"first_name\", \"firstname\", \"given_name\", \"fname\", \"firstName\"]);\n  const last = pick(u, [\"last_name\", \"lastname\", \"family_name\", \"lname\", \"lastName\"]);\n  const joined = [first, last].filter(Boolean).join(\" \").trim();\n  if (joined && !joined.includes(\"@\")) return joined;\n\n  // 3) ห้าม fallback เป็นอีเมลเด็ดขาด\n  return \"\";\n};\nconst derivePhone = u => pick(u, [\"phone\", \"phone_number\", \"tel\", \"telephone\", \"mobile\", \"mobile_phone\"]);\nexport default function ProfileModal({\n  initialTab = \"profile\",\n  onClose\n}) {\n  _s();\n  const [tab, setTab] = useState(initialTab); // profile | orders | addresses | settings\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n  const [loadErr, setLoadErr] = useState(\"\");\n\n  // --- Toast state ---\n  const [toast, setToast] = useState({\n    show: false,\n    type: \"success\",\n    message: \"\"\n  });\n  const pushToast = (message, type = \"success\") => {\n    setToast({\n      show: true,\n      type,\n      message\n    });\n    window.clearTimeout(pushToast._t);\n    pushToast._t = window.setTimeout(() => {\n      setToast(t => ({\n        ...t,\n        show: false\n      }));\n    }, 2500);\n  };\n\n  // -------- โปรไฟล์ --------\n  const [profile, setProfile] = useState({\n    id: \"\",\n    fullname: \"\",\n    email: \"\",\n    phone: \"\",\n    avatar_url: \"\"\n  });\n\n  // -------- ค่าตั้งค่า --------\n  const [prefs, setPrefs] = useState({\n    order_updates: true,\n    marketing_email: false\n  });\n\n  // -------- คำสั่งซื้อ --------\n  const [orders, setOrders] = useState([]);\n  const [ordersLoading, setOrdersLoading] = useState(false);\n  const avatarFallback = useMemo(() => process.env.PUBLIC_URL + \"/profile.jpg\", []);\n  const axiosClient = useMemo(() => {\n    const token = localStorage.getItem(\"token\") || \"\";\n    return axios.create({\n      baseURL: API_BASE,\n      headers: token ? {\n        Authorization: `Bearer ${token}`\n      } : {},\n      timeout: 12000\n    });\n  }, []);\n  const closeModal = () => {\n    if (typeof onClose === \"function\") onClose();\n  };\n\n  // โหลดข้อมูลผู้ใช้ + settings\n  useEffect(() => {\n    let ignore = false;\n    (async () => {\n      try {\n        var _u$settings$order_upd, _u$settings, _u$settings$marketing, _u$settings2;\n        setLoading(true);\n        setLoadErr(\"\");\n        const r = await axiosClient.get(\"/api/me\");\n        if (ignore) return;\n        const u = r.data || {};\n        const email = deriveEmail(u);\n        const fullname = deriveFullname(u); // ← จะว่างถ้าไม่มีจริง (ไม่ใช่อีเมล)\n        const phone = derivePhone(u);\n        const avatar = pick(u, [\"avatar_url\", \"avatar\", \"photo\", \"image_url\"]);\n        setProfile({\n          id: u.id || \"\",\n          fullname: fullname || \"\",\n          email: email || \"\",\n          phone: phone || \"\",\n          avatar_url: avatar || avatarFallback\n        });\n        setPrefs({\n          order_updates: (_u$settings$order_upd = u === null || u === void 0 ? void 0 : (_u$settings = u.settings) === null || _u$settings === void 0 ? void 0 : _u$settings.order_updates) !== null && _u$settings$order_upd !== void 0 ? _u$settings$order_upd : true,\n          marketing_email: (_u$settings$marketing = u === null || u === void 0 ? void 0 : (_u$settings2 = u.settings) === null || _u$settings2 === void 0 ? void 0 : _u$settings2.marketing_email) !== null && _u$settings$marketing !== void 0 ? _u$settings$marketing : false\n        });\n\n        // อัปเดต localStorage (ห้ามเก็บ fullname ที่เป็นอีเมล)\n        if (fullname) localStorage.setItem(\"fullname\", fullname);\n        if (email) localStorage.setItem(\"email\", email);\n        if (phone) localStorage.setItem(\"phone\", phone);\n\n        // แจ้ง Header ให้รีเฟรชชื่อเมื่อได้ชื่อจริง\n        if (fullname) window.dispatchEvent(new Event(\"profile:changed\"));\n      } catch (e) {\n        var _e$response, _e$response$data;\n        console.error(\"GET /api/me failed:\", e);\n        setLoadErr((e === null || e === void 0 ? void 0 : (_e$response = e.response) === null || _e$response === void 0 ? void 0 : (_e$response$data = _e$response.data) === null || _e$response$data === void 0 ? void 0 : _e$response$data.message) || (e === null || e === void 0 ? void 0 : e.message) || \"โหลดข้อมูลผู้ใช้ล้มเหลว\");\n\n        // fallback แสดงค่าจาก localStorage ชั่วคราว (ไม่ดันอีเมลใส่ fullname)\n        setProfile(s => ({\n          ...s,\n          fullname: (localStorage.getItem(\"fullname\") || s.fullname || \"\").includes(\"@\") ? s.fullname || \"\" : localStorage.getItem(\"fullname\") || s.fullname || \"ผู้ใช้งาน\",\n          email: localStorage.getItem(\"email\") || s.email || \"\",\n          phone: localStorage.getItem(\"phone\") || s.phone || \"\",\n          avatar_url: s.avatar_url || avatarFallback\n        }));\n      } finally {\n        setLoading(false);\n      }\n    })();\n    return () => {\n      ignore = true;\n    };\n  }, [axiosClient, avatarFallback]);\n\n  // โหลดคำสั่งซื้อล่าสุดเมื่อเปิดแท็บ orders\n  useEffect(() => {\n    if (tab !== \"orders\") return;\n    let ignore = false;\n    (async () => {\n      try {\n        var _r$data;\n        setOrdersLoading(true);\n        const r = await axiosClient.get(\"/api/orders/my\", {\n          params: {\n            limit: 5\n          }\n        });\n        if (!ignore) setOrders(Array.isArray(r.data) ? r.data : ((_r$data = r.data) === null || _r$data === void 0 ? void 0 : _r$data.items) || []);\n      } catch (e) {\n        console.error(\"GET /api/orders/my failed:\", e);\n      } finally {\n        setOrdersLoading(false);\n      }\n    })();\n    return () => {\n      ignore = true;\n    };\n  }, [tab, axiosClient]);\n\n  // ---------- handlers ----------\n  const onChangeProfile = (k, v) => setProfile(s => ({\n    ...s,\n    [k]: v\n  }));\n  const onChangePref = (k, v) => setPrefs(s => ({\n    ...s,\n    [k]: v\n  }));\n  const saveProfile = async () => {\n    try {\n      var _profile$fullname, _profile$phone, _profile$fullname2;\n      setSaving(true);\n      await axiosClient.put(\"/api/me\", {\n        fullname: ((_profile$fullname = profile.fullname) === null || _profile$fullname === void 0 ? void 0 : _profile$fullname.trim()) || null,\n        // เก็บเป็น null ถ้าเว้นว่าง\n        phone: ((_profile$phone = profile.phone) === null || _profile$phone === void 0 ? void 0 : _profile$phone.trim()) || null,\n        avatar_url: profile.avatar_url || null\n      });\n      // sync local + แจ้ง Header เมื่อชื่อจริงเปลี่ยน\n      if ((_profile$fullname2 = profile.fullname) !== null && _profile$fullname2 !== void 0 && _profile$fullname2.trim() && !/@/.test(profile.fullname)) {\n        localStorage.setItem(\"fullname\", profile.fullname.trim());\n        window.dispatchEvent(new Event(\"profile:changed\"));\n      }\n      pushToast(\"บันทึกโปรไฟล์เรียบร้อย ✅\", \"success\");\n    } catch (e) {\n      var _e$response2, _e$response2$data;\n      console.error(\"PUT /api/me failed:\", e);\n      pushToast((e === null || e === void 0 ? void 0 : (_e$response2 = e.response) === null || _e$response2 === void 0 ? void 0 : (_e$response2$data = _e$response2.data) === null || _e$response2$data === void 0 ? void 0 : _e$response2$data.message) || e.message || \"บันทึกโปรไฟล์ล้มเหลว\", \"error\");\n    } finally {\n      setSaving(false);\n    }\n  };\n  const saveSettings = async () => {\n    try {\n      setSaving(true);\n      await axiosClient.put(\"/api/settings\", {\n        order_updates: !!prefs.order_updates,\n        marketing_email: !!prefs.marketing_email\n      });\n      pushToast(\"บันทึกการตั้งค่าเรียบร้อย ✅\", \"success\");\n    } catch (e) {\n      var _e$response3, _e$response3$data;\n      console.error(\"PUT /api/settings failed:\", e);\n      pushToast((e === null || e === void 0 ? void 0 : (_e$response3 = e.response) === null || _e$response3 === void 0 ? void 0 : (_e$response3$data = _e$response3.data) === null || _e$response3$data === void 0 ? void 0 : _e$response3$data.message) || e.message || \"บันทึกการตั้งค่าล้มเหลว\", \"error\");\n    } finally {\n      setSaving(false);\n    }\n  };\n  const logout = () => {\n    localStorage.removeItem(\"token\");\n    localStorage.removeItem(\"role\");\n    delete axios.defaults.headers.common[\"Authorization\"];\n    closeModal();\n    window.location.href = \"/login\";\n  };\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"sr-only\",\n      \"aria-live\": \"polite\",\n      \"aria-atomic\": \"true\",\n      children: toast.show ? toast.message : \"\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"pm-backdrop\",\n      onClick: closeModal,\n      role: \"dialog\",\n      \"aria-modal\": \"true\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"pm-card\",\n        onClick: e => e.stopPropagation(),\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"pm-close\",\n          onClick: closeModal,\n          \"aria-label\": \"\\u0E1B\\u0E34\\u0E14\",\n          children: \"\\xD7\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 240,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pm-head\",\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            className: \"pm-avatar\",\n            src: profile.avatar_url || avatarFallback,\n            alt: \"avatar\",\n            onError: e => e.currentTarget.src = process.env.PUBLIC_URL + \"/logo.png\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 244,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"pm-head-info\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"pm-name\",\n              children: loading ? \"กำลังโหลด...\" : profile.fullname || profile.email || \"ผู้ใช้งาน\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 251,\n              columnNumber: 15\n            }, this), (profile.email || profile.phone) && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"pm-sub\",\n              children: profile.email || profile.phone\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 255,\n              columnNumber: 17\n            }, this), loadErr && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"pm-sub\",\n              style: {\n                color: \"#b91c1c\"\n              },\n              children: loadErr\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 258,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 250,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 243,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pm-tabs\",\n          role: \"tablist\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: `pm-tab ${tab === \"profile\" ? \"active\" : \"\"}`,\n            onClick: () => setTab(\"profile\"),\n            role: \"tab\",\n            children: \"\\u0E42\\u0E1B\\u0E23\\u0E44\\u0E1F\\u0E25\\u0E4C\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 267,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: `pm-tab ${tab === \"orders\" ? \"active\" : \"\"}`,\n            onClick: () => setTab(\"orders\"),\n            role: \"tab\",\n            children: \"\\u0E04\\u0E33\\u0E2A\\u0E31\\u0E48\\u0E07\\u0E0B\\u0E37\\u0E49\\u0E2D\\u0E02\\u0E2D\\u0E07\\u0E09\\u0E31\\u0E19\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 268,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: `pm-tab ${tab === \"addresses\" ? \"active\" : \"\"}`,\n            onClick: () => setTab(\"addresses\"),\n            role: \"tab\",\n            children: \"\\u0E17\\u0E35\\u0E48\\u0E2D\\u0E22\\u0E39\\u0E48\\u0E02\\u0E2D\\u0E07\\u0E09\\u0E31\\u0E19\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 269,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: `pm-tab ${tab === \"settings\" ? \"active\" : \"\"}`,\n            onClick: () => setTab(\"settings\"),\n            role: \"tab\",\n            children: \"\\u0E01\\u0E32\\u0E23\\u0E15\\u0E31\\u0E49\\u0E07\\u0E04\\u0E48\\u0E32\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 270,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 266,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pm-body\",\n          children: [tab === \"profile\" && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"pm-section\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"pm-grid\",\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                children: \"\\u0E0A\\u0E37\\u0E48\\u0E2D-\\u0E19\\u0E32\\u0E21\\u0E2A\\u0E01\\u0E38\\u0E25\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 279,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                value: profile.fullname,\n                onChange: e => onChangeProfile(\"fullname\", e.target.value),\n                placeholder: \"\\u0E40\\u0E0A\\u0E48\\u0E19 \\u0E28\\u0E38\\u0E20\\u0E0A\\u0E31\\u0E22 \\u0E1E\\u0E23\\u0E2B\\u0E21\\u0E2D\\u0E34\\u0E19\\u0E17\\u0E23\\u0E4C\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 280,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n                children: \"\\u0E2D\\u0E35\\u0E40\\u0E21\\u0E25\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 286,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                value: profile.email,\n                disabled: true,\n                title: \"\\u0E2D\\u0E35\\u0E40\\u0E21\\u0E25\\u0E44\\u0E21\\u0E48\\u0E2A\\u0E32\\u0E21\\u0E32\\u0E23\\u0E16\\u0E40\\u0E1B\\u0E25\\u0E35\\u0E48\\u0E22\\u0E19\\u0E44\\u0E14\\u0E49\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 287,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n                children: \"\\u0E40\\u0E1A\\u0E2D\\u0E23\\u0E4C\\u0E42\\u0E17\\u0E23\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 289,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                value: profile.phone,\n                onChange: e => onChangeProfile(\"phone\", e.target.value),\n                placeholder: \"\\u0E40\\u0E0A\\u0E48\\u0E19 08x-xxx-xxxx\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 290,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n                children: \"\\u0E23\\u0E39\\u0E1B\\u0E42\\u0E1B\\u0E23\\u0E44\\u0E1F\\u0E25\\u0E4C\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 296,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(AvatarUploader, {\n                value: profile.avatar_url || avatarFallback,\n                onUploaded: url => onChangeProfile(\"avatar_url\", url),\n                axiosClient: axiosClient\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 297,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 278,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"pm-actions\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"pm-btn\",\n                onClick: saveProfile,\n                disabled: saving,\n                children: saving ? \"กำลังบันทึก...\" : \"บันทึกโปรไฟล์\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 305,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"pm-btn pm-outline\",\n                onClick: () => pushToast(\"ฟีเจอร์เปลี่ยนรหัสผ่าน: จะเพิ่มในรอบถัดไป\", \"info\"),\n                children: \"\\u0E40\\u0E1B\\u0E25\\u0E35\\u0E48\\u0E22\\u0E19\\u0E23\\u0E2B\\u0E31\\u0E2A\\u0E1C\\u0E48\\u0E32\\u0E19\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 308,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 304,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 277,\n            columnNumber: 15\n          }, this), tab === \"orders\" && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"pm-section\",\n            children: [ordersLoading ? /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"pm-note\",\n              children: \"\\u0E01\\u0E33\\u0E25\\u0E31\\u0E07\\u0E42\\u0E2B\\u0E25\\u0E14\\u0E04\\u0E33\\u0E2A\\u0E31\\u0E48\\u0E07\\u0E0B\\u0E37\\u0E49\\u0E2D\\u2026\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 322,\n              columnNumber: 19\n            }, this) : orders.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"pm-note\",\n              children: \"\\u0E22\\u0E31\\u0E07\\u0E44\\u0E21\\u0E48\\u0E21\\u0E35\\u0E04\\u0E33\\u0E2A\\u0E31\\u0E48\\u0E07\\u0E0B\\u0E37\\u0E49\\u0E2D\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 324,\n              columnNumber: 19\n            }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"pm-orders\",\n              children: orders.map(o => /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"pm-order-item\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"b\", {\n                    children: \"\\u0E40\\u0E25\\u0E02\\u0E17\\u0E35\\u0E48:\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 329,\n                    columnNumber: 30\n                  }, this), \" \", o.order_no || o.id]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 329,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"b\", {\n                    children: \"\\u0E2A\\u0E16\\u0E32\\u0E19\\u0E30:\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 330,\n                    columnNumber: 30\n                  }, this), \" \", o.status]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 330,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"b\", {\n                    children: \"\\u0E22\\u0E2D\\u0E14\\u0E23\\u0E27\\u0E21:\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 331,\n                    columnNumber: 30\n                  }, this), \" \", Number(o.total_amount || o.total).toLocaleString(\"th-TH\"), \" \\u0E1A\\u0E32\\u0E17\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 331,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"b\", {\n                    children: \"\\u0E27\\u0E31\\u0E19\\u0E17\\u0E35\\u0E48:\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 332,\n                    columnNumber: 30\n                  }, this), \" \", o.created_at ? new Date(o.created_at).toLocaleString() : \"-\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 332,\n                  columnNumber: 25\n                }, this)]\n              }, o.id || o.order_no, true, {\n                fileName: _jsxFileName,\n                lineNumber: 328,\n                columnNumber: 23\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 326,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                marginTop: 8\n              },\n              children: /*#__PURE__*/_jsxDEV(Link, {\n                to: \"/account/orders\",\n                className: \"pm-link\",\n                onClick: closeModal,\n                children: \"\\u0E14\\u0E39\\u0E04\\u0E33\\u0E2A\\u0E31\\u0E48\\u0E07\\u0E0B\\u0E37\\u0E49\\u0E2D\\u0E17\\u0E31\\u0E49\\u0E07\\u0E2B\\u0E21\\u0E14 \\u2192\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 338,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 337,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 320,\n            columnNumber: 15\n          }, this), tab === \"addresses\" && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"pm-section\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"pm-note\",\n              children: \"\\u0E08\\u0E31\\u0E14\\u0E01\\u0E32\\u0E23\\u0E17\\u0E35\\u0E48\\u0E2D\\u0E22\\u0E39\\u0E48\\u0E08\\u0E31\\u0E14\\u0E2A\\u0E48\\u0E07\\u0E02\\u0E2D\\u0E07\\u0E09\\u0E31\\u0E19\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 348,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Link, {\n              to: \"/account/addresses\",\n              className: \"pm-btn\",\n              onClick: closeModal,\n              children: \"\\u0E40\\u0E1B\\u0E34\\u0E14\\u0E2B\\u0E19\\u0E49\\u0E32\\u0E17\\u0E35\\u0E48\\u0E2D\\u0E22\\u0E39\\u0E48\\u0E02\\u0E2D\\u0E07\\u0E09\\u0E31\\u0E19\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 349,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 347,\n            columnNumber: 15\n          }, this), tab === \"settings\" && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"pm-section\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"pm-grid\",\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                children: \"\\u0E23\\u0E31\\u0E1A\\u0E01\\u0E32\\u0E23\\u0E41\\u0E08\\u0E49\\u0E07\\u0E40\\u0E15\\u0E37\\u0E2D\\u0E19\\u0E2A\\u0E16\\u0E32\\u0E19\\u0E30\\u0E04\\u0E33\\u0E2A\\u0E31\\u0E48\\u0E07\\u0E0B\\u0E37\\u0E49\\u0E2D\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 359,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Toggle, {\n                checked: prefs.order_updates,\n                onChange: v => setPrefs(s => ({\n                  ...s,\n                  order_updates: v\n                }))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 360,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n                children: \"\\u0E23\\u0E31\\u0E1A\\u0E2D\\u0E35\\u0E40\\u0E21\\u0E25\\u0E42\\u0E1B\\u0E23\\u0E42\\u0E21\\u0E0A\\u0E31\\u0E19/\\u0E02\\u0E48\\u0E32\\u0E27\\u0E2A\\u0E32\\u0E23\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 362,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Toggle, {\n                checked: prefs.marketing_email,\n                onChange: v => setPrefs(s => ({\n                  ...s,\n                  marketing_email: v\n                }))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 363,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 358,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"pm-note\",\n              style: {\n                marginTop: 8\n              },\n              children: [\"\\u0E23\\u0E30\\u0E1A\\u0E1A\\u0E08\\u0E30\\u0E2A\\u0E48\\u0E07\\u0E2D\\u0E31\\u0E1B\\u0E40\\u0E14\\u0E15\\u0E44\\u0E1B\\u0E22\\u0E31\\u0E07 \", profile.email || \"อีเมลของคุณ\", \" \\u0E41\\u0E25\\u0E30\\u0E41\\u0E2A\\u0E14\\u0E07\\u0E2A\\u0E16\\u0E32\\u0E19\\u0E30\\u0E43\\u0E19 \\u201C\\u0E04\\u0E33\\u0E2A\\u0E31\\u0E48\\u0E07\\u0E0B\\u0E37\\u0E49\\u0E2D\\u0E02\\u0E2D\\u0E07\\u0E09\\u0E31\\u0E19\\u201D\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 366,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"pm-actions\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"pm-btn\",\n                onClick: saveSettings,\n                disabled: saving,\n                children: saving ? \"กำลังบันทึก...\" : \"บันทึกการตั้งค่า\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 371,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"pm-btn pm-danger\",\n                onClick: logout,\n                children: \"\\u0E2D\\u0E2D\\u0E01\\u0E08\\u0E32\\u0E01\\u0E23\\u0E30\\u0E1A\\u0E1A\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 374,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 370,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 357,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 274,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Toast, {\n      toast: toast,\n      onClose: () => setToast(t => ({\n        ...t,\n        show: false\n      }))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 385,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}\n\n/* ------- UI helper: Toggle ------- */\n_s(ProfileModal, \"ilHJVlD9nfNg5v6VOJiKmXqbtVg=\");\n_c = ProfileModal;\nfunction Toggle({\n  checked,\n  onChange\n}) {\n  return /*#__PURE__*/_jsxDEV(\"button\", {\n    type: \"button\",\n    onClick: () => onChange === null || onChange === void 0 ? void 0 : onChange(!checked),\n    className: `pm-toggle ${checked ? \"on\" : \"\"}`,\n    \"aria-pressed\": checked,\n    children: /*#__PURE__*/_jsxDEV(\"span\", {\n      className: `pm-toggle-knob ${checked ? \"on\" : \"\"}`\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 399,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 393,\n    columnNumber: 5\n  }, this);\n}\n\n/* ------- อัปโหลดรูปโปรไฟล์ ------- */\n_c2 = Toggle;\nfunction AvatarUploader({\n  value,\n  onUploaded,\n  axiosClient\n}) {\n  _s2();\n  const [preview, setPreview] = useState(value);\n  const [busy, setBusy] = useState(false);\n  const [err, setErr] = useState(\"\");\n  useEffect(() => setPreview(value), [value]);\n  const onPick = async e => {\n    var _e$target$files;\n    const file = (_e$target$files = e.target.files) === null || _e$target$files === void 0 ? void 0 : _e$target$files[0];\n    if (!file) return;\n    setErr(\"\");\n    if (!file.type.startsWith(\"image/\")) {\n      setErr(\"รองรับเฉพาะไฟล์รูปภาพ\");\n      return;\n    }\n    const blobUrl = URL.createObjectURL(file);\n    setPreview(blobUrl);\n    const fd = new FormData();\n    fd.append(\"file\", file);\n    try {\n      var _r$data2;\n      setBusy(true);\n      const r = await axiosClient.post(UPLOAD_ENDPOINT, fd, {\n        headers: {\n          \"Content-Type\": \"multipart/form-data\"\n        }\n      });\n      const url = r === null || r === void 0 ? void 0 : (_r$data2 = r.data) === null || _r$data2 === void 0 ? void 0 : _r$data2.url;\n      if (!url) throw new Error(\"อัปโหลดสำเร็จ แต่ไม่ได้รับ URL กลับมา\");\n      onUploaded === null || onUploaded === void 0 ? void 0 : onUploaded(url);\n    } catch (e) {\n      var _e$response4, _e$response4$data;\n      console.error(\"UPLOAD avatar failed:\", e);\n      setErr((e === null || e === void 0 ? void 0 : (_e$response4 = e.response) === null || _e$response4 === void 0 ? void 0 : (_e$response4$data = _e$response4.data) === null || _e$response4$data === void 0 ? void 0 : _e$response4$data.message) || e.message || \"อัปโหลดไม่สำเร็จ\");\n      setPreview(value);\n    } finally {\n      setBusy(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"pm-upload\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"pm-upload-row\",\n      children: [/*#__PURE__*/_jsxDEV(\"img\", {\n        src: preview,\n        alt: \"avatar preview\",\n        className: \"pm-upload-thumb\",\n        onError: ev => ev.currentTarget.src = process.env.PUBLIC_URL + \"/logo.png\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 448,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        className: \"pm-btn pm-outline\",\n        style: {\n          cursor: \"pointer\"\n        },\n        children: [busy ? \"กำลังอัปโหลด...\" : \"เลือกไฟล์รูป\", /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"file\",\n          accept: \"image/*\",\n          onChange: onPick,\n          style: {\n            display: \"none\"\n          },\n          disabled: busy\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 456,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 454,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 447,\n      columnNumber: 7\n    }, this), err && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"pm-error\",\n      children: err\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 465,\n      columnNumber: 15\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"pm-help\",\n      children: \"\\u0E23\\u0E2D\\u0E07\\u0E23\\u0E31\\u0E1A .jpg .png .webp\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 466,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 446,\n    columnNumber: 5\n  }, this);\n}\n\n/* ------- Toast ------- */\n_s2(AvatarUploader, \"vElm0pnT59OJDNOMnNZp0mGLSGU=\");\n_c3 = AvatarUploader;\nfunction Toast({\n  toast,\n  onClose\n}) {\n  if (!(toast !== null && toast !== void 0 && toast.show)) return null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `pm-toast pm-toast-${toast.type}`,\n    role: \"status\",\n    \"aria-live\": \"polite\",\n    onClick: onClose,\n    title: \"\\u0E04\\u0E25\\u0E34\\u0E01\\u0E40\\u0E1E\\u0E37\\u0E48\\u0E2D\\u0E1B\\u0E34\\u0E14\",\n    children: [toast.type === \"success\" ? \"✅\" : toast.type === \"error\" ? \"⚠️\" : \"ℹ️\", \"\\xA0\", toast.message]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 475,\n    columnNumber: 5\n  }, this);\n}\n_c4 = Toast;\nvar _c, _c2, _c3, _c4;\n$RefreshReg$(_c, \"ProfileModal\");\n$RefreshReg$(_c2, \"Toggle\");\n$RefreshReg$(_c3, \"AvatarUploader\");\n$RefreshReg$(_c4, \"Toast\");","map":{"version":3,"names":["React","useEffect","useMemo","useState","Link","axios","jsxDEV","_jsxDEV","Fragment","_Fragment","API_BASE","defaults","baseURL","process","env","REACT_APP_API_BASE","UPLOAD_ENDPOINT","pick","o","keys","k","v","undefined","String","trim","deriveEmail","u","deriveFullname","direct","includes","first","last","joined","filter","Boolean","join","derivePhone","ProfileModal","initialTab","onClose","_s","tab","setTab","loading","setLoading","saving","setSaving","loadErr","setLoadErr","toast","setToast","show","type","message","pushToast","window","clearTimeout","_t","setTimeout","t","profile","setProfile","id","fullname","email","phone","avatar_url","prefs","setPrefs","order_updates","marketing_email","orders","setOrders","ordersLoading","setOrdersLoading","avatarFallback","PUBLIC_URL","axiosClient","token","localStorage","getItem","create","headers","Authorization","timeout","closeModal","ignore","_u$settings$order_upd","_u$settings","_u$settings$marketing","_u$settings2","r","get","data","avatar","settings","setItem","dispatchEvent","Event","e","_e$response","_e$response$data","console","error","response","s","_r$data","params","limit","Array","isArray","items","onChangeProfile","onChangePref","saveProfile","_profile$fullname","_profile$phone","_profile$fullname2","put","test","_e$response2","_e$response2$data","saveSettings","_e$response3","_e$response3$data","logout","removeItem","common","location","href","children","className","fileName","_jsxFileName","lineNumber","columnNumber","onClick","role","stopPropagation","src","alt","onError","currentTarget","style","color","value","onChange","target","placeholder","disabled","title","AvatarUploader","onUploaded","url","length","map","order_no","status","Number","total_amount","total","toLocaleString","created_at","Date","marginTop","to","Toggle","checked","Toast","_c","_c2","_s2","preview","setPreview","busy","setBusy","err","setErr","onPick","_e$target$files","file","files","startsWith","blobUrl","URL","createObjectURL","fd","FormData","append","_r$data2","post","Error","_e$response4","_e$response4$data","ev","cursor","accept","display","_c3","_c4","$RefreshReg$"],"sources":["D:/project19/frontend/src/pages/ProfileModal.js"],"sourcesContent":["// src/pages/ProfileModal.js\r\nimport React, { useEffect, useMemo, useState } from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport \"./ProfileModal.css\";\r\n\r\n/**\r\n * BACKEND ที่คาดหวัง:\r\n * - POST /api/uploads/avatar  (multipart/form-data, field: \"file\") -> { url }\r\n * - GET  /api/me              -> { id, fullname, email, phone, avatar_url, settings? }\r\n * - PUT  /api/me              -> body: { fullname, phone, avatar_url }\r\n * - GET  /api/orders/my?limit=5\r\n * - PUT  /api/settings        -> body: { order_updates, marketing_email }\r\n */\r\nconst API_BASE =\r\n  axios.defaults.baseURL || process.env.REACT_APP_API_BASE || \"http://localhost:3001\";\r\n\r\nconst UPLOAD_ENDPOINT = \"/api/uploads/avatar\";\r\n\r\n/* ---------------- helpers ป้องกันชื่อกลายเป็นอีเมล + map คีย์หลากหลาย ---------------- */\r\nconst pick = (o, keys) => {\r\n  for (const k of keys) {\r\n    const v = o?.[k];\r\n    if (v !== undefined && v !== null && String(v).trim() !== \"\") return v;\r\n  }\r\n  return \"\";\r\n};\r\n\r\nconst deriveEmail = (u) => pick(u, [\"email\", \"user_email\", \"mail\", \"username\"]);\r\n\r\nconst deriveFullname = (u) => {\r\n  // 1) ลองฟิลด์ชื่อโดยตรงก่อน\r\n  const direct = pick(u, [\"fullname\", \"full_name\", \"name\", \"display_name\"]);\r\n  if (direct && !String(direct).includes(\"@\")) return String(direct).trim();\r\n\r\n  // 2) ลองต่อ first + last\r\n  const first = pick(u, [\"first_name\", \"firstname\", \"given_name\", \"fname\", \"firstName\"]);\r\n  const last  = pick(u, [\"last_name\", \"lastname\", \"family_name\", \"lname\", \"lastName\"]);\r\n  const joined = [first, last].filter(Boolean).join(\" \").trim();\r\n  if (joined && !joined.includes(\"@\")) return joined;\r\n\r\n  // 3) ห้าม fallback เป็นอีเมลเด็ดขาด\r\n  return \"\";\r\n};\r\n\r\nconst derivePhone = (u) =>\r\n  pick(u, [\"phone\", \"phone_number\", \"tel\", \"telephone\", \"mobile\", \"mobile_phone\"]);\r\n\r\nexport default function ProfileModal({ initialTab = \"profile\", onClose }) {\r\n  const [tab, setTab] = useState(initialTab); // profile | orders | addresses | settings\r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState(false);\r\n  const [loadErr, setLoadErr] = useState(\"\");\r\n\r\n  // --- Toast state ---\r\n  const [toast, setToast] = useState({ show: false, type: \"success\", message: \"\" });\r\n  const pushToast = (message, type = \"success\") => {\r\n    setToast({ show: true, type, message });\r\n    window.clearTimeout(pushToast._t);\r\n    pushToast._t = window.setTimeout(() => {\r\n      setToast((t) => ({ ...t, show: false }));\r\n    }, 2500);\r\n  };\r\n\r\n  // -------- โปรไฟล์ --------\r\n  const [profile, setProfile] = useState({\r\n    id: \"\",\r\n    fullname: \"\",\r\n    email: \"\",\r\n    phone: \"\",\r\n    avatar_url: \"\",\r\n  });\r\n\r\n  // -------- ค่าตั้งค่า --------\r\n  const [prefs, setPrefs] = useState({\r\n    order_updates: true,\r\n    marketing_email: false,\r\n  });\r\n\r\n  // -------- คำสั่งซื้อ --------\r\n  const [orders, setOrders] = useState([]);\r\n  const [ordersLoading, setOrdersLoading] = useState(false);\r\n\r\n  const avatarFallback = useMemo(\r\n    () => process.env.PUBLIC_URL + \"/profile.jpg\",\r\n    []\r\n  );\r\n\r\n  const axiosClient = useMemo(() => {\r\n    const token = localStorage.getItem(\"token\") || \"\";\r\n    return axios.create({\r\n      baseURL: API_BASE,\r\n      headers: token ? { Authorization: `Bearer ${token}` } : {},\r\n      timeout: 12000,\r\n    });\r\n  }, []);\r\n\r\n  const closeModal = () => {\r\n    if (typeof onClose === \"function\") onClose();\r\n  };\r\n\r\n  // โหลดข้อมูลผู้ใช้ + settings\r\n  useEffect(() => {\r\n    let ignore = false;\r\n    (async () => {\r\n      try {\r\n        setLoading(true);\r\n        setLoadErr(\"\");\r\n        const r = await axiosClient.get(\"/api/me\");\r\n        if (ignore) return;\r\n\r\n        const u = r.data || {};\r\n        const email    = deriveEmail(u);\r\n        const fullname = deriveFullname(u); // ← จะว่างถ้าไม่มีจริง (ไม่ใช่อีเมล)\r\n        const phone    = derivePhone(u);\r\n        const avatar   = pick(u, [\"avatar_url\", \"avatar\", \"photo\", \"image_url\"]);\r\n\r\n        setProfile({\r\n          id: u.id || \"\",\r\n          fullname: fullname || \"\",\r\n          email: email || \"\",\r\n          phone: phone || \"\",\r\n          avatar_url: avatar || avatarFallback,\r\n        });\r\n        setPrefs({\r\n          order_updates: u?.settings?.order_updates ?? true,\r\n          marketing_email: u?.settings?.marketing_email ?? false,\r\n        });\r\n\r\n        // อัปเดต localStorage (ห้ามเก็บ fullname ที่เป็นอีเมล)\r\n        if (fullname) localStorage.setItem(\"fullname\", fullname);\r\n        if (email)    localStorage.setItem(\"email\", email);\r\n        if (phone)    localStorage.setItem(\"phone\", phone);\r\n\r\n        // แจ้ง Header ให้รีเฟรชชื่อเมื่อได้ชื่อจริง\r\n        if (fullname) window.dispatchEvent(new Event(\"profile:changed\"));\r\n      } catch (e) {\r\n        console.error(\"GET /api/me failed:\", e);\r\n        setLoadErr(e?.response?.data?.message || e?.message || \"โหลดข้อมูลผู้ใช้ล้มเหลว\");\r\n\r\n        // fallback แสดงค่าจาก localStorage ชั่วคราว (ไม่ดันอีเมลใส่ fullname)\r\n        setProfile((s) => ({\r\n          ...s,\r\n          fullname: (localStorage.getItem(\"fullname\") || s.fullname || \"\").includes(\"@\")\r\n            ? (s.fullname || \"\")\r\n            : (localStorage.getItem(\"fullname\") || s.fullname || \"ผู้ใช้งาน\"),\r\n          email: localStorage.getItem(\"email\") || s.email || \"\",\r\n          phone: localStorage.getItem(\"phone\") || s.phone || \"\",\r\n          avatar_url: s.avatar_url || avatarFallback,\r\n        }));\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    })();\r\n    return () => {\r\n      ignore = true;\r\n    };\r\n  }, [axiosClient, avatarFallback]);\r\n\r\n  // โหลดคำสั่งซื้อล่าสุดเมื่อเปิดแท็บ orders\r\n  useEffect(() => {\r\n    if (tab !== \"orders\") return;\r\n    let ignore = false;\r\n    (async () => {\r\n      try {\r\n        setOrdersLoading(true);\r\n        const r = await axiosClient.get(\"/api/orders/my\", { params: { limit: 5 } });\r\n        if (!ignore) setOrders(Array.isArray(r.data) ? r.data : r.data?.items || []);\r\n      } catch (e) {\r\n        console.error(\"GET /api/orders/my failed:\", e);\r\n      } finally {\r\n        setOrdersLoading(false);\r\n      }\r\n    })();\r\n    return () => {\r\n      ignore = true;\r\n    };\r\n  }, [tab, axiosClient]);\r\n\r\n  // ---------- handlers ----------\r\n  const onChangeProfile = (k, v) => setProfile((s) => ({ ...s, [k]: v }));\r\n  const onChangePref = (k, v) => setPrefs((s) => ({ ...s, [k]: v }));\r\n\r\n  const saveProfile = async () => {\r\n    try {\r\n      setSaving(true);\r\n      await axiosClient.put(\"/api/me\", {\r\n        fullname: profile.fullname?.trim() || null, // เก็บเป็น null ถ้าเว้นว่าง\r\n        phone: profile.phone?.trim() || null,\r\n        avatar_url: profile.avatar_url || null,\r\n      });\r\n      // sync local + แจ้ง Header เมื่อชื่อจริงเปลี่ยน\r\n      if (profile.fullname?.trim() && !/@/.test(profile.fullname)) {\r\n        localStorage.setItem(\"fullname\", profile.fullname.trim());\r\n        window.dispatchEvent(new Event(\"profile:changed\"));\r\n      }\r\n      pushToast(\"บันทึกโปรไฟล์เรียบร้อย ✅\", \"success\");\r\n    } catch (e) {\r\n      console.error(\"PUT /api/me failed:\", e);\r\n      pushToast(e?.response?.data?.message || e.message || \"บันทึกโปรไฟล์ล้มเหลว\", \"error\");\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const saveSettings = async () => {\r\n    try {\r\n      setSaving(true);\r\n      await axiosClient.put(\"/api/settings\", {\r\n        order_updates: !!prefs.order_updates,\r\n        marketing_email: !!prefs.marketing_email,\r\n      });\r\n      pushToast(\"บันทึกการตั้งค่าเรียบร้อย ✅\", \"success\");\r\n    } catch (e) {\r\n      console.error(\"PUT /api/settings failed:\", e);\r\n      pushToast(e?.response?.data?.message || e.message || \"บันทึกการตั้งค่าล้มเหลว\", \"error\");\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const logout = () => {\r\n    localStorage.removeItem(\"token\");\r\n    localStorage.removeItem(\"role\");\r\n    delete axios.defaults.headers.common[\"Authorization\"];\r\n    closeModal();\r\n    window.location.href = \"/login\";\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {/* ARIA live region */}\r\n      <div className=\"sr-only\" aria-live=\"polite\" aria-atomic=\"true\">\r\n        {toast.show ? toast.message : \"\"}\r\n      </div>\r\n\r\n      <div className=\"pm-backdrop\" onClick={closeModal} role=\"dialog\" aria-modal=\"true\">\r\n        <div className=\"pm-card\" onClick={(e) => e.stopPropagation()}>\r\n          {/* close */}\r\n          <button className=\"pm-close\" onClick={closeModal} aria-label=\"ปิด\">×</button>\r\n\r\n          {/* head */}\r\n          <div className=\"pm-head\">\r\n            <img\r\n              className=\"pm-avatar\"\r\n              src={profile.avatar_url || avatarFallback}\r\n              alt=\"avatar\"\r\n              onError={(e) => (e.currentTarget.src = process.env.PUBLIC_URL + \"/logo.png\")}\r\n            />\r\n            <div className=\"pm-head-info\">\r\n              <div className=\"pm-name\">\r\n                {loading ? \"กำลังโหลด...\" : (profile.fullname || profile.email || \"ผู้ใช้งาน\")}\r\n              </div>\r\n              {(profile.email || profile.phone) && (\r\n                <div className=\"pm-sub\">{profile.email || profile.phone}</div>\r\n              )}\r\n              {loadErr && (\r\n                <div className=\"pm-sub\" style={{ color: \"#b91c1c\" }}>\r\n                  {loadErr}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* tabs */}\r\n          <div className=\"pm-tabs\" role=\"tablist\">\r\n            <button className={`pm-tab ${tab === \"profile\" ? \"active\" : \"\"}`} onClick={() => setTab(\"profile\")} role=\"tab\">โปรไฟล์</button>\r\n            <button className={`pm-tab ${tab === \"orders\" ? \"active\" : \"\"}`} onClick={() => setTab(\"orders\")} role=\"tab\">คำสั่งซื้อของฉัน</button>\r\n            <button className={`pm-tab ${tab === \"addresses\" ? \"active\" : \"\"}`} onClick={() => setTab(\"addresses\")} role=\"tab\">ที่อยู่ของฉัน</button>\r\n            <button className={`pm-tab ${tab === \"settings\" ? \"active\" : \"\"}`} onClick={() => setTab(\"settings\")} role=\"tab\">การตั้งค่า</button>\r\n          </div>\r\n\r\n          {/* body */}\r\n          <div className=\"pm-body\">\r\n            {/* -------- โปรไฟล์ -------- */}\r\n            {tab === \"profile\" && (\r\n              <div className=\"pm-section\">\r\n                <div className=\"pm-grid\">\r\n                  <label>ชื่อ-นามสกุล</label>\r\n                  <input\r\n                    value={profile.fullname}\r\n                    onChange={(e) => onChangeProfile(\"fullname\", e.target.value)}\r\n                    placeholder=\"เช่น ศุภชัย พรหมอินทร์\"\r\n                  />\r\n\r\n                  <label>อีเมล</label>\r\n                  <input value={profile.email} disabled title=\"อีเมลไม่สามารถเปลี่ยนได้\" />\r\n\r\n                  <label>เบอร์โทร</label>\r\n                  <input\r\n                    value={profile.phone}\r\n                    onChange={(e) => onChangeProfile(\"phone\", e.target.value)}\r\n                    placeholder=\"เช่น 08x-xxx-xxxx\"\r\n                  />\r\n\r\n                  <label>รูปโปรไฟล์</label>\r\n                  <AvatarUploader\r\n                    value={profile.avatar_url || avatarFallback}\r\n                    onUploaded={(url) => onChangeProfile(\"avatar_url\", url)}\r\n                    axiosClient={axiosClient}\r\n                  />\r\n                </div>\r\n\r\n                <div className=\"pm-actions\">\r\n                  <button className=\"pm-btn\" onClick={saveProfile} disabled={saving}>\r\n                    {saving ? \"กำลังบันทึก...\" : \"บันทึกโปรไฟล์\"}\r\n                  </button>\r\n                  <button\r\n                    className=\"pm-btn pm-outline\"\r\n                    onClick={() => pushToast(\"ฟีเจอร์เปลี่ยนรหัสผ่าน: จะเพิ่มในรอบถัดไป\", \"info\")}\r\n                  >\r\n                    เปลี่ยนรหัสผ่าน\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* -------- คำสั่งซื้อ -------- */}\r\n            {tab === \"orders\" && (\r\n              <div className=\"pm-section\">\r\n                {ordersLoading ? (\r\n                  <div className=\"pm-note\">กำลังโหลดคำสั่งซื้อ…</div>\r\n                ) : orders.length === 0 ? (\r\n                  <div className=\"pm-note\">ยังไม่มีคำสั่งซื้อ</div>\r\n                ) : (\r\n                  <div className=\"pm-orders\">\r\n                    {orders.map((o) => (\r\n                      <div key={o.id || o.order_no} className=\"pm-order-item\">\r\n                        <div><b>เลขที่:</b> {o.order_no || o.id}</div>\r\n                        <div><b>สถานะ:</b> {o.status}</div>\r\n                        <div><b>ยอดรวม:</b> {Number(o.total_amount || o.total).toLocaleString(\"th-TH\")} บาท</div>\r\n                        <div><b>วันที่:</b> {o.created_at ? new Date(o.created_at).toLocaleString() : \"-\"}</div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n                <div style={{ marginTop: 8 }}>\r\n                  <Link to=\"/account/orders\" className=\"pm-link\" onClick={closeModal}>\r\n                    ดูคำสั่งซื้อทั้งหมด →\r\n                  </Link>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* -------- ที่อยู่ -------- */}\r\n            {tab === \"addresses\" && (\r\n              <div className=\"pm-section\">\r\n                <div className=\"pm-note\">จัดการที่อยู่จัดส่งของฉัน</div>\r\n                <Link to=\"/account/addresses\" className=\"pm-btn\" onClick={closeModal}>\r\n                  เปิดหน้าที่อยู่ของฉัน\r\n                </Link>\r\n              </div>\r\n            )}\r\n\r\n            {/* -------- การตั้งค่า -------- */}\r\n            {tab === \"settings\" && (\r\n              <div className=\"pm-section\">\r\n                <div className=\"pm-grid\">\r\n                  <label>รับการแจ้งเตือนสถานะคำสั่งซื้อ</label>\r\n                  <Toggle checked={prefs.order_updates} onChange={(v) => setPrefs((s) => ({ ...s, order_updates: v }))} />\r\n\r\n                  <label>รับอีเมลโปรโมชัน/ข่าวสาร</label>\r\n                  <Toggle checked={prefs.marketing_email} onChange={(v) => setPrefs((s) => ({ ...s, marketing_email: v }))} />\r\n                </div>\r\n\r\n                <div className=\"pm-note\" style={{ marginTop: 8 }}>\r\n                  ระบบจะส่งอัปเดตไปยัง {profile.email || \"อีเมลของคุณ\"} และแสดงสถานะใน “คำสั่งซื้อของฉัน”\r\n                </div>\r\n\r\n                <div className=\"pm-actions\">\r\n                  <button className=\"pm-btn\" onClick={saveSettings} disabled={saving}>\r\n                    {saving ? \"กำลังบันทึก...\" : \"บันทึกการตั้งค่า\"}\r\n                  </button>\r\n                  <button className=\"pm-btn pm-danger\" onClick={logout}>\r\n                    ออกจากระบบ\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Toast */}\r\n      <Toast toast={toast} onClose={() => setToast((t) => ({ ...t, show: false }))} />\r\n    </>\r\n  );\r\n}\r\n\r\n/* ------- UI helper: Toggle ------- */\r\nfunction Toggle({ checked, onChange }) {\r\n  return (\r\n    <button\r\n      type=\"button\"\r\n      onClick={() => onChange?.(!checked)}\r\n      className={`pm-toggle ${checked ? \"on\" : \"\"}`}\r\n      aria-pressed={checked}\r\n    >\r\n      <span className={`pm-toggle-knob ${checked ? \"on\" : \"\"}`} />\r\n    </button>\r\n  );\r\n}\r\n\r\n/* ------- อัปโหลดรูปโปรไฟล์ ------- */\r\nfunction AvatarUploader({ value, onUploaded, axiosClient }) {\r\n  const [preview, setPreview] = useState(value);\r\n  const [busy, setBusy] = useState(false);\r\n  const [err, setErr] = useState(\"\");\r\n\r\n  useEffect(() => setPreview(value), [value]);\r\n\r\n  const onPick = async (e) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    setErr(\"\");\r\n    if (!file.type.startsWith(\"image/\")) {\r\n      setErr(\"รองรับเฉพาะไฟล์รูปภาพ\");\r\n      return;\r\n    }\r\n\r\n    const blobUrl = URL.createObjectURL(file);\r\n    setPreview(blobUrl);\r\n\r\n    const fd = new FormData();\r\n    fd.append(\"file\", file);\r\n\r\n    try {\r\n      setBusy(true);\r\n      const r = await axiosClient.post(UPLOAD_ENDPOINT, fd, {\r\n        headers: { \"Content-Type\": \"multipart/form-data\" },\r\n      });\r\n      const url = r?.data?.url;\r\n      if (!url) throw new Error(\"อัปโหลดสำเร็จ แต่ไม่ได้รับ URL กลับมา\");\r\n      onUploaded?.(url);\r\n    } catch (e) {\r\n      console.error(\"UPLOAD avatar failed:\", e);\r\n      setErr(e?.response?.data?.message || e.message || \"อัปโหลดไม่สำเร็จ\");\r\n      setPreview(value);\r\n    } finally {\r\n      setBusy(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"pm-upload\">\r\n      <div className=\"pm-upload-row\">\r\n        <img\r\n          src={preview}\r\n          alt=\"avatar preview\"\r\n          className=\"pm-upload-thumb\"\r\n          onError={(ev) => (ev.currentTarget.src = process.env.PUBLIC_URL + \"/logo.png\")}\r\n        />\r\n        <label className=\"pm-btn pm-outline\" style={{ cursor: \"pointer\" }}>\r\n          {busy ? \"กำลังอัปโหลด...\" : \"เลือกไฟล์รูป\"}\r\n          <input\r\n            type=\"file\"\r\n            accept=\"image/*\"\r\n            onChange={onPick}\r\n            style={{ display: \"none\" }}\r\n            disabled={busy}\r\n          />\r\n        </label>\r\n      </div>\r\n      {err && <div className=\"pm-error\">{err}</div>}\r\n      <div className=\"pm-help\">รองรับ .jpg .png .webp</div>\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ------- Toast ------- */\r\nfunction Toast({ toast, onClose }) {\r\n  if (!toast?.show) return null;\r\n  return (\r\n    <div\r\n      className={`pm-toast pm-toast-${toast.type}`}\r\n      role=\"status\"\r\n      aria-live=\"polite\"\r\n      onClick={onClose}\r\n      title=\"คลิกเพื่อปิด\"\r\n    >\r\n      {toast.type === \"success\" ? \"✅\" : toast.type === \"error\" ? \"⚠️\" : \"ℹ️\"}&nbsp;{toast.message}\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}