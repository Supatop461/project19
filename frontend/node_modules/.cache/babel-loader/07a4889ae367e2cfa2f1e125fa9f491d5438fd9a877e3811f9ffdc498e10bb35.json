{"ast":null,"code":"var _jsxFileName = \"D:\\\\project19\\\\frontend\\\\src\\\\components\\\\VariantPicker.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from \"react\";\nimport { listInventory } from \"../lib/api\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function VariantPicker({\n  onChange,\n  // (variant) => void\n  placeholder = \"พิมพ์ชื่อสินค้า หรือ SKU เพื่อค้นหา\",\n  autoFocus = false\n}) {\n  _s();\n  const [q, setQ] = useState(\"\");\n  const [open, setOpen] = useState(false);\n  const [items, setItems] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [highlight, setHighlight] = useState(-1);\n  const boxRef = useRef(null);\n\n  // ปิด dropdown เมื่อคลิกนอกกล่อง\n  useEffect(() => {\n    const onDoc = e => {\n      var _boxRef$current;\n      if (!((_boxRef$current = boxRef.current) !== null && _boxRef$current !== void 0 && _boxRef$current.contains(e.target))) setOpen(false);\n    };\n    document.addEventListener(\"mousedown\", onDoc);\n    return () => document.removeEventListener(\"mousedown\", onDoc);\n  }, []);\n\n  // debounce 300ms แล้วค่อยยิงค้นหา\n  useEffect(() => {\n    if (!q.trim()) {\n      setItems([]);\n      return;\n    }\n    const t = setTimeout(async () => {\n      setLoading(true);\n      try {\n        const data = await listInventory({\n          scope: \"variant\",\n          search: q.trim(),\n          order: \"name_asc\",\n          limit: 10,\n          offset: 0\n        });\n        setItems(data.items || []);\n        setOpen(true);\n        setHighlight(-1);\n      } catch (e) {\n        console.error(e);\n      } finally {\n        setLoading(false);\n      }\n    }, 300);\n    return () => clearTimeout(t);\n  }, [q]);\n  const choose = it => {\n    setQ(`${it.product_name || \"\"}${it.sku ? ` (${it.sku})` : \"\"}`);\n    setOpen(false);\n    onChange && onChange(it);\n  };\n  const onKeyDown = e => {\n    if (!open) return;\n    if (e.key === \"ArrowDown\") {\n      e.preventDefault();\n      setHighlight(h => Math.min(items.length - 1, h + 1));\n    } else if (e.key === \"ArrowUp\") {\n      e.preventDefault();\n      setHighlight(h => Math.max(0, h - 1));\n    } else if (e.key === \"Enter\") {\n      if (highlight >= 0 && items[highlight]) {\n        e.preventDefault();\n        choose(items[highlight]);\n      }\n    } else if (e.key === \"Escape\") {\n      setOpen(false);\n    }\n  };\n  const money = n => new Intl.NumberFormat(\"th-TH\", {\n    style: \"currency\",\n    currency: \"THB\"\n  }).format(Number(n || 0));\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"relative\",\n    ref: boxRef,\n    children: [/*#__PURE__*/_jsxDEV(\"label\", {\n      className: \"block text-sm\",\n      children: \"\\u0E04\\u0E49\\u0E19\\u0E2B\\u0E32\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32 / SKU\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n      className: \"border rounded px-3 py-2 w-full\",\n      value: q,\n      onChange: e => setQ(e.target.value),\n      onFocus: () => {\n        if (items.length > 0) setOpen(true);\n      },\n      onKeyDown: onKeyDown,\n      placeholder: placeholder,\n      autoFocus: autoFocus\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 7\n    }, this), open && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"absolute z-50 mt-1 bg-white border rounded shadow w-full max-h-80 overflow-auto\",\n      children: [loading && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-2 text-sm text-gray-500\",\n        children: \"\\u0E01\\u0E33\\u0E25\\u0E31\\u0E07\\u0E04\\u0E49\\u0E19\\u0E2B\\u0E32\\u2026\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 23\n      }, this), !loading && items.length === 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-2 text-sm text-gray-500\",\n        children: \"\\u0E44\\u0E21\\u0E48\\u0E1E\\u0E1A\\u0E23\\u0E32\\u0E22\\u0E01\\u0E32\\u0E23\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 13\n      }, this), !loading && items.map((it, idx) => /*#__PURE__*/_jsxDEV(\"button\", {\n        className: `w-full text-left p-2 hover:bg-gray-100 ${idx === highlight ? \"bg-gray-100\" : \"\"}`,\n        onMouseEnter: () => setHighlight(idx),\n        onMouseDown: e => {\n          e.preventDefault();\n          choose(it);\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-sm font-medium\",\n          children: it.product_name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 104,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-xs text-gray-600\",\n          children: [\"SKU: \", it.sku || \"-\", \" \\u2022 \\u0E04\\u0E07\\u0E04\\u0E25\\u0E31\\u0E07: \", it.stock, it.price ? ` • ${money(it.price)}` : \"\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 105,\n          columnNumber: 15\n        }, this)]\n      }, it.variant_id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 13\n      }, this))]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 80,\n    columnNumber: 5\n  }, this);\n}\n_s(VariantPicker, \"UG2DG3yS1dXD41gVYXJhkZclO8A=\");\n_c = VariantPicker;\nvar _c;\n$RefreshReg$(_c, \"VariantPicker\");","map":{"version":3,"names":["React","useEffect","useRef","useState","listInventory","jsxDEV","_jsxDEV","VariantPicker","onChange","placeholder","autoFocus","_s","q","setQ","open","setOpen","items","setItems","loading","setLoading","highlight","setHighlight","boxRef","onDoc","e","_boxRef$current","current","contains","target","document","addEventListener","removeEventListener","trim","t","setTimeout","data","scope","search","order","limit","offset","console","error","clearTimeout","choose","it","product_name","sku","onKeyDown","key","preventDefault","h","Math","min","length","max","money","n","Intl","NumberFormat","style","currency","format","Number","className","ref","children","fileName","_jsxFileName","lineNumber","columnNumber","value","onFocus","map","idx","onMouseEnter","onMouseDown","stock","price","variant_id","_c","$RefreshReg$"],"sources":["D:/project19/frontend/src/components/VariantPicker.js"],"sourcesContent":["\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\nimport { listInventory } from \"../lib/api\";\r\n\r\nexport default function VariantPicker({\r\n  onChange,            // (variant) => void\r\n  placeholder = \"พิมพ์ชื่อสินค้า หรือ SKU เพื่อค้นหา\",\r\n  autoFocus = false,\r\n}) {\r\n  const [q, setQ] = useState(\"\");\r\n  const [open, setOpen] = useState(false);\r\n  const [items, setItems] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [highlight, setHighlight] = useState(-1);\r\n  const boxRef = useRef(null);\r\n\r\n  // ปิด dropdown เมื่อคลิกนอกกล่อง\r\n  useEffect(() => {\r\n    const onDoc = (e) => {\r\n      if (!boxRef.current?.contains(e.target)) setOpen(false);\r\n    };\r\n    document.addEventListener(\"mousedown\", onDoc);\r\n    return () => document.removeEventListener(\"mousedown\", onDoc);\r\n  }, []);\r\n\r\n  // debounce 300ms แล้วค่อยยิงค้นหา\r\n  useEffect(() => {\r\n    if (!q.trim()) { setItems([]); return; }\r\n    const t = setTimeout(async () => {\r\n      setLoading(true);\r\n      try {\r\n        const data = await listInventory({\r\n          scope: \"variant\",\r\n          search: q.trim(),\r\n          order: \"name_asc\",\r\n          limit: 10,\r\n          offset: 0,\r\n        });\r\n        setItems(data.items || []);\r\n        setOpen(true);\r\n        setHighlight(-1);\r\n      } catch (e) {\r\n        console.error(e);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    }, 300);\r\n    return () => clearTimeout(t);\r\n  }, [q]);\r\n\r\n  const choose = (it) => {\r\n    setQ(`${it.product_name || \"\"}${it.sku ? ` (${it.sku})` : \"\"}`);\r\n    setOpen(false);\r\n    onChange && onChange(it);\r\n  };\r\n\r\n  const onKeyDown = (e) => {\r\n    if (!open) return;\r\n    if (e.key === \"ArrowDown\") {\r\n      e.preventDefault();\r\n      setHighlight((h) => Math.min(items.length - 1, h + 1));\r\n    } else if (e.key === \"ArrowUp\") {\r\n      e.preventDefault();\r\n      setHighlight((h) => Math.max(0, h - 1));\r\n    } else if (e.key === \"Enter\") {\r\n      if (highlight >= 0 && items[highlight]) {\r\n        e.preventDefault();\r\n        choose(items[highlight]);\r\n      }\r\n    } else if (e.key === \"Escape\") {\r\n      setOpen(false);\r\n    }\r\n  };\r\n\r\n  const money = (n) =>\r\n    new Intl.NumberFormat(\"th-TH\", { style: \"currency\", currency: \"THB\" })\r\n      .format(Number(n || 0));\r\n\r\n  return (\r\n    <div className=\"relative\" ref={boxRef}>\r\n      <label className=\"block text-sm\">ค้นหาสินค้า / SKU</label>\r\n      <input\r\n        className=\"border rounded px-3 py-2 w-full\"\r\n        value={q}\r\n        onChange={(e) => setQ(e.target.value)}\r\n        onFocus={() => { if (items.length > 0) setOpen(true); }}\r\n        onKeyDown={onKeyDown}\r\n        placeholder={placeholder}\r\n        autoFocus={autoFocus}\r\n      />\r\n      {open && (\r\n        <div className=\"absolute z-50 mt-1 bg-white border rounded shadow w-full max-h-80 overflow-auto\">\r\n          {loading && <div className=\"p-2 text-sm text-gray-500\">กำลังค้นหา…</div>}\r\n          {!loading && items.length === 0 && (\r\n            <div className=\"p-2 text-sm text-gray-500\">ไม่พบรายการ</div>\r\n          )}\r\n          {!loading && items.map((it, idx) => (\r\n            <button\r\n              key={it.variant_id}\r\n              className={`w-full text-left p-2 hover:bg-gray-100 ${idx === highlight ? \"bg-gray-100\" : \"\"}`}\r\n              onMouseEnter={() => setHighlight(idx)}\r\n              onMouseDown={(e) => { e.preventDefault(); choose(it); }}\r\n            >\r\n              <div className=\"text-sm font-medium\">{it.product_name}</div>\r\n              <div className=\"text-xs text-gray-600\">\r\n                SKU: {it.sku || \"-\"} • คงคลัง: {it.stock}\r\n                {it.price ? ` • ${money(it.price)}` : \"\"}\r\n              </div>\r\n            </button>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}