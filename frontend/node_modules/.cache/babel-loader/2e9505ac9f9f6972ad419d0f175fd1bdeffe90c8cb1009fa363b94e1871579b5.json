{"ast":null,"code":"var _jsxFileName = \"D:\\\\project19\\\\frontend\\\\src\\\\admin\\\\AdminUnits.js\",\n  _s = $RefreshSig$();\n// src/admin/AdminUnits.js\n// ✅ หน่วยสินค้า (product_units) — โหลดจากฐานข้อมูลเท่านั้น\n// ❌ ตัดทุกอย่างที่เกี่ยวกับ is_published ออกจาก UI\n//    - ไม่แสดงคอลัมน์/ปุ่ม toggle/ฟิลเตอร์\n//    - ตอนสร้าง ส่ง is_published: true ให้ DB แบบอัตโนมัติ\n// Endpoints:\n//   GET    /api/categories?published=1\n//   GET    /api/units\n//   POST   /api/units\n//   PUT    /api/units/:code\n//   DELETE /api/units/:code\n\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { Link } from 'react-router-dom';\nimport './ProductManagement.css';\nimport { api, path } from '../lib/api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst asStr = v => v === null || v === undefined ? '' : String(v).trim();\nexport default function AdminUnits() {\n  _s();\n  const [units, setUnits] = useState([]);\n  const [categories, setCategories] = useState([]); // [{category_id, category_name}]\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n  const [error, setError] = useState('');\n\n  // ฟอร์มด้านบน\n  const [form, setForm] = useState({\n    code: '',\n    unit_name: '',\n    description: '',\n    category_id: ''\n  });\n  // โหมดแก้ไข: เก็บ code เดิมไว้ส่งใน URL ตอน PUT\n  const [editingCode, setEditingCode] = useState('');\n  const handleErr = (err, msg = 'เกิดข้อผิดพลาด') => {\n    var _err$response, _err$response2, _err$response2$data, _err$response3, _err$response3$data;\n    console.error(msg, (err === null || err === void 0 ? void 0 : (_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.data) || (err === null || err === void 0 ? void 0 : err.message) || err);\n    setError((err === null || err === void 0 ? void 0 : (_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : (_err$response2$data = _err$response2.data) === null || _err$response2$data === void 0 ? void 0 : _err$response2$data.error) || (err === null || err === void 0 ? void 0 : err.message) || msg);\n    alert((err === null || err === void 0 ? void 0 : (_err$response3 = err.response) === null || _err$response3 === void 0 ? void 0 : (_err$response3$data = _err$response3.data) === null || _err$response3$data === void 0 ? void 0 : _err$response3$data.error) || (err === null || err === void 0 ? void 0 : err.message) || msg);\n  };\n\n  /* ---------- fetch DB ---------- */\n  const fetchCategories = async () => {\n    const {\n      data\n    } = await api.get(path('/categories'), {\n      params: {\n        published: 1\n      }\n    });\n    const arr = Array.isArray(data) ? data : (data === null || data === void 0 ? void 0 : data.items) || [];\n    const norm = arr.map(c => {\n      var _ref, _ref2, _c$category_id, _ref3, _c$category_name;\n      return {\n        category_id: asStr((_ref = (_ref2 = (_c$category_id = c.category_id) !== null && _c$category_id !== void 0 ? _c$category_id : c.id) !== null && _ref2 !== void 0 ? _ref2 : c.code) !== null && _ref !== void 0 ? _ref : ''),\n        category_name: asStr((_ref3 = (_c$category_name = c.category_name) !== null && _c$category_name !== void 0 ? _c$category_name : c.name) !== null && _ref3 !== void 0 ? _ref3 : '')\n      };\n    }).filter(c => c.category_id && c.category_name);\n    setCategories(norm);\n  };\n  const fetchUnits = async () => {\n    const {\n      data\n    } = await api.get(path('/units'));\n    const arr = Array.isArray(data) ? data : (data === null || data === void 0 ? void 0 : data.items) || [];\n    const norm = arr.map(u => {\n      var _ref4, _ref5, _u$code, _ref6, _ref7, _u$unit_name, _u$description, _u$category_id;\n      return {\n        code: asStr((_ref4 = (_ref5 = (_u$code = u.code) !== null && _u$code !== void 0 ? _u$code : u.unit_code) !== null && _ref5 !== void 0 ? _ref5 : u.id) !== null && _ref4 !== void 0 ? _ref4 : ''),\n        unit_name: asStr((_ref6 = (_ref7 = (_u$unit_name = u.unit_name) !== null && _u$unit_name !== void 0 ? _u$unit_name : u.label) !== null && _ref7 !== void 0 ? _ref7 : u.name) !== null && _ref6 !== void 0 ? _ref6 : ''),\n        description: asStr((_u$description = u.description) !== null && _u$description !== void 0 ? _u$description : ''),\n        category_id: asStr((_u$category_id = u.category_id) !== null && _u$category_id !== void 0 ? _u$category_id : ''),\n        updated_at: u.updated_at,\n        created_at: u.created_at\n      };\n    }).filter(u => u.code && u.unit_name);\n    setUnits(norm);\n  };\n  useEffect(() => {\n    (async () => {\n      try {\n        setLoading(true);\n        setError('');\n        await Promise.all([fetchCategories(), fetchUnits()]);\n      } catch (err) {\n        handleErr(err, 'โหลดข้อมูลจากฐานข้อมูลไม่สำเร็จ');\n      } finally {\n        setLoading(false);\n      }\n    })();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  /* ---------- validate ---------- */\n  const validate = payload => {\n    if (!asStr(payload.code)) return 'กรอกรหัสหน่วย (code)';\n    if (!/^[a-z0-9_]+$/i.test(payload.code)) return 'code ต้องเป็นตัวอักษร/ตัวเลข/ขีดล่าง';\n    if (!asStr(payload.unit_name)) return 'กรอกชื่อหน่วย (unit_name)';\n    if (!asStr(payload.category_id)) return 'เลือกหมวดหมู่ (category_id)';\n    return '';\n  };\n\n  /* ---------- create ---------- */\n  const createUnit = async () => {\n    const payload = {\n      code: asStr(form.code).toLowerCase(),\n      unit_name: asStr(form.unit_name),\n      description: asStr(form.description),\n      category_id: asStr(form.category_id),\n      // ตั้งให้แสดงผลโดยอัตโนมัติ แต่ไม่โชว์ใน UI\n      is_published: true\n    };\n    const msg = validate(payload);\n    if (msg) return alert(msg);\n    if (units.some(u => u.code === payload.code)) {\n      return alert(`code \"${payload.code}\" มีอยู่แล้ว`);\n    }\n    try {\n      setSaving(true);\n      await api.post(path('/units'), payload);\n      await fetchUnits();\n      resetForm();\n    } catch (err) {\n      handleErr(err, 'บันทึกหน่วยสินค้าไม่สำเร็จ');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  /* ---------- edit via top form ---------- */\n  const startEdit = u => {\n    setEditingCode(u.code); // จำ code เดิมไว้สำหรับ URL ตอนเซฟ\n    setForm({\n      code: u.code,\n      unit_name: u.unit_name,\n      description: u.description || '',\n      category_id: u.category_id || ''\n    });\n    // เลื่อนขึ้นด้านบนให้เห็นฟอร์ม\n    try {\n      window.scrollTo({\n        top: 0,\n        behavior: 'smooth'\n      });\n    } catch {}\n  };\n  const cancelEdit = () => {\n    resetForm();\n  };\n  const saveEdit = async () => {\n    const payload = {\n      code: asStr(form.code).toLowerCase(),\n      unit_name: asStr(form.unit_name),\n      description: asStr(form.description),\n      category_id: asStr(form.category_id)\n      // ไม่ไปยุ่ง is_published ตอนแก้ไข\n    };\n    const msg = validate(payload);\n    if (msg) return alert(msg);\n\n    // กันชน code ซ้ำถ้าผู้ใช้แก้ code\n    if (payload.code !== editingCode && units.some(u => u.code === payload.code)) {\n      return alert(`code \"${payload.code}\" มีอยู่แล้ว`);\n    }\n    try {\n      setSaving(true);\n      await api.put(path(`/units/${editingCode}`), payload);\n      await fetchUnits();\n      resetForm();\n    } catch (err) {\n      handleErr(err, 'แก้ไขหน่วยไม่สำเร็จ');\n    } finally {\n      setSaving(false);\n    }\n  };\n  const resetForm = () => {\n    setEditingCode('');\n    setForm({\n      code: '',\n      unit_name: '',\n      description: '',\n      category_id: ''\n    });\n  };\n\n  /* ---------- delete ---------- */\n  const deleteUnit = async u => {\n    if (!window.confirm(`ลบหน่วย \"${u.unit_name}\" ?`)) return;\n    try {\n      setSaving(true);\n      await api.delete(path(`/units/${u.code}`));\n      await fetchUnits();\n    } catch (err) {\n      handleErr(err, 'ลบหน่วยไม่สำเร็จ');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  /* ---------- render ---------- */\n  if (loading) return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      padding: 12\n    },\n    children: \"\\u0E01\\u0E33\\u0E25\\u0E31\\u0E07\\u0E42\\u0E2B\\u0E25\\u0E14\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\\u0E08\\u0E32\\u0E01\\u0E10\\u0E32\\u0E19\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\\u2026\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 184,\n    columnNumber: 23\n  }, this);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"pm-page\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'flex',\n        gap: 8,\n        margin: '12px 0 20px',\n        flexWrap: 'wrap'\n      },\n      children: /*#__PURE__*/_jsxDEV(Link, {\n        to: \"/admin/products\",\n        className: \"btn btn-ghost\",\n        children: \"\\u2190 \\u0E01\\u0E25\\u0E31\\u0E1A\\u0E44\\u0E1B\\u0E08\\u0E31\\u0E14\\u0E01\\u0E32\\u0E23\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"\\u0E08\\u0E31\\u0E14\\u0E01\\u0E32\\u0E23\\u0E2B\\u0E19\\u0E48\\u0E27\\u0E22\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32 (\\u0E08\\u0E32\\u0E01\\u0E10\\u0E32\\u0E19\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25)\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 7\n    }, this), !!error && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"pm-alert pm-alert-error\",\n      style: {\n        marginTop: 8\n      },\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"pm-actions mt-8\",\n      style: {\n        flexWrap: 'wrap',\n        rowGap: 8\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        placeholder: \"code (\\u0E40\\u0E0A\\u0E48\\u0E19: piece, pot) [a-z0-9_]\",\n        value: form.code,\n        onChange: e => setForm(p => ({\n          ...p,\n          code: e.target.value\n        })),\n        style: {\n          maxWidth: 220\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        placeholder: \"unit_name (\\u0E40\\u0E0A\\u0E48\\u0E19: \\u0E0A\\u0E34\\u0E49\\u0E19, \\u0E01\\u0E23\\u0E30\\u0E16\\u0E32\\u0E07)\",\n        value: form.unit_name,\n        onChange: e => setForm(p => ({\n          ...p,\n          unit_name: e.target.value\n        })),\n        style: {\n          minWidth: 220\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n        value: form.category_id,\n        onChange: e => setForm(p => ({\n          ...p,\n          category_id: e.target.value\n        })),\n        style: {\n          minWidth: 260\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"\",\n          children: \"\\u2014 \\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\\u0E2B\\u0E21\\u0E27\\u0E14\\u0E2B\\u0E21\\u0E39\\u0E48 (category_id) \\u2014\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 11\n        }, this), categories.map(c => /*#__PURE__*/_jsxDEV(\"option\", {\n          value: c.category_id,\n          children: [c.category_id, \" \\u2014 \", c.category_name]\n        }, c.category_id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 222,\n          columnNumber: 13\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        placeholder: \"description (\\u0E16\\u0E49\\u0E32\\u0E21\\u0E35)\",\n        value: form.description,\n        onChange: e => setForm(p => ({\n          ...p,\n          description: e.target.value\n        })),\n        style: {\n          minWidth: 300\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 9\n      }, this), !editingCode ? /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"button\",\n        className: \"btn btn-primary\",\n        disabled: saving,\n        onClick: createUnit,\n        children: saving ? 'กำลังบันทึก…' : 'เพิ่มหน่วยสินค้า'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 235,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'flex',\n          gap: 8,\n          alignItems: 'center',\n          flexWrap: 'wrap'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"button\",\n          className: \"btn btn-primary\",\n          disabled: saving,\n          onClick: saveEdit,\n          children: saving ? 'กำลังบันทึก…' : 'บันทึกการแก้ไข'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 245,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"button\",\n          className: \"btn btn-ghost\",\n          onClick: cancelEdit,\n          children: \"\\u0E22\\u0E01\\u0E40\\u0E25\\u0E34\\u0E01\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 253,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            color: '#777'\n          },\n          children: [\"\\u0E01\\u0E33\\u0E25\\u0E31\\u0E07\\u0E41\\u0E01\\u0E49\\u0E44\\u0E02: \", /*#__PURE__*/_jsxDEV(\"b\", {\n            children: editingCode\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 256,\n            columnNumber: 56\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"pm-table-wrap mt-8\",\n      children: /*#__PURE__*/_jsxDEV(\"table\", {\n        className: \"pm-table pm-fixed\",\n        children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n          children: /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: [/*#__PURE__*/_jsxDEV(\"th\", {\n              style: {\n                width: 160\n              },\n              children: \"code\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 266,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              style: {\n                width: 200\n              },\n              children: \"unit_name\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 267,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"description\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 268,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              style: {\n                width: 220\n              },\n              children: \"category_id\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 269,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              style: {\n                textAlign: 'center',\n                width: 200\n              },\n              children: \"\\u0E08\\u0E31\\u0E14\\u0E01\\u0E32\\u0E23\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 270,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 265,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 264,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n          children: [units.map(u => /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: [/*#__PURE__*/_jsxDEV(\"td\", {\n              children: u.code\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 276,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"name-with-badges\",\n                children: u.unit_name\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 277,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 277,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              style: {\n                color: u.description ? '#222' : '#999'\n              },\n              children: u.description || '—'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 278,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: u.category_id || /*#__PURE__*/_jsxDEV(\"span\", {\n                style: {\n                  color: '#c00'\n                },\n                children: \"NULL (\\u0E04\\u0E27\\u0E23\\u0E41\\u0E01\\u0E49)\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 281,\n                columnNumber: 39\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 281,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              className: \"cell-actions\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"btn btn-ghost\",\n                onClick: () => startEdit(u),\n                children: \"\\u0E41\\u0E01\\u0E49\\u0E44\\u0E02\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 283,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"btn btn-danger\",\n                onClick: () => deleteUnit(u),\n                children: \"\\u0E25\\u0E1A\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 284,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 282,\n              columnNumber: 17\n            }, this)]\n          }, u.code, true, {\n            fileName: _jsxFileName,\n            lineNumber: 275,\n            columnNumber: 15\n          }, this)), units.length === 0 && /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: /*#__PURE__*/_jsxDEV(\"td\", {\n              colSpan: 5,\n              style: {\n                color: '#777'\n              },\n              children: \"\\u2014 \\u0E44\\u0E21\\u0E48\\u0E21\\u0E35\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25 \\u2014\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 289,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 289,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 273,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 263,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 187,\n    columnNumber: 5\n  }, this);\n}\n_s(AdminUnits, \"puOip2Uqare5Mh4LK3dZqrwnoXA=\");\n_c = AdminUnits;\nvar _c;\n$RefreshReg$(_c, \"AdminUnits\");","map":{"version":3,"names":["React","useEffect","useMemo","useState","Link","api","path","jsxDEV","_jsxDEV","asStr","v","undefined","String","trim","AdminUnits","_s","units","setUnits","categories","setCategories","loading","setLoading","saving","setSaving","error","setError","form","setForm","code","unit_name","description","category_id","editingCode","setEditingCode","handleErr","err","msg","_err$response","_err$response2","_err$response2$data","_err$response3","_err$response3$data","console","response","data","message","alert","fetchCategories","get","params","published","arr","Array","isArray","items","norm","map","c","_ref","_ref2","_c$category_id","_ref3","_c$category_name","id","category_name","name","filter","fetchUnits","u","_ref4","_ref5","_u$code","_ref6","_ref7","_u$unit_name","_u$description","_u$category_id","unit_code","label","updated_at","created_at","Promise","all","validate","payload","test","createUnit","toLowerCase","is_published","some","post","resetForm","startEdit","window","scrollTo","top","behavior","cancelEdit","saveEdit","put","deleteUnit","confirm","delete","style","padding","children","fileName","_jsxFileName","lineNumber","columnNumber","className","display","gap","margin","flexWrap","to","marginTop","rowGap","placeholder","value","onChange","e","p","target","maxWidth","minWidth","type","disabled","onClick","alignItems","color","width","textAlign","length","colSpan","_c","$RefreshReg$"],"sources":["D:/project19/frontend/src/admin/AdminUnits.js"],"sourcesContent":["// src/admin/AdminUnits.js\r\n// ✅ หน่วยสินค้า (product_units) — โหลดจากฐานข้อมูลเท่านั้น\r\n// ❌ ตัดทุกอย่างที่เกี่ยวกับ is_published ออกจาก UI\r\n//    - ไม่แสดงคอลัมน์/ปุ่ม toggle/ฟิลเตอร์\r\n//    - ตอนสร้าง ส่ง is_published: true ให้ DB แบบอัตโนมัติ\r\n// Endpoints:\r\n//   GET    /api/categories?published=1\r\n//   GET    /api/units\r\n//   POST   /api/units\r\n//   PUT    /api/units/:code\r\n//   DELETE /api/units/:code\r\n\r\nimport React, { useEffect, useMemo, useState } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport './ProductManagement.css';\r\nimport { api, path } from '../lib/api';\r\n\r\nconst asStr = (v) => (v === null || v === undefined) ? '' : String(v).trim();\r\n\r\nexport default function AdminUnits() {\r\n  const [units, setUnits] = useState([]);\r\n  const [categories, setCategories] = useState([]); // [{category_id, category_name}]\r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState(false);\r\n  const [error, setError] = useState('');\r\n\r\n  // ฟอร์มด้านบน\r\n  const [form, setForm] = useState({\r\n    code: '',\r\n    unit_name: '',\r\n    description: '',\r\n    category_id: '',\r\n  });\r\n  // โหมดแก้ไข: เก็บ code เดิมไว้ส่งใน URL ตอน PUT\r\n  const [editingCode, setEditingCode] = useState('');\r\n\r\n  const handleErr = (err, msg = 'เกิดข้อผิดพลาด') => {\r\n    console.error(msg, err?.response?.data || err?.message || err);\r\n    setError(err?.response?.data?.error || err?.message || msg);\r\n    alert(err?.response?.data?.error || err?.message || msg);\r\n  };\r\n\r\n  /* ---------- fetch DB ---------- */\r\n  const fetchCategories = async () => {\r\n    const { data } = await api.get(path('/categories'), { params: { published: 1 } });\r\n    const arr = Array.isArray(data) ? data : (data?.items || []);\r\n    const norm = arr.map((c) => ({\r\n      category_id: asStr(c.category_id ?? c.id ?? c.code ?? ''),\r\n      category_name: asStr(c.category_name ?? c.name ?? ''),\r\n    })).filter((c) => c.category_id && c.category_name);\r\n    setCategories(norm);\r\n  };\r\n\r\n  const fetchUnits = async () => {\r\n    const { data } = await api.get(path('/units'));\r\n    const arr = Array.isArray(data) ? data : (data?.items || []);\r\n    const norm = arr.map((u) => ({\r\n      code: asStr(u.code ?? u.unit_code ?? u.id ?? ''),\r\n      unit_name: asStr(u.unit_name ?? u.label ?? u.name ?? ''),\r\n      description: asStr(u.description ?? ''),\r\n      category_id: asStr(u.category_id ?? ''),\r\n      updated_at: u.updated_at,\r\n      created_at: u.created_at,\r\n    })).filter((u) => u.code && u.unit_name);\r\n    setUnits(norm);\r\n  };\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        setLoading(true);\r\n        setError('');\r\n        await Promise.all([fetchCategories(), fetchUnits()]);\r\n      } catch (err) {\r\n        handleErr(err, 'โหลดข้อมูลจากฐานข้อมูลไม่สำเร็จ');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    })();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  /* ---------- validate ---------- */\r\n  const validate = (payload) => {\r\n    if (!asStr(payload.code)) return 'กรอกรหัสหน่วย (code)';\r\n    if (!/^[a-z0-9_]+$/i.test(payload.code)) return 'code ต้องเป็นตัวอักษร/ตัวเลข/ขีดล่าง';\r\n    if (!asStr(payload.unit_name)) return 'กรอกชื่อหน่วย (unit_name)';\r\n    if (!asStr(payload.category_id)) return 'เลือกหมวดหมู่ (category_id)';\r\n    return '';\r\n  };\r\n\r\n  /* ---------- create ---------- */\r\n  const createUnit = async () => {\r\n    const payload = {\r\n      code: asStr(form.code).toLowerCase(),\r\n      unit_name: asStr(form.unit_name),\r\n      description: asStr(form.description),\r\n      category_id: asStr(form.category_id),\r\n      // ตั้งให้แสดงผลโดยอัตโนมัติ แต่ไม่โชว์ใน UI\r\n      is_published: true,\r\n    };\r\n    const msg = validate(payload);\r\n    if (msg) return alert(msg);\r\n    if (units.some((u) => u.code === payload.code)) {\r\n      return alert(`code \"${payload.code}\" มีอยู่แล้ว`);\r\n    }\r\n    try {\r\n      setSaving(true);\r\n      await api.post(path('/units'), payload);\r\n      await fetchUnits();\r\n      resetForm();\r\n    } catch (err) {\r\n      handleErr(err, 'บันทึกหน่วยสินค้าไม่สำเร็จ');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  /* ---------- edit via top form ---------- */\r\n  const startEdit = (u) => {\r\n    setEditingCode(u.code); // จำ code เดิมไว้สำหรับ URL ตอนเซฟ\r\n    setForm({\r\n      code: u.code,\r\n      unit_name: u.unit_name,\r\n      description: u.description || '',\r\n      category_id: u.category_id || '',\r\n    });\r\n    // เลื่อนขึ้นด้านบนให้เห็นฟอร์ม\r\n    try { window.scrollTo({ top: 0, behavior: 'smooth' }); } catch {}\r\n  };\r\n\r\n  const cancelEdit = () => {\r\n    resetForm();\r\n  };\r\n\r\n  const saveEdit = async () => {\r\n    const payload = {\r\n      code: asStr(form.code).toLowerCase(),\r\n      unit_name: asStr(form.unit_name),\r\n      description: asStr(form.description),\r\n      category_id: asStr(form.category_id),\r\n      // ไม่ไปยุ่ง is_published ตอนแก้ไข\r\n    };\r\n    const msg = validate(payload);\r\n    if (msg) return alert(msg);\r\n\r\n    // กันชน code ซ้ำถ้าผู้ใช้แก้ code\r\n    if (payload.code !== editingCode && units.some((u) => u.code === payload.code)) {\r\n      return alert(`code \"${payload.code}\" มีอยู่แล้ว`);\r\n    }\r\n\r\n    try {\r\n      setSaving(true);\r\n      await api.put(path(`/units/${editingCode}`), payload);\r\n      await fetchUnits();\r\n      resetForm();\r\n    } catch (err) {\r\n      handleErr(err, 'แก้ไขหน่วยไม่สำเร็จ');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const resetForm = () => {\r\n    setEditingCode('');\r\n    setForm({ code: '', unit_name: '', description: '', category_id: '' });\r\n  };\r\n\r\n  /* ---------- delete ---------- */\r\n  const deleteUnit = async (u) => {\r\n    if (!window.confirm(`ลบหน่วย \"${u.unit_name}\" ?`)) return;\r\n    try {\r\n      setSaving(true);\r\n      await api.delete(path(`/units/${u.code}`));\r\n      await fetchUnits();\r\n    } catch (err) {\r\n      handleErr(err, 'ลบหน่วยไม่สำเร็จ');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  /* ---------- render ---------- */\r\n  if (loading) return <div style={{ padding: 12 }}>กำลังโหลดข้อมูลจากฐานข้อมูล…</div>;\r\n\r\n  return (\r\n    <div className=\"pm-page\">\r\n      {/* ปุ่มกลับ */}\r\n      <div style={{display:'flex', gap:8, margin:'12px 0 20px', flexWrap:'wrap'}}>\r\n        <Link to=\"/admin/products\" className=\"btn btn-ghost\">← กลับไปจัดการสินค้า</Link>\r\n      </div>\r\n\r\n      <h2>จัดการหน่วยสินค้า (จากฐานข้อมูล)</h2>\r\n\r\n      {!!error && (\r\n        <div className=\"pm-alert pm-alert-error\" style={{ marginTop: 8 }}>\r\n          {error}\r\n        </div>\r\n      )}\r\n\r\n      {/* ฟอร์มเพิ่ม/แก้ไข (ด้านบน) */}\r\n      <div className=\"pm-actions mt-8\" style={{ flexWrap:'wrap', rowGap: 8 }}>\r\n        <input\r\n          placeholder=\"code (เช่น: piece, pot) [a-z0-9_]\"\r\n          value={form.code}\r\n          onChange={(e)=>setForm((p)=>({ ...p, code: e.target.value }))}\r\n          style={{ maxWidth:220 }}\r\n        />\r\n        <input\r\n          placeholder=\"unit_name (เช่น: ชิ้น, กระถาง)\"\r\n          value={form.unit_name}\r\n          onChange={(e)=>setForm((p)=>({ ...p, unit_name: e.target.value }))}\r\n          style={{ minWidth:220 }}\r\n        />\r\n        <select\r\n          value={form.category_id}\r\n          onChange={(e)=>setForm((p)=>({ ...p, category_id: e.target.value }))}\r\n          style={{ minWidth:260 }}\r\n        >\r\n          <option value=\"\">— เลือกหมวดหมู่ (category_id) —</option>\r\n          {categories.map(c => (\r\n            <option key={c.category_id} value={c.category_id}>\r\n              {c.category_id} — {c.category_name}\r\n            </option>\r\n          ))}\r\n        </select>\r\n        <input\r\n          placeholder=\"description (ถ้ามี)\"\r\n          value={form.description}\r\n          onChange={(e)=>setForm((p)=>({ ...p, description: e.target.value }))}\r\n          style={{ minWidth:300 }}\r\n        />\r\n\r\n        {!editingCode ? (\r\n          <button\r\n            type=\"button\"\r\n            className=\"btn btn-primary\"\r\n            disabled={saving}\r\n            onClick={createUnit}\r\n          >\r\n            {saving ? 'กำลังบันทึก…' : 'เพิ่มหน่วยสินค้า'}\r\n          </button>\r\n        ) : (\r\n          <div style={{ display:'flex', gap:8, alignItems:'center', flexWrap:'wrap' }}>\r\n            <button\r\n              type=\"button\"\r\n              className=\"btn btn-primary\"\r\n              disabled={saving}\r\n              onClick={saveEdit}\r\n            >\r\n              {saving ? 'กำลังบันทึก…' : 'บันทึกการแก้ไข'}\r\n            </button>\r\n            <button type=\"button\" className=\"btn btn-ghost\" onClick={cancelEdit}>\r\n              ยกเลิก\r\n            </button>\r\n            <span style={{ color:'#777' }}>กำลังแก้ไข: <b>{editingCode}</b></span>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* ตาราง */}\r\n      <div className=\"pm-table-wrap mt-8\">\r\n        <table className=\"pm-table pm-fixed\">\r\n          <thead>\r\n            <tr>\r\n              <th style={{width:160}}>code</th>\r\n              <th style={{width:200}}>unit_name</th>\r\n              <th>description</th>\r\n              <th style={{width:220}}>category_id</th>\r\n              <th style={{textAlign:'center', width:200}}>จัดการ</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {units.map((u) => (\r\n              <tr key={u.code}>\r\n                <td>{u.code}</td>\r\n                <td><span className=\"name-with-badges\">{u.unit_name}</span></td>\r\n                <td style={{ color: u.description ? '#222' : '#999' }}>\r\n                  {u.description || '—'}\r\n                </td>\r\n                <td>{u.category_id || <span style={{ color:'#c00' }}>NULL (ควรแก้)</span>}</td>\r\n                <td className=\"cell-actions\">\r\n                  <button className=\"btn btn-ghost\" onClick={()=>startEdit(u)}>แก้ไข</button>\r\n                  <button className=\"btn btn-danger\" onClick={()=>deleteUnit(u)}>ลบ</button>\r\n                </td>\r\n              </tr>\r\n            ))}\r\n            {units.length === 0 && (\r\n              <tr><td colSpan={5} style={{ color:'#777' }}>— ไม่มีข้อมูล —</td></tr>\r\n            )}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}