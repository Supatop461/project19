{"ast":null,"code":"// src/lib/api.js\n// รวมศูนย์การเรียก API ฝั่ง frontend ให้สะอาด/ปลอดภัย/ยืดหยุ่น\n// ✅ มี interceptor แนบ Authorization ให้ทุกคำสั่ง (แก้เคส PUT ไม่ติด token)\n\nimport axios from 'axios';\n\n/* ---------- Base URL ---------- */\nconst VITE = typeof import.meta !== 'undefined' && import.meta.env || {};\nexport const BASE_URL = VITE.VITE_API_BASE || process.env.REACT_APP_API_BASE || 'http://localhost:3001/api';\n\n/* ---------- Path helper ---------- */\nexport const path = p => {\n  const str = String(p || '');\n  if (/^https?:\\/\\//i.test(str) || /^\\/\\//.test(str)) return str;\n  const base = String((BASE_URL || '').replace(/\\/+$/, ''));\n  const endsWithApi = base.endsWith('/api');\n  let s = '/' + str.replace(/^\\/+/, '');\n  s = s.replace(/\\/+/g, '/');\n  return endsWithApi ? s.replace(/^\\/api\\//, '/') : s.startsWith('/api/') ? s : '/api' + s;\n};\n\n/* ---------- Axios instance ---------- */\nexport const api = axios.create({\n  baseURL: BASE_URL,\n  withCredentials: false\n});\n\n/* ---------- Attach Authorization automatically ---------- */\napi.interceptors.request.use(config => {\n  try {\n    const token = localStorage.getItem('token') || sessionStorage.getItem('token') || typeof window !== 'undefined' && window.__TOKEN__;\n    if (token) {\n      // ระวังทับ header เดิม\n      config.headers = config.headers || {};\n      if (!config.headers.Authorization) {\n        config.headers.Authorization = `Bearer ${token}`;\n      }\n    }\n  } catch {}\n  return config;\n}, error => Promise.reject(error));\n\n/* ---------- Helper: absolute image URL ---------- */\nexport const absUrl = u => {\n  if (!u) return '';\n  const s = String(u);\n  if (/^(https?:)?\\/\\//i.test(s) || s.startsWith('blob:') || s.startsWith('data:')) return s;\n\n  // แปลง /uploads/... ให้เป็น origin ของ backend\n  const base = String((BASE_URL || '').replace(/\\/+$/, ''));\n  const backendOrigin = base.endsWith('/api') ? base.slice(0, -4) : base;\n  if (s.startsWith('/')) return backendOrigin + s;\n  return `${backendOrigin}/${s.replace(/^\\/+/, '')}`;\n};\n\n/* ---------- Shorthand methods ---------- */\nexport const get = (p, cfg) => api.get(path(p), cfg);\nexport const post = (p, data, cfg) => api.post(path(p), data, cfg);\nexport const put = (p, data, cfg) => api.put(path(p), data, cfg);\nexport const del = (p, cfg) => api.delete(path(p), cfg);\nexport default api;","map":{"version":3,"names":["axios","VITE","import","meta","env","BASE_URL","VITE_API_BASE","process","REACT_APP_API_BASE","path","p","str","String","test","base","replace","endsWithApi","endsWith","s","startsWith","api","create","baseURL","withCredentials","interceptors","request","use","config","token","localStorage","getItem","sessionStorage","window","__TOKEN__","headers","Authorization","error","Promise","reject","absUrl","u","backendOrigin","slice","get","cfg","post","data","put","del","delete"],"sources":["D:/project19/frontend/src/lib/api.js"],"sourcesContent":["// src/lib/api.js\r\n// รวมศูนย์การเรียก API ฝั่ง frontend ให้สะอาด/ปลอดภัย/ยืดหยุ่น\r\n// ✅ มี interceptor แนบ Authorization ให้ทุกคำสั่ง (แก้เคส PUT ไม่ติด token)\r\n\r\nimport axios from 'axios';\r\n\r\n/* ---------- Base URL ---------- */\r\nconst VITE = (typeof import.meta !== 'undefined' && import.meta.env) || {};\r\nexport const BASE_URL =\r\n  VITE.VITE_API_BASE ||\r\n  process.env.REACT_APP_API_BASE ||\r\n  'http://localhost:3001/api';\r\n\r\n/* ---------- Path helper ---------- */\r\nexport const path = (p) => {\r\n  const str = String(p || '');\r\n  if (/^https?:\\/\\//i.test(str) || /^\\/\\//.test(str)) return str;\r\n\r\n  const base = String((BASE_URL || '').replace(/\\/+$/, ''));\r\n  const endsWithApi = base.endsWith('/api');\r\n\r\n  let s = '/' + str.replace(/^\\/+/, '');\r\n  s = s.replace(/\\/+/g, '/');\r\n\r\n  return endsWithApi\r\n    ? s.replace(/^\\/api\\//, '/')\r\n    : (s.startsWith('/api/') ? s : '/api' + s);\r\n};\r\n\r\n/* ---------- Axios instance ---------- */\r\nexport const api = axios.create({\r\n  baseURL: BASE_URL,\r\n  withCredentials: false,\r\n});\r\n\r\n/* ---------- Attach Authorization automatically ---------- */\r\napi.interceptors.request.use(\r\n  (config) => {\r\n    try {\r\n      const token =\r\n        localStorage.getItem('token') ||\r\n        sessionStorage.getItem('token') ||\r\n        (typeof window !== 'undefined' && window.__TOKEN__);\r\n\r\n      if (token) {\r\n        // ระวังทับ header เดิม\r\n        config.headers = config.headers || {};\r\n        if (!config.headers.Authorization) {\r\n          config.headers.Authorization = `Bearer ${token}`;\r\n        }\r\n      }\r\n    } catch {}\r\n    return config;\r\n  },\r\n  (error) => Promise.reject(error)\r\n);\r\n\r\n/* ---------- Helper: absolute image URL ---------- */\r\nexport const absUrl = (u) => {\r\n  if (!u) return '';\r\n  const s = String(u);\r\n  if (/^(https?:)?\\/\\//i.test(s) || s.startsWith('blob:') || s.startsWith('data:')) return s;\r\n\r\n  // แปลง /uploads/... ให้เป็น origin ของ backend\r\n  const base = String((BASE_URL || '').replace(/\\/+$/, ''));\r\n  const backendOrigin = base.endsWith('/api') ? base.slice(0, -4) : base;\r\n  if (s.startsWith('/')) return backendOrigin + s;\r\n  return `${backendOrigin}/${s.replace(/^\\/+/, '')}`;\r\n};\r\n\r\n/* ---------- Shorthand methods ---------- */\r\nexport const get  = (p, cfg) => api.get(path(p), cfg);\r\nexport const post = (p, data, cfg) => api.post(path(p), data, cfg);\r\nexport const put  = (p, data, cfg) => api.put(path(p), data, cfg);\r\nexport const del  = (p, cfg) => api.delete(path(p), cfg);\r\n\r\nexport default api;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}