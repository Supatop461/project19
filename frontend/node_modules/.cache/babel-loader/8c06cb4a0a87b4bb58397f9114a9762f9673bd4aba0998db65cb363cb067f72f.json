{"ast":null,"code":"var _jsxFileName = \"D:\\\\project19\\\\frontend\\\\src\\\\pages\\\\ProductDetail.js\",\n  _s = $RefreshSig$();\n// frontend/src/pages/ProductDetail.js\nimport React, { useEffect, useMemo, useState, useCallback } from \"react\";\nimport { useParams, Link } from \"react-router-dom\";\nimport { api, path } from \"../lib/api\";\nimport { addItem } from \"../lib/cart\";\n\n// ---------- helpers ----------\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst asInt = v => v === null || v === undefined || v === \"\" ? null : parseInt(v, 10);\nconst fmtBaht = n => {\n  if (n === null || n === undefined || isNaN(n)) return \"—\";\n  try {\n    return new Intl.NumberFormat(\"th-TH\", {\n      style: \"currency\",\n      currency: \"THB\",\n      maximumFractionDigits: 2\n    }).format(n);\n  } catch {\n    return `${n} บาท`;\n  }\n};\nconst ensureAbsUrl = u => {\n  if (!u) return \"\";\n  // ถ้า backend ส่ง path เปล่า ๆ มา (เช่น /uploads/xxx.jpg) ให้ prefix ด้วย API_ORIGIN ที่ config ไว้ใน api.js\n  const ORIGIN = path && path.API_ORIGIN || process.env.REACT_APP_API_ORIGIN || \"\";\n  if (/^https?:\\/\\//i.test(u)) return u;\n  if (ORIGIN && u.startsWith(\"/\")) return ORIGIN + u;\n  return u;\n};\n\n// แปลงโครงข้อมูล variants ที่อาจต่าง schema กัน ให้เป็นรูปแบบเดียว\nfunction normalizeVariants(rawVariants) {\n  if (!Array.isArray(rawVariants)) return [];\n  return rawVariants.map(v => {\n    var _ref, _v$variant_id, _ref2, _ref3, _v$sku, _ref4, _ref5, _ref6, _v$price, _asInt, _ref7, _ref8, _ref9, _ref0, _v$stock, _ref11, _ref12, _v$image_url, _ref13, _v$is_active;\n    return {\n      variant_id: asInt((_ref = (_v$variant_id = v.variant_id) !== null && _v$variant_id !== void 0 ? _v$variant_id : v.id) !== null && _ref !== void 0 ? _ref : v.product_variant_id),\n      sku: ((_ref2 = (_ref3 = (_v$sku = v.sku) !== null && _v$sku !== void 0 ? _v$sku : v.SKU) !== null && _ref3 !== void 0 ? _ref3 : v.code) !== null && _ref2 !== void 0 ? _ref2 : \"\").toString(),\n      price: Number((_ref4 = (_ref5 = (_ref6 = (_v$price = v.price) !== null && _v$price !== void 0 ? _v$price : v.variant_price) !== null && _ref6 !== void 0 ? _ref6 : v.sale_price) !== null && _ref5 !== void 0 ? _ref5 : v.base_price) !== null && _ref4 !== void 0 ? _ref4 : 0),\n      stock: (_asInt = asInt((_ref7 = (_ref8 = (_ref9 = (_ref0 = (_v$stock = v.stock) !== null && _v$stock !== void 0 ? _v$stock : v.qty) !== null && _ref0 !== void 0 ? _ref0 : v.quantity) !== null && _ref9 !== void 0 ? _ref9 : v.live_stock) !== null && _ref8 !== void 0 ? _ref8 : v.on_hand) !== null && _ref7 !== void 0 ? _ref7 : 0)) !== null && _asInt !== void 0 ? _asInt : 0,\n      // ออปชั่นอาจส่งมาเป็น {color:\"แดง\", size:\"L\"} หรือ [{name:\"สี\",value:\"แดง\"}, ...]\n      options: Array.isArray(v.options) ? v.options.reduce((acc, it) => {\n        var _ref1, _it$name, _ref10, _it$value;\n        const k = ((_ref1 = (_it$name = it === null || it === void 0 ? void 0 : it.name) !== null && _it$name !== void 0 ? _it$name : it === null || it === void 0 ? void 0 : it.option_name) !== null && _ref1 !== void 0 ? _ref1 : \"\").toString();\n        const val = ((_ref10 = (_it$value = it === null || it === void 0 ? void 0 : it.value) !== null && _it$value !== void 0 ? _it$value : it === null || it === void 0 ? void 0 : it.option_value) !== null && _ref10 !== void 0 ? _ref10 : \"\").toString();\n        if (k) acc[k] = val;\n        return acc;\n      }, {}) : typeof v.options === \"object\" && v.options ? v.options : {\n        ...(v.color ? {\n          สี: v.color\n        } : {}),\n        ...(v.size ? {\n          ขนาด: v.size\n        } : {})\n      },\n      image_url: ensureAbsUrl((_ref11 = (_ref12 = (_v$image_url = v.image_url) !== null && _v$image_url !== void 0 ? _v$image_url : v.image) !== null && _ref12 !== void 0 ? _ref12 : v.thumbnail) !== null && _ref11 !== void 0 ? _ref11 : \"\"),\n      is_active: (_ref13 = (_v$is_active = v.is_active) !== null && _v$is_active !== void 0 ? _v$is_active : v.active) !== null && _ref13 !== void 0 ? _ref13 : true\n    };\n  });\n}\n\n// รวม key ออปชั่นเป็น signature เพื่อเทียบหา variant\nconst optionSignature = obj => Object.entries(obj || {}).map(([k, v]) => `${k}=${v}`).sort().join(\"|\");\n\n// ---------- หน้าแสดงรายละเอียด ----------\nexport default function ProductDetail() {\n  _s();\n  var _ref19, _currentVariant$price, _currentVariant$stock;\n  const {\n    id\n  } = useParams(); // /products/:id\n  const [loading, setLoading] = useState(true);\n  const [product, setProduct] = useState(null);\n  const [variants, setVariants] = useState([]);\n  const [images, setImages] = useState([]); // รูปสินค้า (รวมจากตัวแม่ + จากตัวเลือกถ้ามี)\n  const [qty, setQty] = useState(1);\n\n  // state สำหรับเลือกออปชั่น\n  const [chosenOptions, setChosenOptions] = useState({});\n  const [selectedVariantId, setSelectedVariantId] = useState(null);\n\n  // ดึงข้อมูลสินค้า (กันหลายสกีมา/หลายเอ็นด์พอยต์)\n  useEffect(() => {\n    let cancelled = false;\n    async function load() {\n      setLoading(true);\n      try {\n        var _p$product_id, _ref14, _ref15, _p$price, _ref16, _ref17, _p$stock, _ref18, _p$is_published, _first$variant_id;\n        // 1) ดึงตัวแม่\n        const res = await api.get(`${path.products}/${id}`);\n        const p = (res === null || res === void 0 ? void 0 : res.data) || res;\n        if (cancelled) return;\n\n        // 2) พยายามดึง variants แยก (ถ้ามีเอ็นด์พอยต์) ไม่งั้นลองอ่านจาก p.variants\n        let v = [];\n        try {\n          const v1 = await api.get(`${path.products}/${id}/variants`);\n          v = normalizeVariants((v1 === null || v1 === void 0 ? void 0 : v1.data) || v1);\n        } catch {\n          v = normalizeVariants((p === null || p === void 0 ? void 0 : p.variants) || []);\n        }\n\n        // 3) รวมรูป\n        const imgs = (Array.isArray(p === null || p === void 0 ? void 0 : p.images) ? p.images : []).map(it => ({\n          url: ensureAbsUrl((it === null || it === void 0 ? void 0 : it.url) || (it === null || it === void 0 ? void 0 : it.image_url) || \"\"),\n          alt: (it === null || it === void 0 ? void 0 : it.alt_text) || (p === null || p === void 0 ? void 0 : p.product_name) || \"product\"\n        })).filter(x => x.url) || [];\n\n        // ถ้า variant มีรูป ให้เอามารวมเป็นแกลเลอรีท้าย ๆ\n        const vImgs = v.map(vv => vv.image_url ? {\n          url: vv.image_url,\n          alt: vv.sku || \"variant\"\n        } : null).filter(Boolean);\n        setProduct({\n          product_id: asInt((_p$product_id = p.product_id) !== null && _p$product_id !== void 0 ? _p$product_id : p.id),\n          product_name: p.product_name || p.name || \"สินค้า\",\n          description: p.description || p.detail || \"\",\n          price: Number((_ref14 = (_ref15 = (_p$price = p.price) !== null && _p$price !== void 0 ? _p$price : p.base_price) !== null && _ref15 !== void 0 ? _ref15 : p.sale_price) !== null && _ref14 !== void 0 ? _ref14 : 0),\n          // สต็อกรวมต่อ “สินค้า” (อิงจาก view ฝั่ง backend แล้วแต่ระบบ) ถ้าไม่มีจะไม่แสดง\n          stock: asInt((_ref16 = (_ref17 = (_p$stock = p.stock) !== null && _p$stock !== void 0 ? _p$stock : p.live_stock) !== null && _ref17 !== void 0 ? _ref17 : p.total_stock) !== null && _ref16 !== void 0 ? _ref16 : null),\n          image_url: ensureAbsUrl(p.image_url || p.thumbnail || \"\"),\n          category_name: p.category_name || p.category || \"\",\n          is_published: (_ref18 = (_p$is_published = p.is_published) !== null && _p$is_published !== void 0 ? _p$is_published : p.published) !== null && _ref18 !== void 0 ? _ref18 : true\n        });\n        setVariants(v);\n        setImages((imgs.length > 0 ? imgs : p.image_url ? [{\n          url: ensureAbsUrl(p.image_url),\n          alt: p.product_name\n        }] : []).concat(vImgs));\n\n        // 4) เตรียมค่าออปชั่นเริ่มต้น (เลือก option แรกของแต่ละประเภท)\n        const optionKeys = collectOptionKeys(v);\n        const init = {};\n        optionKeys.forEach(k => {\n          const vals = uniqueOptionValues(v, k);\n          if (vals.length) init[k] = vals[0];\n        });\n        setChosenOptions(init);\n\n        // 5) จิ้มหา variant เริ่มต้น\n        const first = findVariantByOptions(v, init);\n        setSelectedVariantId((_first$variant_id = first === null || first === void 0 ? void 0 : first.variant_id) !== null && _first$variant_id !== void 0 ? _first$variant_id : null);\n      } catch (err) {\n        console.error(\"Load product failed:\", err);\n      } finally {\n        if (!cancelled) setLoading(false);\n      }\n    }\n    load();\n    return () => {\n      cancelled = true;\n    };\n  }, [id]);\n\n  // รวมคีย์ออปชั่นที่มีอยู่ทั้งหมดจาก variants\n  const optionKeys = useMemo(() => collectOptionKeys(variants), [variants]);\n\n  // คำนวณ variant ที่เลือกปัจจุบัน\n  const currentVariant = useMemo(() => {\n    if (!variants.length) return null;\n    if (selectedVariantId) return variants.find(x => x.variant_id === selectedVariantId) || null;\n    if (optionKeys.length) return findVariantByOptions(variants, chosenOptions);\n    return null;\n  }, [variants, selectedVariantId, chosenOptions, optionKeys]);\n  const priceToShow = (_ref19 = (_currentVariant$price = currentVariant === null || currentVariant === void 0 ? void 0 : currentVariant.price) !== null && _currentVariant$price !== void 0 ? _currentVariant$price : product === null || product === void 0 ? void 0 : product.price) !== null && _ref19 !== void 0 ? _ref19 : 0;\n  const skuToShow = (currentVariant === null || currentVariant === void 0 ? void 0 : currentVariant.sku) || \"\";\n  const stockToShow = (_currentVariant$stock = currentVariant === null || currentVariant === void 0 ? void 0 : currentVariant.stock) !== null && _currentVariant$stock !== void 0 ? _currentVariant$stock : (product === null || product === void 0 ? void 0 : product.stock) !== null && (product === null || product === void 0 ? void 0 : product.stock) !== undefined ? product.stock : null;\n  const mainImage = useMemo(() => {\n    if (currentVariant !== null && currentVariant !== void 0 && currentVariant.image_url) return currentVariant.image_url;\n    if (images !== null && images !== void 0 && images.length) return images[0].url;\n    return (product === null || product === void 0 ? void 0 : product.image_url) || \"\";\n  }, [currentVariant, images, product]);\n  const canAdd = useMemo(() => {\n    const s = stockToShow;\n    if (s === null || s === undefined) return true; // ไม่ทราบสต็อก = อนุญาต\n    return s > 0;\n  }, [stockToShow]);\n\n  // เลือกออปชั่น\n  const chooseOption = useCallback((key, val) => {\n    var _v$variant_id2;\n    const next = {\n      ...chosenOptions,\n      [key]: val\n    };\n    setChosenOptions(next);\n    const v = findVariantByOptions(variants, next);\n    setSelectedVariantId((_v$variant_id2 = v === null || v === void 0 ? void 0 : v.variant_id) !== null && _v$variant_id2 !== void 0 ? _v$variant_id2 : null);\n  }, [chosenOptions, variants]);\n\n  // เพิ่มลงตะกร้า\n  const onAddToCart = useCallback(() => {\n    if (!product) return;\n    const pid = product.product_id;\n    const vid = (currentVariant === null || currentVariant === void 0 ? void 0 : currentVariant.variant_id) || null;\n    addToCart({\n      product_id: pid,\n      variant_id: vid,\n      name: product.product_name,\n      sku: skuToShow || undefined,\n      price: priceToShow,\n      qty: qty,\n      image_url: mainImage,\n      options: chosenOptions\n    });\n    alert(\"เพิ่มลงตะกร้าแล้ว\");\n  }, [product, currentVariant, priceToShow, skuToShow, qty, mainImage, chosenOptions]);\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"max-w-5xl mx-auto p-4\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"animate-pulse h-6 w-32 bg-gray-200 rounded mb-4\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"grid md:grid-cols-2 gap-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"h-72 bg-gray-200 rounded-xl\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 215,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"h-5 w-48 bg-gray-200 rounded mb-3\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 217,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"h-5 w-60 bg-gray-200 rounded mb-6\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 218,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"h-10 w-40 bg-gray-200 rounded\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 219,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 216,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 7\n    }, this);\n  }\n  if (!product) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"max-w-5xl mx-auto p-6\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-red-700\",\n        children: \"\\u0E44\\u0E21\\u0E48\\u0E1E\\u0E1A\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Link, {\n        to: \"/products\",\n        className: \"text-green-700 underline\",\n        children: \"\\u0E22\\u0E49\\u0E2D\\u0E19\\u0E01\\u0E25\\u0E31\\u0E1A\\u0E2B\\u0E19\\u0E49\\u0E32\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"max-w-5xl mx-auto p-4 md:p-6\",\n    children: [/*#__PURE__*/_jsxDEV(\"nav\", {\n      className: \"text-sm mb-4 text-gray-600\",\n      children: [/*#__PURE__*/_jsxDEV(Link, {\n        to: \"/\",\n        className: \"hover:underline\",\n        children: \"\\u0E2B\\u0E19\\u0E49\\u0E32\\u0E41\\u0E23\\u0E01\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"mx-2\",\n        children: \"/\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 240,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Link, {\n        to: \"/products\",\n        className: \"hover:underline\",\n        children: \"\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32\\u0E17\\u0E31\\u0E49\\u0E07\\u0E2B\\u0E21\\u0E14\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 241,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"mx-2\",\n        children: \"/\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 242,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"text-gray-900\",\n        children: product.product_name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"grid md:grid-cols-2 gap-6\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: [mainImage ? /*#__PURE__*/_jsxDEV(\"img\", {\n          src: mainImage,\n          alt: product.product_name,\n          className: \"w-full aspect-square object-cover rounded-2xl shadow-sm border border-green-100\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 250,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"w-full aspect-square rounded-2xl bg-green-50 border border-green-100 grid place-items-center\",\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-green-700\",\n            children: \"\\u0E44\\u0E21\\u0E48\\u0E21\\u0E35\\u0E23\\u0E39\\u0E1B\\u0E20\\u0E32\\u0E1E\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 257,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 13\n        }, this), (images === null || images === void 0 ? void 0 : images.length) > 1 && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mt-3 grid grid-cols-5 gap-2\",\n          children: images.map((im, idx) => /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"border rounded-xl overflow-hidden hover:opacity-90 focus:ring-2 focus:ring-green-500\",\n            onClick: () => window.scrollTo({\n              top: 0,\n              behavior: \"smooth\"\n            }),\n            children: /*#__PURE__*/_jsxDEV(\"img\", {\n              src: im.url,\n              alt: im.alt || \"img\",\n              className: \"w-full h-20 object-cover\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 269,\n              columnNumber: 19\n            }, this)\n          }, idx, false, {\n            fileName: _jsxFileName,\n            lineNumber: 264,\n            columnNumber: 17\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 262,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n          className: \"text-2xl md:text-3xl font-bold text-green-800\",\n          children: product.product_name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 278,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mt-3 p-3 bg-green-50 rounded-xl border border-green-100\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center gap-3 flex-wrap\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-xl md:text-2xl font-semibold text-green-700\",\n              children: fmtBaht(priceToShow)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 283,\n              columnNumber: 15\n            }, this), skuToShow && /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"px-2 py-1 text-xs rounded bg-white border border-green-200 text-green-700\",\n              children: [\"SKU: \", skuToShow]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 287,\n              columnNumber: 17\n            }, this), stockToShow !== null && stockToShow !== undefined && /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"px-2 py-1 text-xs rounded bg-white border border-green-200 text-green-700\",\n              children: [\"\\u0E2A\\u0E15\\u0E47\\u0E2D\\u0E04: \", stockToShow]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 292,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 282,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 281,\n          columnNumber: 11\n        }, this), optionKeys.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mt-4 space-y-3\",\n          children: optionKeys.map(key => {\n            const values = uniqueOptionValues(variants, key);\n            const chosen = chosenOptions[key];\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"text-sm text-gray-700 mb-1\",\n                children: key\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 307,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex flex-wrap gap-2\",\n                children: values.map(val => {\n                  const active = chosen === val;\n                  return /*#__PURE__*/_jsxDEV(\"button\", {\n                    type: \"button\",\n                    onClick: () => chooseOption(key, val),\n                    className: [\"px-3 py-2 rounded-2xl border text-sm\", active ? \"bg-green-600 text-white border-green-700\" : \"bg-white text-green-800 border-green-300 hover:border-green-500\"].join(\" \"),\n                    children: val\n                  }, val, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 312,\n                    columnNumber: 27\n                  }, this);\n                })\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 308,\n                columnNumber: 21\n              }, this)]\n            }, key, true, {\n              fileName: _jsxFileName,\n              lineNumber: 306,\n              columnNumber: 19\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 301,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mt-4 flex items-center gap-3\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-sm text-gray-700\",\n            children: \"\\u0E08\\u0E33\\u0E19\\u0E27\\u0E19\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 336,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"inline-flex items-center border rounded-xl overflow-hidden\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              onClick: () => setQty(q => Math.max(1, q - 1)),\n              className: \"px-3 py-1 bg-white hover:bg-green-50\",\n              children: \"\\u2212\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 338,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"number\",\n              min: 1,\n              value: qty,\n              onChange: e => setQty(Math.max(1, asInt(e.target.value) || 1)),\n              className: \"w-16 text-center py-1 outline-none\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 345,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              onClick: () => setQty(q => q + 1),\n              className: \"px-3 py-1 bg-white hover:bg-green-50\",\n              children: \"+\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 352,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 337,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 335,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mt-5 flex gap-3\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            disabled: !canAdd,\n            onClick: onAddToCart,\n            className: [\"btn btn-primary\", \"px-6 py-3 rounded-2xl shadow-sm\", canAdd ? \"bg-green-700 text-white hover:bg-green-800\" : \"bg-gray-300 text-gray-600 cursor-not-allowed\"].join(\" \"),\n            children: \"\\u0E40\\u0E1E\\u0E34\\u0E48\\u0E21\\u0E25\\u0E07\\u0E15\\u0E30\\u0E01\\u0E23\\u0E49\\u0E32\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 364,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Link, {\n            to: \"/cart\",\n            className: \"px-6 py-3 rounded-2xl border border-green-300 text-green-800 bg-white hover:bg-green-50\",\n            children: \"\\u0E44\\u0E1B\\u0E15\\u0E30\\u0E01\\u0E23\\u0E49\\u0E32\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 377,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 363,\n          columnNumber: 11\n        }, this), product.description && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"text-lg font-semibold text-green-800 mb-2\",\n            children: \"\\u0E23\\u0E32\\u0E22\\u0E25\\u0E30\\u0E40\\u0E2D\\u0E35\\u0E22\\u0E14\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 388,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"prose prose-sm max-w-none\",\n            children: /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"whitespace-pre-line\",\n              children: product.description\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 390,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 389,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 387,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 277,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 236,\n    columnNumber: 5\n  }, this);\n}\n\n// ---------- utilities สำหรับ options/variants ----------\n_s(ProductDetail, \"uC7g7WWTWmw2C3Lrb8nE+PKrTps=\", false, function () {\n  return [useParams];\n});\n_c = ProductDetail;\nfunction collectOptionKeys(vs) {\n  const s = new Set();\n  (vs || []).forEach(v => {\n    const obj = (v === null || v === void 0 ? void 0 : v.options) || {};\n    Object.keys(obj).forEach(k => s.add(k));\n  });\n  return Array.from(s);\n}\nfunction uniqueOptionValues(vs, key) {\n  const s = new Set();\n  (vs || []).forEach(v => {\n    const obj = (v === null || v === void 0 ? void 0 : v.options) || {};\n    if (obj[key]) s.add(String(obj[key]));\n  });\n  return Array.from(s);\n}\nfunction findVariantByOptions(vs, chosen) {\n  if (!(vs !== null && vs !== void 0 && vs.length)) return null;\n  const sig = optionSignature(chosen || {});\n  // จับคู่แบบ signature ตรงก่อน\n  let found = vs.find(v => {\n    var _v$is_active2;\n    return optionSignature(v.options || {}) === sig && ((_v$is_active2 = v.is_active) !== null && _v$is_active2 !== void 0 ? _v$is_active2 : true);\n  }) || null;\n  if (found) return found;\n\n  // ไม่ตรงหมด ให้หารายการที่ match ได้มากที่สุด\n  let best = null;\n  let bestScore = -1;\n  for (const v of vs) {\n    const keys = Object.keys(v.options || {});\n    let score = 0;\n    keys.forEach(k => {\n      if ((v.options || {})[k] === (chosen || {})[k]) score += 1;\n    });\n    if (score > bestScore) {\n      bestScore = score;\n      best = v;\n    }\n  }\n  return best;\n}\nvar _c;\n$RefreshReg$(_c, \"ProductDetail\");","map":{"version":3,"names":["React","useEffect","useMemo","useState","useCallback","useParams","Link","api","path","addItem","jsxDEV","_jsxDEV","asInt","v","undefined","parseInt","fmtBaht","n","isNaN","Intl","NumberFormat","style","currency","maximumFractionDigits","format","ensureAbsUrl","u","ORIGIN","API_ORIGIN","process","env","REACT_APP_API_ORIGIN","test","startsWith","normalizeVariants","rawVariants","Array","isArray","map","_ref","_v$variant_id","_ref2","_ref3","_v$sku","_ref4","_ref5","_ref6","_v$price","_asInt","_ref7","_ref8","_ref9","_ref0","_v$stock","_ref11","_ref12","_v$image_url","_ref13","_v$is_active","variant_id","id","product_variant_id","sku","SKU","code","toString","price","Number","variant_price","sale_price","base_price","stock","qty","quantity","live_stock","on_hand","options","reduce","acc","it","_ref1","_it$name","_ref10","_it$value","k","name","option_name","val","value","option_value","color","สี","size","ขนาด","image_url","image","thumbnail","is_active","active","optionSignature","obj","Object","entries","sort","join","ProductDetail","_s","_ref19","_currentVariant$price","_currentVariant$stock","loading","setLoading","product","setProduct","variants","setVariants","images","setImages","setQty","chosenOptions","setChosenOptions","selectedVariantId","setSelectedVariantId","cancelled","load","_p$product_id","_ref14","_ref15","_p$price","_ref16","_ref17","_p$stock","_ref18","_p$is_published","_first$variant_id","res","get","products","p","data","v1","imgs","url","alt","alt_text","product_name","filter","x","vImgs","vv","Boolean","product_id","description","detail","total_stock","category_name","category","is_published","published","length","concat","optionKeys","collectOptionKeys","init","forEach","vals","uniqueOptionValues","first","findVariantByOptions","err","console","error","currentVariant","find","priceToShow","skuToShow","stockToShow","mainImage","canAdd","s","chooseOption","key","_v$variant_id2","next","onAddToCart","pid","vid","addToCart","alert","className","children","fileName","_jsxFileName","lineNumber","columnNumber","to","src","im","idx","onClick","window","scrollTo","top","behavior","values","chosen","type","q","Math","max","min","onChange","e","target","disabled","_c","vs","Set","keys","add","from","String","sig","found","_v$is_active2","best","bestScore","score","$RefreshReg$"],"sources":["D:/project19/frontend/src/pages/ProductDetail.js"],"sourcesContent":["// frontend/src/pages/ProductDetail.js\r\nimport React, { useEffect, useMemo, useState, useCallback } from \"react\";\r\nimport { useParams, Link } from \"react-router-dom\";\r\nimport { api, path } from \"../lib/api\";\r\nimport { addItem } from \"../lib/cart\";\r\n\r\n// ---------- helpers ----------\r\nconst asInt = (v) => (v === null || v === undefined || v === \"\" ? null : parseInt(v, 10));\r\nconst fmtBaht = (n) => {\r\n  if (n === null || n === undefined || isNaN(n)) return \"—\";\r\n  try {\r\n    return new Intl.NumberFormat(\"th-TH\", { style: \"currency\", currency: \"THB\", maximumFractionDigits: 2 }).format(n);\r\n  } catch {\r\n    return `${n} บาท`;\r\n  }\r\n};\r\nconst ensureAbsUrl = (u) => {\r\n  if (!u) return \"\";\r\n  // ถ้า backend ส่ง path เปล่า ๆ มา (เช่น /uploads/xxx.jpg) ให้ prefix ด้วย API_ORIGIN ที่ config ไว้ใน api.js\r\n  const ORIGIN = (path && path.API_ORIGIN) || process.env.REACT_APP_API_ORIGIN || \"\";\r\n  if (/^https?:\\/\\//i.test(u)) return u;\r\n  if (ORIGIN && u.startsWith(\"/\")) return ORIGIN + u;\r\n  return u;\r\n};\r\n\r\n// แปลงโครงข้อมูล variants ที่อาจต่าง schema กัน ให้เป็นรูปแบบเดียว\r\nfunction normalizeVariants(rawVariants) {\r\n  if (!Array.isArray(rawVariants)) return [];\r\n  return rawVariants.map((v) => ({\r\n    variant_id: asInt(v.variant_id ?? v.id ?? v.product_variant_id),\r\n    sku: (v.sku ?? v.SKU ?? v.code ?? \"\").toString(),\r\n    price: Number(v.price ?? v.variant_price ?? v.sale_price ?? v.base_price ?? 0),\r\n    stock: asInt(v.stock ?? v.qty ?? v.quantity ?? v.live_stock ?? v.on_hand ?? 0) ?? 0,\r\n    // ออปชั่นอาจส่งมาเป็น {color:\"แดง\", size:\"L\"} หรือ [{name:\"สี\",value:\"แดง\"}, ...]\r\n    options:\r\n      Array.isArray(v.options)\r\n        ? v.options.reduce((acc, it) => {\r\n            const k = (it?.name ?? it?.option_name ?? \"\").toString();\r\n            const val = (it?.value ?? it?.option_value ?? \"\").toString();\r\n            if (k) acc[k] = val;\r\n            return acc;\r\n          }, {})\r\n        : typeof v.options === \"object\" && v.options\r\n        ? v.options\r\n        : {\r\n            ...(v.color ? { สี: v.color } : {}),\r\n            ...(v.size ? { ขนาด: v.size } : {}),\r\n          },\r\n    image_url: ensureAbsUrl(v.image_url ?? v.image ?? v.thumbnail ?? \"\"),\r\n    is_active: v.is_active ?? v.active ?? true,\r\n  }));\r\n}\r\n\r\n// รวม key ออปชั่นเป็น signature เพื่อเทียบหา variant\r\nconst optionSignature = (obj) =>\r\n  Object.entries(obj || {})\r\n    .map(([k, v]) => `${k}=${v}`)\r\n    .sort()\r\n    .join(\"|\");\r\n\r\n// ---------- หน้าแสดงรายละเอียด ----------\r\nexport default function ProductDetail() {\r\n  const { id } = useParams(); // /products/:id\r\n  const [loading, setLoading] = useState(true);\r\n  const [product, setProduct] = useState(null);\r\n  const [variants, setVariants] = useState([]);\r\n  const [images, setImages] = useState([]); // รูปสินค้า (รวมจากตัวแม่ + จากตัวเลือกถ้ามี)\r\n  const [qty, setQty] = useState(1);\r\n\r\n  // state สำหรับเลือกออปชั่น\r\n  const [chosenOptions, setChosenOptions] = useState({});\r\n  const [selectedVariantId, setSelectedVariantId] = useState(null);\r\n\r\n  // ดึงข้อมูลสินค้า (กันหลายสกีมา/หลายเอ็นด์พอยต์)\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n    async function load() {\r\n      setLoading(true);\r\n      try {\r\n        // 1) ดึงตัวแม่\r\n        const res = await api.get(`${path.products}/${id}`);\r\n        const p = res?.data || res;\r\n        if (cancelled) return;\r\n\r\n        // 2) พยายามดึง variants แยก (ถ้ามีเอ็นด์พอยต์) ไม่งั้นลองอ่านจาก p.variants\r\n        let v = [];\r\n        try {\r\n          const v1 = await api.get(`${path.products}/${id}/variants`);\r\n          v = normalizeVariants(v1?.data || v1);\r\n        } catch {\r\n          v = normalizeVariants(p?.variants || []);\r\n        }\r\n\r\n        // 3) รวมรูป\r\n        const imgs =\r\n          (Array.isArray(p?.images) ? p.images : [])\r\n            .map((it) => ({\r\n              url: ensureAbsUrl(it?.url || it?.image_url || \"\"),\r\n              alt: it?.alt_text || p?.product_name || \"product\",\r\n            }))\r\n            .filter((x) => x.url) || [];\r\n\r\n        // ถ้า variant มีรูป ให้เอามารวมเป็นแกลเลอรีท้าย ๆ\r\n        const vImgs = v\r\n          .map((vv) => (vv.image_url ? { url: vv.image_url, alt: vv.sku || \"variant\" } : null))\r\n          .filter(Boolean);\r\n\r\n        setProduct({\r\n          product_id: asInt(p.product_id ?? p.id),\r\n          product_name: p.product_name || p.name || \"สินค้า\",\r\n          description: p.description || p.detail || \"\",\r\n          price: Number(p.price ?? p.base_price ?? p.sale_price ?? 0),\r\n          // สต็อกรวมต่อ “สินค้า” (อิงจาก view ฝั่ง backend แล้วแต่ระบบ) ถ้าไม่มีจะไม่แสดง\r\n          stock: asInt(p.stock ?? p.live_stock ?? p.total_stock ?? null),\r\n          image_url: ensureAbsUrl(p.image_url || p.thumbnail || \"\"),\r\n          category_name: p.category_name || p.category || \"\",\r\n          is_published: p.is_published ?? p.published ?? true,\r\n        });\r\n        setVariants(v);\r\n        setImages(\r\n          (imgs.length > 0 ? imgs : p.image_url ? [{ url: ensureAbsUrl(p.image_url), alt: p.product_name }] : []).concat(\r\n            vImgs\r\n          )\r\n        );\r\n\r\n        // 4) เตรียมค่าออปชั่นเริ่มต้น (เลือก option แรกของแต่ละประเภท)\r\n        const optionKeys = collectOptionKeys(v);\r\n        const init = {};\r\n        optionKeys.forEach((k) => {\r\n          const vals = uniqueOptionValues(v, k);\r\n          if (vals.length) init[k] = vals[0];\r\n        });\r\n        setChosenOptions(init);\r\n\r\n        // 5) จิ้มหา variant เริ่มต้น\r\n        const first = findVariantByOptions(v, init);\r\n        setSelectedVariantId(first?.variant_id ?? null);\r\n      } catch (err) {\r\n        console.error(\"Load product failed:\", err);\r\n      } finally {\r\n        if (!cancelled) setLoading(false);\r\n      }\r\n    }\r\n    load();\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [id]);\r\n\r\n  // รวมคีย์ออปชั่นที่มีอยู่ทั้งหมดจาก variants\r\n  const optionKeys = useMemo(() => collectOptionKeys(variants), [variants]);\r\n\r\n  // คำนวณ variant ที่เลือกปัจจุบัน\r\n  const currentVariant = useMemo(() => {\r\n    if (!variants.length) return null;\r\n    if (selectedVariantId) return variants.find((x) => x.variant_id === selectedVariantId) || null;\r\n    if (optionKeys.length) return findVariantByOptions(variants, chosenOptions);\r\n    return null;\r\n  }, [variants, selectedVariantId, chosenOptions, optionKeys]);\r\n\r\n  const priceToShow = currentVariant?.price ?? product?.price ?? 0;\r\n  const skuToShow = currentVariant?.sku || \"\";\r\n  const stockToShow =\r\n    currentVariant?.stock ??\r\n    (product?.stock !== null && product?.stock !== undefined ? product.stock : null);\r\n\r\n  const mainImage = useMemo(() => {\r\n    if (currentVariant?.image_url) return currentVariant.image_url;\r\n    if (images?.length) return images[0].url;\r\n    return product?.image_url || \"\";\r\n  }, [currentVariant, images, product]);\r\n\r\n  const canAdd = useMemo(() => {\r\n    const s = stockToShow;\r\n    if (s === null || s === undefined) return true; // ไม่ทราบสต็อก = อนุญาต\r\n    return s > 0;\r\n  }, [stockToShow]);\r\n\r\n  // เลือกออปชั่น\r\n  const chooseOption = useCallback(\r\n    (key, val) => {\r\n      const next = { ...chosenOptions, [key]: val };\r\n      setChosenOptions(next);\r\n      const v = findVariantByOptions(variants, next);\r\n      setSelectedVariantId(v?.variant_id ?? null);\r\n    },\r\n    [chosenOptions, variants]\r\n  );\r\n\r\n  // เพิ่มลงตะกร้า\r\n  const onAddToCart = useCallback(() => {\r\n    if (!product) return;\r\n    const pid = product.product_id;\r\n    const vid = currentVariant?.variant_id || null;\r\n\r\n    addToCart({\r\n      product_id: pid,\r\n      variant_id: vid,\r\n      name: product.product_name,\r\n      sku: skuToShow || undefined,\r\n      price: priceToShow,\r\n      qty: qty,\r\n      image_url: mainImage,\r\n      options: chosenOptions,\r\n    });\r\n\r\n    alert(\"เพิ่มลงตะกร้าแล้ว\");\r\n  }, [product, currentVariant, priceToShow, skuToShow, qty, mainImage, chosenOptions]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"max-w-5xl mx-auto p-4\">\r\n        <div className=\"animate-pulse h-6 w-32 bg-gray-200 rounded mb-4\" />\r\n        <div className=\"grid md:grid-cols-2 gap-6\">\r\n          <div className=\"h-72 bg-gray-200 rounded-xl\" />\r\n          <div>\r\n            <div className=\"h-5 w-48 bg-gray-200 rounded mb-3\" />\r\n            <div className=\"h-5 w-60 bg-gray-200 rounded mb-6\" />\r\n            <div className=\"h-10 w-40 bg-gray-200 rounded\" />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!product) {\r\n    return (\r\n      <div className=\"max-w-5xl mx-auto p-6\">\r\n        <p className=\"text-red-700\">ไม่พบสินค้า</p>\r\n        <Link to=\"/products\" className=\"text-green-700 underline\">ย้อนกลับหน้าสินค้า</Link>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-5xl mx-auto p-4 md:p-6\">\r\n      {/* breadcrumb เบา ๆ */}\r\n      <nav className=\"text-sm mb-4 text-gray-600\">\r\n        <Link to=\"/\" className=\"hover:underline\">หน้าแรก</Link>\r\n        <span className=\"mx-2\">/</span>\r\n        <Link to=\"/products\" className=\"hover:underline\">สินค้าทั้งหมด</Link>\r\n        <span className=\"mx-2\">/</span>\r\n        <span className=\"text-gray-900\">{product.product_name}</span>\r\n      </nav>\r\n\r\n      <div className=\"grid md:grid-cols-2 gap-6\">\r\n        {/* รูปหลัก + แกลเลอรีเล็ก ๆ */}\r\n        <div>\r\n          {mainImage ? (\r\n            <img\r\n              src={mainImage}\r\n              alt={product.product_name}\r\n              className=\"w-full aspect-square object-cover rounded-2xl shadow-sm border border-green-100\"\r\n            />\r\n          ) : (\r\n            <div className=\"w-full aspect-square rounded-2xl bg-green-50 border border-green-100 grid place-items-center\">\r\n              <span className=\"text-green-700\">ไม่มีรูปภาพ</span>\r\n            </div>\r\n          )}\r\n\r\n          {images?.length > 1 && (\r\n            <div className=\"mt-3 grid grid-cols-5 gap-2\">\r\n              {images.map((im, idx) => (\r\n                <button\r\n                  key={idx}\r\n                  className=\"border rounded-xl overflow-hidden hover:opacity-90 focus:ring-2 focus:ring-green-500\"\r\n                  onClick={() => window.scrollTo({ top: 0, behavior: \"smooth\" })}\r\n                >\r\n                  <img src={im.url} alt={im.alt || \"img\"} className=\"w-full h-20 object-cover\" />\r\n                </button>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* รายละเอียด */}\r\n        <div>\r\n          <h1 className=\"text-2xl md:text-3xl font-bold text-green-800\">{product.product_name}</h1>\r\n\r\n          {/* ราคา + สต็อก + SKU */}\r\n          <div className=\"mt-3 p-3 bg-green-50 rounded-xl border border-green-100\">\r\n            <div className=\"flex items-center gap-3 flex-wrap\">\r\n              <span className=\"text-xl md:text-2xl font-semibold text-green-700\">\r\n                {fmtBaht(priceToShow)}\r\n              </span>\r\n              {skuToShow && (\r\n                <span className=\"px-2 py-1 text-xs rounded bg-white border border-green-200 text-green-700\">\r\n                  SKU: {skuToShow}\r\n                </span>\r\n              )}\r\n              {stockToShow !== null && stockToShow !== undefined && (\r\n                <span className=\"px-2 py-1 text-xs rounded bg-white border border-green-200 text-green-700\">\r\n                  สต็อค: {stockToShow}\r\n                </span>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* ตัวเลือกสินค้า (Variants) */}\r\n          {optionKeys.length > 0 && (\r\n            <div className=\"mt-4 space-y-3\">\r\n              {optionKeys.map((key) => {\r\n                const values = uniqueOptionValues(variants, key);\r\n                const chosen = chosenOptions[key];\r\n                return (\r\n                  <div key={key}>\r\n                    <div className=\"text-sm text-gray-700 mb-1\">{key}</div>\r\n                    <div className=\"flex flex-wrap gap-2\">\r\n                      {values.map((val) => {\r\n                        const active = chosen === val;\r\n                        return (\r\n                          <button\r\n                            key={val}\r\n                            type=\"button\"\r\n                            onClick={() => chooseOption(key, val)}\r\n                            className={[\r\n                              \"px-3 py-2 rounded-2xl border text-sm\",\r\n                              active\r\n                                ? \"bg-green-600 text-white border-green-700\"\r\n                                : \"bg-white text-green-800 border-green-300 hover:border-green-500\",\r\n                            ].join(\" \")}\r\n                          >\r\n                            {val}\r\n                          </button>\r\n                        );\r\n                      })}\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          )}\r\n\r\n          {/* จำนวน */}\r\n          <div className=\"mt-4 flex items-center gap-3\">\r\n            <span className=\"text-sm text-gray-700\">จำนวน</span>\r\n            <div className=\"inline-flex items-center border rounded-xl overflow-hidden\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => setQty((q) => Math.max(1, q - 1))}\r\n                className=\"px-3 py-1 bg-white hover:bg-green-50\"\r\n              >\r\n                −\r\n              </button>\r\n              <input\r\n                type=\"number\"\r\n                min={1}\r\n                value={qty}\r\n                onChange={(e) => setQty(Math.max(1, asInt(e.target.value) || 1))}\r\n                className=\"w-16 text-center py-1 outline-none\"\r\n              />\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => setQty((q) => q + 1)}\r\n                className=\"px-3 py-1 bg-white hover:bg-green-50\"\r\n              >\r\n                +\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* ปุ่มเพิ่มตะกร้า */}\r\n          <div className=\"mt-5 flex gap-3\">\r\n            <button\r\n              type=\"button\"\r\n              disabled={!canAdd}\r\n              onClick={onAddToCart}\r\n              className={[\r\n                \"btn btn-primary\",\r\n                \"px-6 py-3 rounded-2xl shadow-sm\",\r\n                canAdd ? \"bg-green-700 text-white hover:bg-green-800\" : \"bg-gray-300 text-gray-600 cursor-not-allowed\",\r\n              ].join(\" \")}\r\n            >\r\n              เพิ่มลงตะกร้า\r\n            </button>\r\n\r\n            <Link\r\n              to=\"/cart\"\r\n              className=\"px-6 py-3 rounded-2xl border border-green-300 text-green-800 bg-white hover:bg-green-50\"\r\n            >\r\n              ไปตะกร้า\r\n            </Link>\r\n          </div>\r\n\r\n          {/* รายละเอียดสินค้า */}\r\n          {product.description && (\r\n            <div className=\"mt-6\">\r\n              <h2 className=\"text-lg font-semibold text-green-800 mb-2\">รายละเอียดสินค้า</h2>\r\n              <div className=\"prose prose-sm max-w-none\">\r\n                <p className=\"whitespace-pre-line\">{product.description}</p>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// ---------- utilities สำหรับ options/variants ----------\r\nfunction collectOptionKeys(vs) {\r\n  const s = new Set();\r\n  (vs || []).forEach((v) => {\r\n    const obj = v?.options || {};\r\n    Object.keys(obj).forEach((k) => s.add(k));\r\n  });\r\n  return Array.from(s);\r\n}\r\n\r\nfunction uniqueOptionValues(vs, key) {\r\n  const s = new Set();\r\n  (vs || []).forEach((v) => {\r\n    const obj = v?.options || {};\r\n    if (obj[key]) s.add(String(obj[key]));\r\n  });\r\n  return Array.from(s);\r\n}\r\n\r\nfunction findVariantByOptions(vs, chosen) {\r\n  if (!vs?.length) return null;\r\n  const sig = optionSignature(chosen || {});\r\n  // จับคู่แบบ signature ตรงก่อน\r\n  let found =\r\n    vs.find((v) => optionSignature(v.options || {}) === sig && (v.is_active ?? true)) ||\r\n    null;\r\n  if (found) return found;\r\n\r\n  // ไม่ตรงหมด ให้หารายการที่ match ได้มากที่สุด\r\n  let best = null;\r\n  let bestScore = -1;\r\n  for (const v of vs) {\r\n    const keys = Object.keys(v.options || {});\r\n    let score = 0;\r\n    keys.forEach((k) => {\r\n      if ((v.options || {})[k] === (chosen || {})[k]) score += 1;\r\n    });\r\n    if (score > bestScore) {\r\n      bestScore = score;\r\n      best = v;\r\n    }\r\n  }\r\n  return best;\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}