{"ast":null,"code":"var _jsxFileName = \"D:\\\\project19\\\\frontend\\\\src\\\\pages\\\\HomeUser.js\",\n  _s = $RefreshSig$();\n// SearchPage.jsx (สรุปการใช้ฟิลเตอร์ + ยิง /api/products)\nimport React, { useEffect, useMemo, useState } from 'react';\nimport axios from 'axios';\nimport SearchFilters from './SearchFilters';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function SearchPage() {\n  _s();\n  const [filters, setFilters] = useState({\n    q: '',\n    category_id: null,\n    subcategory_id: null,\n    sort: 'popular',\n    inStockOnly: false\n  });\n  const [items, setItems] = useState([]);\n  const axiosClient = useMemo(() => {\n    const token = localStorage.getItem('token') || localStorage.getItem('access_token') || localStorage.getItem('jwt') || '';\n    const base = process.env.REACT_APP_API_BASE || (() => {\n      try {\n        const u = new URL(window.location.href);\n        return `${u.protocol}//${u.hostname}:${u.port === '3000' ? '3001' : u.port || '3001'}`;\n      } catch {\n        return 'http://localhost:3001';\n      }\n    })();\n    return axios.create({\n      baseURL: base,\n      headers: token ? {\n        Authorization: `Bearer ${token}`\n      } : {}\n    });\n  }, []);\n  useEffect(() => {\n    (async () => {\n      const params = {\n        limit: 24\n      };\n      if (filters.q) params.q = filters.q;\n      if (filters.sort && filters.sort !== 'popular') params.sort = filters.sort;\n\n      // หมายเหตุ: ถ้า backend ของคุณยังไม่รองรับ category_id/subcategory_id ใน query\n      // ให้ยิงเฉพาะ q/sort มาก่อน แล้วกรองใน FE จากผลลัพธ์\n      const {\n        data\n      } = await axiosClient.get('/api/products', {\n        params\n      });\n      let list = Array.isArray(data === null || data === void 0 ? void 0 : data.items) ? data.items : data; // รองรับได้ทั้งสองรูปแบบ\n      // กรองฝั่ง FE ตามหมวด/ประเภท (ถ้าจำเป็น)\n      if (filters.category_id) {\n        list = list.filter(p => Number(p.category_id) === Number(filters.category_id));\n      }\n      if (filters.subcategory_id) {\n        list = list.filter(p => Number(p.subcategory_id) === Number(filters.subcategory_id));\n      }\n      if (filters.inStockOnly) {\n        list = list.filter(p => (Number(p.stock) || 0) > 0);\n      }\n      // เรียงราคาที่ฝั่ง FE กรณี backend ยังไม่รองรับ\n      if (filters.sort === 'price_asc') {\n        list = [...list].sort((a, b) => Number(a.min_price || a.price || 0) - Number(b.min_price || b.price || 0));\n      } else if (filters.sort === 'price_desc') {\n        list = [...list].sort((a, b) => Number(b.min_price || b.price || 0) - Number(a.min_price || a.price || 0));\n      }\n      setItems(list);\n    })();\n  }, [filters, axiosClient]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      maxWidth: 1100,\n      margin: '0 auto',\n      padding: 16\n    },\n    children: [/*#__PURE__*/_jsxDEV(SearchFilters, {\n      onChange: setFilters\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 52,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'grid',\n        gridTemplateColumns: 'repeat(auto-fill, minmax(220px, 1fr))',\n        gap: 12\n      },\n      children: items.map(p => {\n        var _ref, _p$min_price;\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            border: '1px solid #eee',\n            borderRadius: 12,\n            padding: 12\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            alt: p.product_name,\n            src: p.image_url,\n            style: {\n              width: '100%',\n              height: 150,\n              objectFit: 'cover',\n              borderRadius: 8\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 56,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontWeight: 600,\n              marginTop: 8\n            },\n            children: p.product_name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 57,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              color: '#444'\n            },\n            children: [((_ref = (_p$min_price = p.min_price) !== null && _p$min_price !== void 0 ? _p$min_price : p.price) !== null && _ref !== void 0 ? _ref : 0).toLocaleString(), \" \\u0E3F\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 58,\n            columnNumber: 13\n          }, this)]\n        }, p.product_id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 55,\n          columnNumber: 11\n        }, this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 53,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 51,\n    columnNumber: 5\n  }, this);\n}\n_s(SearchPage, \"lu4zY4+4gI48+GEIxelyFMvzejo=\");\n_c = SearchPage;\nvar _c;\n$RefreshReg$(_c, \"SearchPage\");","map":{"version":3,"names":["React","useEffect","useMemo","useState","axios","SearchFilters","jsxDEV","_jsxDEV","SearchPage","_s","filters","setFilters","q","category_id","subcategory_id","sort","inStockOnly","items","setItems","axiosClient","token","localStorage","getItem","base","process","env","REACT_APP_API_BASE","u","URL","window","location","href","protocol","hostname","port","create","baseURL","headers","Authorization","params","limit","data","get","list","Array","isArray","filter","p","Number","stock","a","b","min_price","price","style","maxWidth","margin","padding","children","onChange","fileName","_jsxFileName","lineNumber","columnNumber","display","gridTemplateColumns","gap","map","_ref","_p$min_price","border","borderRadius","alt","product_name","src","image_url","width","height","objectFit","fontWeight","marginTop","color","toLocaleString","product_id","_c","$RefreshReg$"],"sources":["D:/project19/frontend/src/pages/HomeUser.js"],"sourcesContent":["// SearchPage.jsx (สรุปการใช้ฟิลเตอร์ + ยิง /api/products)\r\nimport React, { useEffect, useMemo, useState } from 'react';\r\nimport axios from 'axios';\r\nimport SearchFilters from './SearchFilters';\r\n\r\nexport default function SearchPage() {\r\n  const [filters, setFilters] = useState({ q: '', category_id: null, subcategory_id: null, sort: 'popular', inStockOnly: false });\r\n  const [items, setItems] = useState([]);\r\n\r\n  const axiosClient = useMemo(() => {\r\n    const token = localStorage.getItem('token') || localStorage.getItem('access_token') || localStorage.getItem('jwt') || '';\r\n    const base =\r\n      process.env.REACT_APP_API_BASE ||\r\n      (() => { try { const u = new URL(window.location.href); return `${u.protocol}//${u.hostname}:${u.port === '3000' ? '3001' : (u.port || '3001')}`; } catch { return 'http://localhost:3001'; }})();\r\n    return axios.create({ baseURL: base, headers: token ? { Authorization: `Bearer ${token}` } : {} });\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      const params = { limit: 24 };\r\n      if (filters.q) params.q = filters.q;\r\n      if (filters.sort && filters.sort !== 'popular') params.sort = filters.sort;\r\n\r\n      // หมายเหตุ: ถ้า backend ของคุณยังไม่รองรับ category_id/subcategory_id ใน query\r\n      // ให้ยิงเฉพาะ q/sort มาก่อน แล้วกรองใน FE จากผลลัพธ์\r\n      const { data } = await axiosClient.get('/api/products', { params });\r\n\r\n      let list = Array.isArray(data?.items) ? data.items : data; // รองรับได้ทั้งสองรูปแบบ\r\n      // กรองฝั่ง FE ตามหมวด/ประเภท (ถ้าจำเป็น)\r\n      if (filters.category_id) {\r\n        list = list.filter(p => Number(p.category_id) === Number(filters.category_id));\r\n      }\r\n      if (filters.subcategory_id) {\r\n        list = list.filter(p => Number(p.subcategory_id) === Number(filters.subcategory_id));\r\n      }\r\n      if (filters.inStockOnly) {\r\n        list = list.filter(p => (Number(p.stock) || 0) > 0);\r\n      }\r\n      // เรียงราคาที่ฝั่ง FE กรณี backend ยังไม่รองรับ\r\n      if (filters.sort === 'price_asc') {\r\n        list = [...list].sort((a,b) => Number(a.min_price||a.price||0) - Number(b.min_price||b.price||0));\r\n      } else if (filters.sort === 'price_desc') {\r\n        list = [...list].sort((a,b) => Number(b.min_price||b.price||0) - Number(a.min_price||a.price||0));\r\n      }\r\n\r\n      setItems(list);\r\n    })();\r\n  }, [filters, axiosClient]);\r\n\r\n  return (\r\n    <div style={{ maxWidth: 1100, margin: '0 auto', padding: 16 }}>\r\n      <SearchFilters onChange={setFilters} />\r\n      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(220px, 1fr))', gap: 12 }}>\r\n        {items.map(p => (\r\n          <div key={p.product_id} style={{ border: '1px solid #eee', borderRadius: 12, padding: 12 }}>\r\n            <img alt={p.product_name} src={p.image_url} style={{ width: '100%', height: 150, objectFit: 'cover', borderRadius: 8 }} />\r\n            <div style={{ fontWeight: 600, marginTop: 8 }}>{p.product_name}</div>\r\n            <div style={{ color: '#444' }}>{(p.min_price ?? p.price ?? 0).toLocaleString()} ฿</div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}