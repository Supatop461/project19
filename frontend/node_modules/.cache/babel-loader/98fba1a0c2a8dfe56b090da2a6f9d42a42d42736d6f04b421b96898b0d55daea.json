{"ast":null,"code":"var _jsxFileName = \"D:\\\\project19\\\\frontend\\\\src\\\\admin\\\\UserManagement.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n// frontend/src/admin/UserManagement.jsx\nimport React, { useEffect, useMemo, useState } from \"react\";\nimport { api } from \"../lib/api\";\nimport { toast } from \"react-hot-toast\";\nimport \"./UserManagement.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction ConfirmModal({\n  open,\n  title,\n  subtitle,\n  onClose,\n  onConfirm,\n  busy\n}) {\n  _s();\n  const [pw, setPw] = useState(\"\");\n  useEffect(() => {\n    if (!open) setPw(\"\");\n  }, [open]);\n  if (!open) return null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"umodal-backdrop\",\n    onClick: onClose,\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"umodal\",\n      onClick: e => e.stopPropagation(),\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: title\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 15,\n        columnNumber: 9\n      }, this), subtitle && /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"umodal-sub\",\n        children: subtitle\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 16,\n        columnNumber: 22\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        className: \"umodal-label\",\n        children: \"\\u0E23\\u0E2B\\u0E31\\u0E2A\\u0E1C\\u0E48\\u0E32\\u0E19\\u0E41\\u0E2D\\u0E14\\u0E21\\u0E34\\u0E19\\u0E40\\u0E1E\\u0E37\\u0E48\\u0E2D\\u0E22\\u0E37\\u0E19\\u0E22\\u0E31\\u0E19\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 17,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"password\",\n        className: \"umodal-input\",\n        placeholder: \"\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\",\n        value: pw,\n        onChange: e => setPw(e.target.value)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 18,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"umodal-actions\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"ghost\",\n          onClick: onClose,\n          disabled: busy,\n          children: \"\\u0E22\\u0E01\\u0E40\\u0E25\\u0E34\\u0E01\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 26,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"primary\",\n          onClick: () => onConfirm(pw),\n          disabled: busy || !pw.trim(),\n          children: busy ? \"กำลังดำเนินการ…\" : \"ยืนยัน\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 27,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 25,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 14,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 13,\n    columnNumber: 5\n  }, this);\n}\n_s(ConfirmModal, \"2pGqOwd0y1vAXa29q42P2l0vJww=\");\n_c = ConfirmModal;\nexport default function UserManagement() {\n  _s2();\n  var _modal$action, _modal$action2, _modal$user$id;\n  const [users, setUsers] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [q, setQ] = useState(\"\");\n  const [roleFilter, setRoleFilter] = useState(\"all\");\n  const [busyId, setBusyId] = useState(null);\n  const [me, setMe] = useState({\n    id: null,\n    role: null\n  });\n  const [modal, setModal] = useState({\n    open: false,\n    action: null,\n    user: null\n  });\n  async function loadMe() {\n    try {\n      var _data$id, _data$role;\n      const r = await api.get(\"/api/admin/me\");\n      const data = (r === null || r === void 0 ? void 0 : r.data) || r;\n      setMe({\n        id: (_data$id = data === null || data === void 0 ? void 0 : data.id) !== null && _data$id !== void 0 ? _data$id : null,\n        role: (_data$role = data === null || data === void 0 ? void 0 : data.role) !== null && _data$role !== void 0 ? _data$role : null\n      });\n    } catch (e) {\n      // เงียบไว้ ถ้าระบบ auth ไม่ส่งมา\n      setMe({\n        id: null,\n        role: null\n      });\n    }\n  }\n  async function loadUsers() {\n    setLoading(true);\n    try {\n      var _res$data;\n      const url = `/api/admin/users?q=${encodeURIComponent(q)}&role=${roleFilter}`;\n      const res = await api.get(url);\n      const data = Array.isArray(res) ? res : (res === null || res === void 0 ? void 0 : res.items) || (res === null || res === void 0 ? void 0 : (_res$data = res.data) === null || _res$data === void 0 ? void 0 : _res$data.items) || [];\n      setUsers(data);\n    } catch (err) {\n      console.error(\"Load users failed:\", err);\n      toast.error(\"โหลดรายชื่อผู้ใช้ไม่สำเร็จ\");\n    } finally {\n      setLoading(false);\n    }\n  }\n  function openRoleModal(user, makeRole) {\n    setModal({\n      open: true,\n      action: {\n        type: \"role\",\n        make: makeRole\n      },\n      user\n    });\n  }\n  function openDeleteModal(user) {\n    setModal({\n      open: true,\n      action: {\n        type: \"delete\"\n      },\n      user\n    });\n  }\n  async function confirmModal(pw) {\n    var _user$id;\n    const {\n      user,\n      action\n    } = modal;\n    if (!user || !action) return;\n    const userId = (_user$id = user.id) !== null && _user$id !== void 0 ? _user$id : user.user_id;\n    setBusyId(userId);\n    try {\n      if (action.type === \"role\") {\n        var _res$data2;\n        const makeRole = action.make;\n        const res = await api.patch(`/api/admin/users/${userId}/role`, {\n          make: makeRole,\n          confirm_password: pw.trim()\n        });\n        const updated = (res === null || res === void 0 ? void 0 : res.user) || (res === null || res === void 0 ? void 0 : (_res$data2 = res.data) === null || _res$data2 === void 0 ? void 0 : _res$data2.user);\n        if (updated) {\n          setUsers(prev => prev.map(u => {\n            var _u$id;\n            return String((_u$id = u.id) !== null && _u$id !== void 0 ? _u$id : u.user_id) === String(userId) ? updated : u;\n          }));\n        }\n        toast.success(makeRole === \"admin\" ? `ตั้งเป็น admin สำเร็จ` : `ลดสิทธิ์เป็น user สำเร็จ`);\n      } else if (action.type === \"delete\") {\n        await api.delete(`/api/admin/users/${userId}`, {\n          data: {\n            confirm_password: pw.trim()\n          }\n        });\n        setUsers(prev => prev.filter(u => {\n          var _u$id2;\n          return String((_u$id2 = u.id) !== null && _u$id2 !== void 0 ? _u$id2 : u.user_id) !== String(userId);\n        }));\n        toast.success(`ลบบัญชีผู้ใช้สำเร็จ`);\n      }\n      setModal({\n        open: false,\n        user: null,\n        action: null\n      });\n    } catch (err) {\n      var _err$response, _err$response$data, _err$response2, _err$response2$data, _err$response3, _err$response3$data;\n      console.error(\"Action failed:\", err);\n      const msg = (err === null || err === void 0 ? void 0 : (_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.message) || (err === null || err === void 0 ? void 0 : (_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : (_err$response2$data = _err$response2.data) === null || _err$response2$data === void 0 ? void 0 : _err$response2$data.detail) || (err === null || err === void 0 ? void 0 : (_err$response3 = err.response) === null || _err$response3 === void 0 ? void 0 : (_err$response3$data = _err$response3.data) === null || _err$response3$data === void 0 ? void 0 : _err$response3$data.error) || \"ดำเนินการไม่สำเร็จ\";\n      toast.error(String(msg));\n    } finally {\n      setBusyId(null);\n    }\n  }\n  useEffect(() => {\n    loadMe();\n    loadUsers();\n  }, []);\n  useEffect(() => {\n    const t = setTimeout(loadUsers, 300);\n    return () => clearTimeout(t);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [q, roleFilter]);\n  const filtered = useMemo(() => {\n    const list = users || [];\n    if (!q && (roleFilter === \"all\" || !roleFilter)) return list;\n    const ql = q.trim().toLowerCase();\n    return list.filter(u => {\n      const name = (u.full_name || u.name || \"\").toLowerCase();\n      const email = (u.email || \"\").toLowerCase();\n      const username = (u.username || \"\").toLowerCase();\n      const matchQ = ql ? name.includes(ql) || email.includes(ql) || username.includes(ql) : true;\n      const role = u.role || (u.is_admin ? \"admin\" : \"user\") || \"user\";\n      const matchRole = roleFilter === \"all\" ? true : role === roleFilter;\n      return matchQ && matchRole;\n    });\n  }, [users, q, roleFilter]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"user-page\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"\\u0E08\\u0E31\\u0E14\\u0E01\\u0E32\\u0E23\\u0E2A\\u0E16\\u0E32\\u0E19\\u0E30\\u0E1C\\u0E39\\u0E49\\u0E43\\u0E0A\\u0E49\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"toolbar\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        placeholder: \"\\u0E04\\u0E49\\u0E19\\u0E0A\\u0E37\\u0E48\\u0E2D/\\u0E2D\\u0E35\\u0E40\\u0E21\\u0E25/username\\u2026\",\n        value: q,\n        onChange: e => setQ(e.target.value)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n        value: roleFilter,\n        onChange: e => setRoleFilter(e.target.value),\n        children: [/*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"all\",\n          children: \"\\u0E17\\u0E31\\u0E49\\u0E07\\u0E2B\\u0E21\\u0E14\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 165,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"admin\",\n          children: \"admin\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 166,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"user\",\n          children: \"user\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 167,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: loadUsers,\n        disabled: loading,\n        children: \"\\u0E23\\u0E35\\u0E40\\u0E1F\\u0E23\\u0E0A\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 7\n    }, this), loading ? /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"\\u0E01\\u0E33\\u0E25\\u0E31\\u0E07\\u0E42\\u0E2B\\u0E25\\u0E14...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"table\", {\n      className: \"user-table\",\n      children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n        children: /*#__PURE__*/_jsxDEV(\"tr\", {\n          children: [/*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"#\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 180,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n            style: {\n              textAlign: \"left\"\n            },\n            children: \"\\u0E0A\\u0E37\\u0E48\\u0E2D\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 181,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n            style: {\n              textAlign: \"left\"\n            },\n            children: \"\\u0E2D\\u0E35\\u0E40\\u0E21\\u0E25 / \\u0E1C\\u0E39\\u0E49\\u0E43\\u0E0A\\u0E49\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 182,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"\\u0E1A\\u0E17\\u0E1A\\u0E32\\u0E17\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 183,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"\\u0E08\\u0E31\\u0E14\\u0E01\\u0E32\\u0E23\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n        children: [filtered.map((u, i) => {\n          var _u$id3;\n          const id = (_u$id3 = u.id) !== null && _u$id3 !== void 0 ? _u$id3 : u.user_id;\n          const isAdmin = !!u.is_admin || u.role === \"admin\";\n          const role = u.role || (isAdmin ? \"admin\" : \"user\");\n          const isMe = (me === null || me === void 0 ? void 0 : me.id) && String(me.id) === String(id);\n          return /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: [/*#__PURE__*/_jsxDEV(\"td\", {\n              children: i + 1\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 196,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              style: {\n                textAlign: \"left\"\n              },\n              children: u.full_name || u.name || \"-\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 197,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              style: {\n                textAlign: \"left\"\n              },\n              children: u.email || u.username || \"-\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 198,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: `badge ${isAdmin ? \"badge-admin\" : \"\"}`,\n                children: role\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 200,\n                columnNumber: 21\n              }, this), isMe && /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"chip-me\",\n                children: \"\\u0E04\\u0E38\\u0E13\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 203,\n                columnNumber: 30\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 199,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              className: \"actions\",\n              children: [isAdmin ? /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"ghost\",\n                disabled: busyId === id || isMe,\n                onClick: () => openRoleModal(u, \"user\"),\n                title: isMe ? \"ห้ามลดสิทธิ์ตัวเอง\" : \"ลดสิทธิ์เป็น user\",\n                children: busyId === id ? \"...\" : \"ลดสิทธิ์เป็น user\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 207,\n                columnNumber: 23\n              }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"primary\",\n                disabled: busyId === id,\n                onClick: () => openRoleModal(u, \"admin\"),\n                children: busyId === id ? \"...\" : \"ตั้งเป็น admin\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 216,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n                value: role,\n                disabled: busyId === id || isMe,\n                onChange: e => openRoleModal(u, e.target.value),\n                title: isMe ? \"ห้ามเปลี่ยนสิทธิ์ตัวเอง\" : \"\",\n                children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                  value: \"user\",\n                  children: \"user\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 231,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                  value: \"admin\",\n                  children: \"admin\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 232,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 225,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"ban\",\n                disabled: busyId === id || isMe,\n                onClick: () => openDeleteModal(u),\n                title: isMe ? \"ห้ามลบตัวเอง\" : \"ลบบัญชีผู้ใช้\",\n                children: \"\\u0E25\\u0E1A\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 235,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 205,\n              columnNumber: 19\n            }, this)]\n          }, id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 195,\n            columnNumber: 17\n          }, this);\n        }), !filtered.length && /*#__PURE__*/_jsxDEV(\"tr\", {\n          children: /*#__PURE__*/_jsxDEV(\"td\", {\n            colSpan: 5,\n            style: {\n              textAlign: \"center\",\n              color: \"#999\"\n            },\n            children: \"\\u0E44\\u0E21\\u0E48\\u0E1E\\u0E1A\\u0E1C\\u0E39\\u0E49\\u0E43\\u0E0A\\u0E49\\u0E15\\u0E32\\u0E21\\u0E40\\u0E07\\u0E37\\u0E48\\u0E2D\\u0E19\\u0E44\\u0E02\\u0E17\\u0E35\\u0E48\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 249,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 248,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(ConfirmModal, {\n      open: modal.open,\n      title: ((_modal$action = modal.action) === null || _modal$action === void 0 ? void 0 : _modal$action.type) === \"delete\" ? \"ยืนยันการลบบัญชีผู้ใช้\" : ((_modal$action2 = modal.action) === null || _modal$action2 === void 0 ? void 0 : _modal$action2.make) === \"admin\" ? \"ยืนยันการตั้งเป็นแอดมิน\" : \"ยืนยันการลดสิทธิ์เป็นผู้ใช้\",\n      subtitle: modal.user ? modal.user.email || modal.user.username || `ผู้ใช้ #${(_modal$user$id = modal.user.id) !== null && _modal$user$id !== void 0 ? _modal$user$id : modal.user.user_id}` : \"\",\n      busy: !!busyId,\n      onClose: () => setModal({\n        open: false,\n        action: null,\n        user: null\n      }),\n      onConfirm: confirmModal\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 258,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 155,\n    columnNumber: 5\n  }, this);\n}\n_s2(UserManagement, \"gsGcy+NhT12bA1xArZd0V0IWi3E=\");\n_c2 = UserManagement;\nvar _c, _c2;\n$RefreshReg$(_c, \"ConfirmModal\");\n$RefreshReg$(_c2, \"UserManagement\");","map":{"version":3,"names":["React","useEffect","useMemo","useState","api","toast","jsxDEV","_jsxDEV","ConfirmModal","open","title","subtitle","onClose","onConfirm","busy","_s","pw","setPw","className","onClick","children","e","stopPropagation","fileName","_jsxFileName","lineNumber","columnNumber","type","placeholder","value","onChange","target","disabled","trim","_c","UserManagement","_s2","_modal$action","_modal$action2","_modal$user$id","users","setUsers","loading","setLoading","q","setQ","roleFilter","setRoleFilter","busyId","setBusyId","me","setMe","id","role","modal","setModal","action","user","loadMe","_data$id","_data$role","r","get","data","loadUsers","_res$data","url","encodeURIComponent","res","Array","isArray","items","err","console","error","openRoleModal","makeRole","make","openDeleteModal","confirmModal","_user$id","userId","user_id","_res$data2","patch","confirm_password","updated","prev","map","u","_u$id","String","success","delete","filter","_u$id2","_err$response","_err$response$data","_err$response2","_err$response2$data","_err$response3","_err$response3$data","msg","response","message","detail","t","setTimeout","clearTimeout","filtered","list","ql","toLowerCase","name","full_name","email","username","matchQ","includes","is_admin","matchRole","style","textAlign","i","_u$id3","isAdmin","isMe","length","colSpan","color","_c2","$RefreshReg$"],"sources":["D:/project19/frontend/src/admin/UserManagement.js"],"sourcesContent":["// frontend/src/admin/UserManagement.jsx\r\nimport React, { useEffect, useMemo, useState } from \"react\";\r\nimport { api } from \"../lib/api\";\r\nimport { toast } from \"react-hot-toast\";\r\nimport \"./UserManagement.css\";\r\n\r\nfunction ConfirmModal({ open, title, subtitle, onClose, onConfirm, busy }) {\r\n  const [pw, setPw] = useState(\"\");\r\n  useEffect(() => { if (!open) setPw(\"\"); }, [open]);\r\n\r\n  if (!open) return null;\r\n  return (\r\n    <div className=\"umodal-backdrop\" onClick={onClose}>\r\n      <div className=\"umodal\" onClick={(e) => e.stopPropagation()}>\r\n        <h3>{title}</h3>\r\n        {subtitle && <p className=\"umodal-sub\">{subtitle}</p>}\r\n        <label className=\"umodal-label\">รหัสผ่านแอดมินเพื่อยืนยัน</label>\r\n        <input\r\n          type=\"password\"\r\n          className=\"umodal-input\"\r\n          placeholder=\"••••••••\"\r\n          value={pw}\r\n          onChange={(e) => setPw(e.target.value)}\r\n        />\r\n        <div className=\"umodal-actions\">\r\n          <button className=\"ghost\" onClick={onClose} disabled={busy}>ยกเลิก</button>\r\n          <button\r\n            className=\"primary\"\r\n            onClick={() => onConfirm(pw)}\r\n            disabled={busy || !pw.trim()}\r\n          >\r\n            {busy ? \"กำลังดำเนินการ…\" : \"ยืนยัน\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function UserManagement() {\r\n  const [users, setUsers] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [q, setQ] = useState(\"\");\r\n  const [roleFilter, setRoleFilter] = useState(\"all\");\r\n  const [busyId, setBusyId] = useState(null);\r\n  const [me, setMe] = useState({ id: null, role: null });\r\n\r\n  const [modal, setModal] = useState({ open: false, action: null, user: null });\r\n\r\n  async function loadMe() {\r\n    try {\r\n      const r = await api.get(\"/api/admin/me\");\r\n      const data = r?.data || r;\r\n      setMe({ id: data?.id ?? null, role: data?.role ?? null });\r\n    } catch (e) {\r\n      // เงียบไว้ ถ้าระบบ auth ไม่ส่งมา\r\n      setMe({ id: null, role: null });\r\n    }\r\n  }\r\n\r\n  async function loadUsers() {\r\n    setLoading(true);\r\n    try {\r\n      const url = `/api/admin/users?q=${encodeURIComponent(q)}&role=${roleFilter}`;\r\n      const res = await api.get(url);\r\n      const data = Array.isArray(res) ? res : (res?.items || res?.data?.items || []);\r\n      setUsers(data);\r\n    } catch (err) {\r\n      console.error(\"Load users failed:\", err);\r\n      toast.error(\"โหลดรายชื่อผู้ใช้ไม่สำเร็จ\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  function openRoleModal(user, makeRole) {\r\n    setModal({\r\n      open: true,\r\n      action: { type: \"role\", make: makeRole },\r\n      user\r\n    });\r\n  }\r\n\r\n  function openDeleteModal(user) {\r\n    setModal({\r\n      open: true,\r\n      action: { type: \"delete\" },\r\n      user\r\n    });\r\n  }\r\n\r\n  async function confirmModal(pw) {\r\n    const { user, action } = modal;\r\n    if (!user || !action) return;\r\n\r\n    const userId = user.id ?? user.user_id;\r\n    setBusyId(userId);\r\n\r\n    try {\r\n      if (action.type === \"role\") {\r\n        const makeRole = action.make;\r\n        const res = await api.patch(`/api/admin/users/${userId}/role`, {\r\n          make: makeRole,\r\n          confirm_password: pw.trim(),\r\n        });\r\n        const updated = res?.user || res?.data?.user;\r\n        if (updated) {\r\n          setUsers(prev => prev.map(u => String(u.id ?? u.user_id) === String(userId) ? updated : u));\r\n        }\r\n        toast.success(\r\n          makeRole === \"admin\" ? `ตั้งเป็น admin สำเร็จ` : `ลดสิทธิ์เป็น user สำเร็จ`\r\n        );\r\n      } else if (action.type === \"delete\") {\r\n        await api.delete(`/api/admin/users/${userId}`, { data: { confirm_password: pw.trim() } });\r\n        setUsers(prev => prev.filter(u => String(u.id ?? u.user_id) !== String(userId)));\r\n        toast.success(`ลบบัญชีผู้ใช้สำเร็จ`);\r\n      }\r\n      setModal({ open: false, user: null, action: null });\r\n    } catch (err) {\r\n      console.error(\"Action failed:\", err);\r\n      const msg =\r\n        err?.response?.data?.message ||\r\n        err?.response?.data?.detail ||\r\n        err?.response?.data?.error ||\r\n        \"ดำเนินการไม่สำเร็จ\";\r\n      toast.error(String(msg));\r\n    } finally {\r\n      setBusyId(null);\r\n    }\r\n  }\r\n\r\n  useEffect(() => { loadMe(); loadUsers(); }, []);\r\n  useEffect(() => {\r\n    const t = setTimeout(loadUsers, 300);\r\n    return () => clearTimeout(t);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [q, roleFilter]);\r\n\r\n  const filtered = useMemo(() => {\r\n    const list = users || [];\r\n    if (!q && (roleFilter === \"all\" || !roleFilter)) return list;\r\n    const ql = q.trim().toLowerCase();\r\n    return list.filter((u) => {\r\n      const name = (u.full_name || u.name || \"\").toLowerCase();\r\n      const email = (u.email || \"\").toLowerCase();\r\n      const username = (u.username || \"\").toLowerCase();\r\n      const matchQ = ql ? (name.includes(ql) || email.includes(ql) || username.includes(ql)) : true;\r\n      const role = (u.role || (u.is_admin ? \"admin\" : \"user\")) || \"user\";\r\n      const matchRole = roleFilter === \"all\" ? true : role === roleFilter;\r\n      return matchQ && matchRole;\r\n    });\r\n  }, [users, q, roleFilter]);\r\n\r\n  return (\r\n    <div className=\"user-page\">\r\n      <h2>จัดการสถานะผู้ใช้</h2>\r\n\r\n      <div className=\"toolbar\">\r\n        <input\r\n          placeholder=\"ค้นชื่อ/อีเมล/username…\"\r\n          value={q}\r\n          onChange={(e) => setQ(e.target.value)}\r\n        />\r\n        <select value={roleFilter} onChange={(e) => setRoleFilter(e.target.value)}>\r\n          <option value=\"all\">ทั้งหมด</option>\r\n          <option value=\"admin\">admin</option>\r\n          <option value=\"user\">user</option>\r\n        </select>\r\n        <button onClick={loadUsers} disabled={loading}>\r\n          รีเฟรช\r\n        </button>\r\n      </div>\r\n\r\n      {loading ? (\r\n        <p>กำลังโหลด...</p>\r\n      ) : (\r\n        <table className=\"user-table\">\r\n          <thead>\r\n            <tr>\r\n              <th>#</th>\r\n              <th style={{ textAlign: \"left\" }}>ชื่อ</th>\r\n              <th style={{ textAlign: \"left\" }}>อีเมล / ผู้ใช้</th>\r\n              <th>บทบาท</th>\r\n              <th>จัดการ</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {filtered.map((u, i) => {\r\n              const id = u.id ?? u.user_id;\r\n              const isAdmin = !!u.is_admin || u.role === \"admin\";\r\n              const role = u.role || (isAdmin ? \"admin\" : \"user\");\r\n              const isMe = me?.id && String(me.id) === String(id);\r\n\r\n              return (\r\n                <tr key={id}>\r\n                  <td>{i + 1}</td>\r\n                  <td style={{ textAlign: \"left\" }}>{u.full_name || u.name || \"-\"}</td>\r\n                  <td style={{ textAlign: \"left\" }}>{u.email || u.username || \"-\"}</td>\r\n                  <td>\r\n                    <span className={`badge ${isAdmin ? \"badge-admin\" : \"\"}`}>\r\n                      {role}\r\n                    </span>\r\n                    {isMe && <span className=\"chip-me\">คุณ</span>}\r\n                  </td>\r\n                  <td className=\"actions\">\r\n                    {isAdmin ? (\r\n                      <button\r\n                        className=\"ghost\"\r\n                        disabled={busyId === id || isMe}\r\n                        onClick={() => openRoleModal(u, \"user\")}\r\n                        title={isMe ? \"ห้ามลดสิทธิ์ตัวเอง\" : \"ลดสิทธิ์เป็น user\"}\r\n                      >\r\n                        {busyId === id ? \"...\" : \"ลดสิทธิ์เป็น user\"}\r\n                      </button>\r\n                    ) : (\r\n                      <button\r\n                        className=\"primary\"\r\n                        disabled={busyId === id}\r\n                        onClick={() => openRoleModal(u, \"admin\")}\r\n                      >\r\n                        {busyId === id ? \"...\" : \"ตั้งเป็น admin\"}\r\n                      </button>\r\n                    )}\r\n\r\n                    <select\r\n                      value={role}\r\n                      disabled={busyId === id || isMe}\r\n                      onChange={(e) => openRoleModal(u, e.target.value)}\r\n                      title={isMe ? \"ห้ามเปลี่ยนสิทธิ์ตัวเอง\" : \"\"}\r\n                    >\r\n                      <option value=\"user\">user</option>\r\n                      <option value=\"admin\">admin</option>\r\n                    </select>\r\n\r\n                    <button\r\n                      className=\"ban\"\r\n                      disabled={busyId === id || isMe}\r\n                      onClick={() => openDeleteModal(u)}\r\n                      title={isMe ? \"ห้ามลบตัวเอง\" : \"ลบบัญชีผู้ใช้\"}\r\n                    >\r\n                      ลบ\r\n                    </button>\r\n                  </td>\r\n                </tr>\r\n              );\r\n            })}\r\n            {!filtered.length && (\r\n              <tr>\r\n                <td colSpan={5} style={{ textAlign: \"center\", color: \"#999\" }}>\r\n                  ไม่พบผู้ใช้ตามเงื่อนไขที่เลือก\r\n                </td>\r\n              </tr>\r\n            )}\r\n          </tbody>\r\n        </table>\r\n      )}\r\n\r\n      <ConfirmModal\r\n        open={modal.open}\r\n        title={\r\n          modal.action?.type === \"delete\"\r\n            ? \"ยืนยันการลบบัญชีผู้ใช้\"\r\n            : modal.action?.make === \"admin\"\r\n              ? \"ยืนยันการตั้งเป็นแอดมิน\"\r\n              : \"ยืนยันการลดสิทธิ์เป็นผู้ใช้\"\r\n        }\r\n        subtitle={\r\n          modal.user\r\n            ? (modal.user.email || modal.user.username || `ผู้ใช้ #${modal.user.id ?? modal.user.user_id}`)\r\n            : \"\"\r\n        }\r\n        busy={!!busyId}\r\n        onClose={() => setModal({ open: false, action: null, user: null })}\r\n        onConfirm={confirmModal}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}