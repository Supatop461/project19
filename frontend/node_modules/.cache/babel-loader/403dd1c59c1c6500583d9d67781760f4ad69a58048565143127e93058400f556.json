{"ast":null,"code":"var _jsxFileName = \"D:\\\\project19\\\\frontend\\\\src\\\\admin\\\\ProductManagement.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$(),\n  _s3 = $RefreshSig$(),\n  _s4 = $RefreshSig$();\n/* === ProductManagement.js (Part 1/4) START === */\nimport React, { useState, useEffect, useCallback, useRef, useMemo } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport \"./ProductManagement.css\";\nimport { api, path } from \"../lib/api\";\nimport { useLookups } from \"../lib/lookups\";\n\n/* =========================\r\n   Helper Functions\r\n========================= */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst asStr = v => v === null || v === undefined ? \"\" : String(v);\nconst pickStatusName = x => {\n  var _ref, _ref2, _x$status_name;\n  return (_ref = (_ref2 = (_x$status_name = x === null || x === void 0 ? void 0 : x.status_name) !== null && _x$status_name !== void 0 ? _x$status_name : x === null || x === void 0 ? void 0 : x.StatusName) !== null && _ref2 !== void 0 ? _ref2 : x === null || x === void 0 ? void 0 : x.name) !== null && _ref !== void 0 ? _ref : \"\";\n};\nconst toInt = v => {\n  const n = parseInt(String(v !== null && v !== void 0 ? v : \"\").trim(), 10);\n  return Number.isFinite(n) ? n : null;\n};\nconst toNum = v => {\n  if (v === null || v === undefined) return null;\n  const n = Number(String(v).replace(/[,\\s฿]/g, \"\"));\n  return Number.isFinite(n) ? n : null;\n};\n\n/* =========================\r\n   Tiny Toast (in-file)\r\n========================= */\nfunction useToasts() {\n  _s();\n  const [toasts, setToasts] = useState([]);\n  const addToast = useCallback((text, type = \"info\") => {\n    const id = Math.random().toString(36).slice(2);\n    setToasts(prev => [...prev, {\n      id,\n      text,\n      type\n    }]);\n    setTimeout(() => {\n      setToasts(prev => prev.filter(t => t.id !== id));\n    }, 2800);\n  }, []);\n  const Toasts = useMemo(() => /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"toast-container\",\n    children: toasts.map(t => /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `toast ${t.type}`,\n      children: t.text\n    }, t.id, false, {\n      fileName: _jsxFileName,\n      lineNumber: 49,\n      columnNumber: 11\n    }, this))\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 47,\n    columnNumber: 7\n  }, this), [toasts]);\n  return {\n    addToast,\n    Toasts\n  };\n}\n\n/* =========================\r\n   ProductManagement Component\r\n========================= */\n_s(useToasts, \"5reQEK4aGyvDuVCRmVQvN0iNI88=\");\nexport default function ProductManagement() {\n  _s2();\n  const {\n    addToast,\n    Toasts\n  } = useToasts();\n\n  // ─── State ─────────────────────────────\n  const [products, setProducts] = useState([]);\n  const [statuses, setStatuses] = useState([]);\n  const [selectedProduct, setSelectedProduct] = useState(null);\n  const [variants, setVariants] = useState([]);\n  const [options, setOptions] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [search, setSearch] = useState(\"\");\n  const [addingProduct, setAddingProduct] = useState(false);\n  const {\n    units,\n    categories\n  } = useLookups();\n\n  /* =========================\r\n     Fetch Products / Status\r\n  ========================= */\n  const fetchStatuses = useCallback(async () => {\n    try {\n      const res = await api.get(path(\"statuses\"));\n      setStatuses(res || []);\n    } catch (err) {\n      console.error(err);\n      addToast(\"โหลดสถานะไม่สำเร็จ\", \"error\");\n    }\n  }, [addToast]);\n  const fetchProducts = useCallback(async () => {\n    try {\n      setLoading(true);\n      const res = await api.get(path(\"admin/products\"));\n      setProducts(res || []);\n    } catch (err) {\n      console.error(err);\n      addToast(\"โหลดสินค้าล้มเหลว\", \"error\");\n    } finally {\n      setLoading(false);\n    }\n  }, [addToast]);\n  useEffect(() => {\n    fetchStatuses();\n    fetchProducts();\n  }, [fetchStatuses, fetchProducts]);\n\n  /* =========================\r\n     Select Product to Manage\r\n  ========================= */\n  const handleSelectProduct = useCallback(p => {\n    setSelectedProduct(prev => prev && prev.product_id === p.product_id ? null : p);\n    setVariants([]);\n    setOptions([]);\n  }, []);\n\n  /* =========================\r\n     Search Filter\r\n  ========================= */\n  const filteredProducts = useMemo(() => {\n    const s = search.trim().toLowerCase();\n    if (!s) return products;\n    return products.filter(p => (p.product_name || \"\").toLowerCase().includes(s));\n  }, [search, products]);\n\n  /* =========================\r\n     Add New Product\r\n  ========================= */\n  const [newProduct, setNewProduct] = useState({\n    product_name: \"\",\n    category_id: \"\",\n    price: \"\",\n    unit_id: \"\",\n    description: \"\"\n  });\n  const handleAddProduct = async () => {\n    try {\n      if (!newProduct.product_name) {\n        addToast(\"กรุณากรอกชื่อสินค้า\", \"warn\");\n        return;\n      }\n      setAddingProduct(true);\n      const res = await api.post(path(\"admin/products\"), newProduct);\n      addToast(\"เพิ่มสินค้าใหม่แล้ว\", \"ok\");\n      setNewProduct({\n        product_name: \"\",\n        category_id: \"\",\n        price: \"\",\n        unit_id: \"\",\n        description: \"\"\n      });\n      fetchProducts();\n    } catch (err) {\n      console.error(err);\n      addToast(\"เพิ่มสินค้าไม่สำเร็จ\", \"error\");\n    } finally {\n      setAddingProduct(false);\n    }\n  };\n  /* === ProductManagement.js (Part 1/4) END === */\n  /* === ProductManagement.js (Part 2/4) START === */\n\n  /* =========================\r\n     Table of Products\r\n  ========================= */\n  const renderTable = () => /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"product-table-wrapper\",\n    children: /*#__PURE__*/_jsxDEV(\"table\", {\n      className: \"product-table\",\n      children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n        children: /*#__PURE__*/_jsxDEV(\"tr\", {\n          children: [/*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"\\u0E0A\\u0E37\\u0E48\\u0E2D\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 178,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"\\u0E2B\\u0E21\\u0E27\\u0E14\\u0E2B\\u0E21\\u0E39\\u0E48\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 179,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"\\u0E23\\u0E32\\u0E04\\u0E32\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 180,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"\\u0E04\\u0E07\\u0E40\\u0E2B\\u0E25\\u0E37\\u0E2D\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 181,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"\\u0E2A\\u0E16\\u0E32\\u0E19\\u0E30\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 182,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"\\u0E08\\u0E31\\u0E14\\u0E01\\u0E32\\u0E23\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 183,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n        children: filteredProducts.map(p => {\n          var _p$stock;\n          return /*#__PURE__*/_jsxDEV(\"tr\", {\n            className: selectedProduct && selectedProduct.product_id === p.product_id ? \"selected\" : \"\",\n            children: [/*#__PURE__*/_jsxDEV(\"td\", {\n              children: p.product_name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 197,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: p.category_name || \"-\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 198,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: p.price ? `${p.price}฿` : \"-\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 199,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: (_p$stock = p.stock) !== null && _p$stock !== void 0 ? _p$stock : 0\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 200,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: pickStatusName(p.status)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 201,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"btn-manage\",\n                onClick: () => handleSelectProduct(p),\n                children: selectedProduct && selectedProduct.product_id === p.product_id ? \"ซ่อน\" : \"จัดการ\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 203,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 202,\n              columnNumber: 15\n            }, this)]\n          }, p.product_id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 188,\n            columnNumber: 13\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 174,\n    columnNumber: 5\n  }, this);\n\n  /* =========================\r\n     Render Selected Product Panel\r\n  ========================= */\n  const renderPanel = () => {\n    if (!selectedProduct) return null;\n    const p = selectedProduct;\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"product-panel\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: [\"\\u0E23\\u0E32\\u0E22\\u0E25\\u0E30\\u0E40\\u0E2D\\u0E35\\u0E22\\u0E14\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32: \", p.product_name]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"product-detail\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"\\u0E2B\\u0E21\\u0E27\\u0E14\\u0E2B\\u0E21\\u0E39\\u0E48:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 232,\n            columnNumber: 13\n          }, this), \" \", p.category_name]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 231,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"\\u0E23\\u0E32\\u0E04\\u0E32:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 235,\n            columnNumber: 13\n          }, this), \" \", p.price, \"\\u0E3F\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"\\u0E2A\\u0E16\\u0E32\\u0E19\\u0E30:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 238,\n            columnNumber: 13\n          }, this), \" \", pickStatusName(p.status)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 237,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"\\u0E23\\u0E32\\u0E22\\u0E25\\u0E30\\u0E40\\u0E2D\\u0E35\\u0E22\\u0E14:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 241,\n            columnNumber: 13\n          }, this), \" \", p.description || \"ไม่มีรายละเอียด\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 240,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 9\n      }, this), renderVariantManager(), renderBottomActions()]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 7\n    }, this);\n  };\n\n  /* =========================\r\n     Main Render\r\n  ========================= */\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"product-page\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"\\u0E08\\u0E31\\u0E14\\u0E01\\u0E32\\u0E23\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32 (Full Mode)\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 259,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"toolbar\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        placeholder: \"\\uD83D\\uDD0D \\u0E04\\u0E49\\u0E19\\u0E2B\\u0E32\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32...\",\n        value: search,\n        onChange: e => setSearch(e.target.value)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 263,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn-add\",\n        onClick: handleAddProduct,\n        disabled: addingProduct,\n        children: \"\\u2795 \\u0E40\\u0E1E\\u0E34\\u0E48\\u0E21\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32\\u0E43\\u0E2B\\u0E21\\u0E48\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 269,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"new-product-form\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        placeholder: \"\\u0E0A\\u0E37\\u0E48\\u0E2D\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32\",\n        value: newProduct.product_name,\n        onChange: e => setNewProduct({\n          ...newProduct,\n          product_name: e.target.value\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 280,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n        value: newProduct.category_id,\n        onChange: e => setNewProduct({\n          ...newProduct,\n          category_id: e.target.value\n        }),\n        children: [/*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"\",\n          children: \"\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\\u0E2B\\u0E21\\u0E27\\u0E14\\u0E2B\\u0E21\\u0E39\\u0E48\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 294,\n          columnNumber: 11\n        }, this), categories.map(c => /*#__PURE__*/_jsxDEV(\"option\", {\n          value: c.id,\n          children: c.name\n        }, c.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 296,\n          columnNumber: 13\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 288,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"number\",\n        placeholder: \"\\u0E23\\u0E32\\u0E04\\u0E32 (\\u0E3F)\",\n        value: newProduct.price,\n        onChange: e => setNewProduct({\n          ...newProduct,\n          price: e.target.value\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 301,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n        value: newProduct.unit_id,\n        onChange: e => setNewProduct({\n          ...newProduct,\n          unit_id: e.target.value\n        }),\n        children: [/*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"\",\n          children: \"\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\\u0E2B\\u0E19\\u0E48\\u0E27\\u0E22\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 315,\n          columnNumber: 11\n        }, this), units.map(u => /*#__PURE__*/_jsxDEV(\"option\", {\n          value: u.id,\n          children: u.name\n        }, u.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 317,\n          columnNumber: 13\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 309,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n        placeholder: \"\\u0E23\\u0E32\\u0E22\\u0E25\\u0E30\\u0E40\\u0E2D\\u0E35\\u0E22\\u0E14\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32\",\n        value: newProduct.description,\n        onChange: e => setNewProduct({\n          ...newProduct,\n          description: e.target.value\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 322,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 279,\n      columnNumber: 7\n    }, this), loading ? /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"\\u0E01\\u0E33\\u0E25\\u0E31\\u0E07\\u0E42\\u0E2B\\u0E25\\u0E14\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 332,\n      columnNumber: 18\n    }, this) : renderTable(), renderPanel(), Toasts]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 258,\n    columnNumber: 5\n  }, this);\n}\n/* === ProductManagement.js (Part 2/4) END === */\n/* === ProductManagement.js (Part 3/4) START === */\n\n/* =========================\r\n   VARIANT MANAGER (3 levels)\r\n   - Options (up to 3): e.g., สี / ขนาด / วัสดุ\r\n   - Values per option\r\n   - Auto-generate combinations\r\n   - Per-variant: SKU, price, stock, images, delete\r\n========================= */\n\n// ---- Local helpers for variants ----\n_s2(ProductManagement, \"aahBWDxlY7UtZpwNaZogvGFQ/tY=\", false, function () {\n  return [useToasts, useLookups];\n});\n_c = ProductManagement;\nconst normalizeOptionName = s => asStr(s).trim();\nconst normalizeValue = s => asStr(s).trim();\nfunction cartesianProduct(arrays) {\n  // arrays: [ [a,b], [c,d], [e] ] → [[a,c,e],[a,d,e],[b,c,e],[b,d,e]]\n  if (!arrays.length) return [];\n  return arrays.reduce((acc, cur) => acc.map(x => cur.map(y => x.concat([y]))).reduce((a, b) => a.concat(b), []), [[]]);\n}\nfunction makeTempId() {\n  return \"tmp_\" + Math.random().toString(36).slice(2, 10);\n}\n\n// ---- State & loaders for variant manager ----\nconst [variantLoading, setVariantLoading] = useState(false);\nconst [savingVariants, setSavingVariants] = useState(false);\nconst [imageInputMap] = useState({}); // refs-in-object for per-row file inputs\n\n// options = [ { name:'สี', values:['เขียว','ดำ'] }, { name:'ขนาด', values:['S','M'] }, ... ]\nconst maxOptions = 3;\n\n// ---- Add/Remove Option Rows ----\nconst addOption = () => {\n  if (options.length >= maxOptions) {\n    addToast(\"รองรับสูงสุด 3 ตัวเลือก\", \"warn\");\n    return;\n  }\n  setOptions(prev => [...prev, {\n    name: \"\",\n    values: []\n  }]);\n};\nconst removeOption = idx => {\n  setOptions(prev => prev.filter((_, i) => i !== idx));\n};\nconst updateOptionName = (idx, name) => {\n  setOptions(prev => prev.map((o, i) => i === idx ? {\n    ...o,\n    name\n  } : o));\n};\nconst addOptionValue = (idx, value) => {\n  const v = normalizeValue(value);\n  if (!v) return;\n  setOptions(prev => prev.map((o, i) => i === idx ? {\n    ...o,\n    values: Array.from(new Set([...(o.values || []), v]))\n  } : o));\n};\nconst removeOptionValue = (idx, value) => {\n  setOptions(prev => prev.map((o, i) => i === idx ? {\n    ...o,\n    values: (o.values || []).filter(x => x !== value)\n  } : o));\n};\n\n// ---- Generate Variant rows (combinations) ----\nconst generateCombinations = () => {\n  const valid = options.map(o => ({\n    name: normalizeOptionName(o.name),\n    values: (o.values || []).map(v => normalizeValue(v)).filter(Boolean)\n  })).filter(o => o.name && o.values.length);\n  if (valid.length === 0) {\n    addToast(\"กรุณาเพิ่มตัวเลือกและค่าอย่างน้อย 1 ชุด\", \"warn\");\n    return;\n  }\n  const arrays = valid.map(o => o.values);\n  const combos = cartesianProduct(arrays);\n\n  // map combo → key & row\n  const makeKey = combo => combo.join(\"||\").toLowerCase();\n\n  // keep existing edits (price/stock/sku/images) if same combo appears\n  const existingMap = new Map((variants || []).map(v => [makeKey([v.opt1, v.opt2, v.opt3].filter(Boolean)), v]));\n  const next = combos.map(combo => {\n    var _selectedProduct;\n    const [c1, c2, c3] = combo;\n    const k = makeKey(combo);\n    const ex = existingMap.get(k);\n    return ex || {\n      temp_id: makeTempId(),\n      product_id: (_selectedProduct = selectedProduct) === null || _selectedProduct === void 0 ? void 0 : _selectedProduct.product_id,\n      opt1: c1 !== null && c1 !== void 0 ? c1 : null,\n      opt2: c2 !== null && c2 !== void 0 ? c2 : null,\n      opt3: c3 !== null && c3 !== void 0 ? c3 : null,\n      sku: \"\",\n      price: \"\",\n      stock: \"\",\n      images: [],\n      // [{image_id, url, alt_text}]\n      is_published: true\n    };\n  });\n  setVariants(next);\n  addToast(\"สร้างรายการตัวเลือกอัตโนมัติแล้ว\", \"ok\");\n};\n\n// ---- Save all variants (upsert) ----\nconst saveAllVariants = async () => {\n  var _selectedProduct2;\n  if (!((_selectedProduct2 = selectedProduct) !== null && _selectedProduct2 !== void 0 && _selectedProduct2.product_id)) {\n    addToast(\"กรุณาเลือกสินค้าก่อน\", \"warn\");\n    return;\n  }\n  if (!variants.length) {\n    addToast(\"ไม่มีรายการตัวเลือกให้บันทึก\", \"warn\");\n    return;\n  }\n  setSavingVariants(true);\n  try {\n    // upsert one-by-one to be robust with most APIs\n    for (const v of variants) {\n      var _toNum, _toInt;\n      const body = {\n        product_id: selectedProduct.product_id,\n        options: [v.opt1, v.opt2, v.opt3].filter(Boolean),\n        sku: asStr(v.sku),\n        price: (_toNum = toNum(v.price)) !== null && _toNum !== void 0 ? _toNum : 0,\n        stock: (_toInt = toInt(v.stock)) !== null && _toInt !== void 0 ? _toInt : 0,\n        published: !!v.is_published\n      };\n      await api.post(path(\"variants/upsert-single\"), body);\n    }\n    addToast(\"บันทึกตัวเลือกสำเร็จ\", \"ok\");\n    // Optionally, reload from backend if you want fresh IDs\n  } catch (err) {\n    console.error(err);\n    addToast(\"บันทึกตัวเลือกไม่สำเร็จ\", \"error\");\n  } finally {\n    setSavingVariants(false);\n  }\n};\n\n// ---- Delete single variant ----\nconst handleDeleteVariant = async variantIdOrTemp => {\n  // if no real id → just remove from state\n  const isTemp = String(variantIdOrTemp || \"\").startsWith(\"tmp_\");\n  if (isTemp || !variantIdOrTemp) {\n    setVariants(prev => prev.filter(x => x.temp_id !== variantIdOrTemp));\n    addToast(\"ลบตัวเลือกออกแล้ว\", \"ok\");\n    return;\n  }\n  if (!window.confirm(\"คุณต้องการลบตัวเลือกนี้จริงหรือไม่?\")) return;\n  try {\n    await api.delete(path(`variants/${variantIdOrTemp}`));\n    setVariants(prev => prev.filter(x => x.variant_id !== variantIdOrTemp));\n    addToast(\"ลบตัวเลือกเรียบร้อย\", \"ok\");\n  } catch (err) {\n    console.error(err);\n    addToast(\"ลบตัวเลือกไม่สำเร็จ\", \"error\");\n  }\n};\n\n// ---- Image: upload / remove per variant ----\nconst uploadVariantImage = async (v, file) => {\n  var _selectedProduct3;\n  if (!file || !((_selectedProduct3 = selectedProduct) !== null && _selectedProduct3 !== void 0 && _selectedProduct3.product_id)) return;\n  try {\n    var _v$variant_id;\n    const fd = new FormData();\n    fd.append(\"file\", file);\n    fd.append(\"product_id\", selectedProduct.product_id);\n    if (v !== null && v !== void 0 && v.variant_id) fd.append(\"variant_id\", v.variant_id);\n\n    // You can adjust this path to your productImages route\n    const res = await api.upload(path(\"product-images/upload\"), fd);\n    const img = {\n      image_id: (res === null || res === void 0 ? void 0 : res.image_id) || makeTempId(),\n      url: (res === null || res === void 0 ? void 0 : res.url) || (res === null || res === void 0 ? void 0 : res.image_url),\n      alt_text: (res === null || res === void 0 ? void 0 : res.alt_text) || null,\n      variant_id: (_v$variant_id = v === null || v === void 0 ? void 0 : v.variant_id) !== null && _v$variant_id !== void 0 ? _v$variant_id : null\n    };\n    setVariants(prev => prev.map(row => row === v ? {\n      ...row,\n      images: [...(row.images || []), img]\n    } : row));\n    addToast(\"อัปโหลดรูปสำเร็จ\", \"ok\");\n  } catch (err) {\n    console.error(err);\n    addToast(\"อัปโหลดรูปไม่สำเร็จ\", \"error\");\n  }\n};\nconst removeVariantImage = async (v, image) => {\n  try {\n    if (image !== null && image !== void 0 && image.image_id && !String(image.image_id).startsWith(\"tmp_\")) {\n      await api.delete(path(`product-images/${image.image_id}`));\n    }\n    setVariants(prev => prev.map(row => row === v ? {\n      ...row,\n      images: (row.images || []).filter(im => im !== image)\n    } : row));\n    addToast(\"ลบรูปแล้ว\", \"ok\");\n  } catch (err) {\n    console.error(err);\n    addToast(\"ลบรูปไม่สำเร็จ\", \"error\");\n  }\n};\n\n// ---- Renderers: Options form & Variant table ----\nconst OptionRow = ({\n  idx,\n  data\n}) => {\n  _s3();\n  const [valueInput, setValueInput] = useState(\"\");\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"option-row\",\n    children: [/*#__PURE__*/_jsxDEV(\"input\", {\n      className: \"input\",\n      placeholder: `ชื่อตัวเลือกที่ ${idx + 1} (เช่น สี / ขนาด / วัสดุ)`,\n      value: data.name,\n      onChange: e => updateOptionName(idx, e.target.value)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 576,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"values\",\n      children: [(data.values || []).map(val => /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"chip\",\n        children: [val, /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"chip-x\",\n          onClick: () => removeOptionValue(idx, val),\n          title: \"\\u0E25\\u0E1A\\u0E04\\u0E48\\u0E32\\u0E19\\u0E35\\u0E49\",\n          children: \"\\xD7\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 586,\n          columnNumber: 13\n        }, this)]\n      }, val, true, {\n        fileName: _jsxFileName,\n        lineNumber: 584,\n        columnNumber: 11\n      }, this)), /*#__PURE__*/_jsxDEV(\"input\", {\n        className: \"input small\",\n        placeholder: \"\\u0E40\\u0E1E\\u0E34\\u0E48\\u0E21\\u0E04\\u0E48\\u0E32\\u0E43\\u0E2B\\u0E21\\u0E48 (Enter)\",\n        value: valueInput,\n        onChange: e => setValueInput(e.target.value),\n        onKeyDown: e => {\n          if (e.key === \"Enter\") {\n            addOptionValue(idx, valueInput);\n            setValueInput(\"\");\n          }\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 595,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 582,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn-ghost\",\n      onClick: () => removeOption(idx),\n      children: \"\\u0E25\\u0E1A\\u0E15\\u0E31\\u0E27\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 608,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 575,\n    columnNumber: 5\n  }, this);\n};\n_s3(OptionRow, \"xa1DAz87XWLKuelrA7QEpc3EzD8=\");\n_c2 = OptionRow;\nconst renderOptionsEditor = () => /*#__PURE__*/_jsxDEV(\"div\", {\n  className: \"variant-options\",\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"section-title\",\n    children: \"\\u0E15\\u0E31\\u0E27\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32 (\\u0E2A\\u0E39\\u0E07\\u0E2A\\u0E38\\u0E14 3 \\u0E15\\u0E31\\u0E27\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01)\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 617,\n    columnNumber: 5\n  }, this), options.map((o, i) => /*#__PURE__*/_jsxDEV(OptionRow, {\n    idx: i,\n    data: o\n  }, i, false, {\n    fileName: _jsxFileName,\n    lineNumber: 619,\n    columnNumber: 7\n  }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"option-actions\",\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn-green\",\n      onClick: addOption,\n      children: \"\\u2795 \\u0E40\\u0E1E\\u0E34\\u0E48\\u0E21\\u0E15\\u0E31\\u0E27\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 622,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn-primary\",\n      onClick: generateCombinations,\n      children: \"\\u2699\\uFE0F \\u0E2A\\u0E23\\u0E49\\u0E32\\u0E07\\u0E23\\u0E32\\u0E22\\u0E01\\u0E32\\u0E23\\u0E15\\u0E31\\u0E27\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\\u0E2D\\u0E31\\u0E15\\u0E42\\u0E19\\u0E21\\u0E31\\u0E15\\u0E34\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 625,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 621,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 616,\n  columnNumber: 3\n}, this);\nconst VariantRow = ({\n  v\n}) => {\n  _s4();\n  var _v$price, _v$stock;\n  const fileRef = useRef(null);\n  return /*#__PURE__*/_jsxDEV(\"tr\", {\n    children: [/*#__PURE__*/_jsxDEV(\"td\", {\n      children: v.opt1 || \"-\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 636,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n      children: v.opt2 || \"-\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 637,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n      children: v.opt3 || \"-\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 638,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n      children: /*#__PURE__*/_jsxDEV(\"input\", {\n        className: \"input small\",\n        placeholder: \"SKU\",\n        value: v.sku || \"\",\n        onChange: e => setVariants(prev => prev.map(x => x === v ? {\n          ...x,\n          sku: e.target.value\n        } : x))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 640,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 639,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n      children: /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"number\",\n        className: \"input small\",\n        placeholder: \"\\u0E23\\u0E32\\u0E04\\u0E32\",\n        value: (_v$price = v.price) !== null && _v$price !== void 0 ? _v$price : \"\",\n        onChange: e => setVariants(prev => prev.map(x => x === v ? {\n          ...x,\n          price: e.target.value\n        } : x))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 652,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 651,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n      children: /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"number\",\n        className: \"input small\",\n        placeholder: \"\\u0E2A\\u0E15\\u0E47\\u0E2D\\u0E01\",\n        value: (_v$stock = v.stock) !== null && _v$stock !== void 0 ? _v$stock : \"\",\n        onChange: e => setVariants(prev => prev.map(x => x === v ? {\n          ...x,\n          stock: e.target.value\n        } : x))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 665,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 664,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n      className: \"v-images\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"images\",\n        children: (v.images || []).map(im => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"img\",\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            src: im.url,\n            alt: im.alt_text || \"\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 681,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"img-x\",\n            onClick: () => removeVariantImage(v, im),\n            title: \"\\u0E25\\u0E1A\\u0E23\\u0E39\\u0E1B\\u0E19\\u0E35\\u0E49\",\n            children: \"\\xD7\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 682,\n            columnNumber: 15\n          }, this)]\n        }, im.image_id || im.url, true, {\n          fileName: _jsxFileName,\n          lineNumber: 680,\n          columnNumber: 13\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 678,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn-ghost\",\n        onClick: () => {\n          var _fileRef$current;\n          return (_fileRef$current = fileRef.current) === null || _fileRef$current === void 0 ? void 0 : _fileRef$current.click();\n        },\n        children: \"\\uD83D\\uDCF8 \\u0E40\\u0E1E\\u0E34\\u0E48\\u0E21\\u0E23\\u0E39\\u0E1B\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 692,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"file\",\n        accept: \"image/*\",\n        ref: fileRef,\n        style: {\n          display: \"none\"\n        },\n        onChange: e => {\n          var _e$target$files;\n          const f = (_e$target$files = e.target.files) === null || _e$target$files === void 0 ? void 0 : _e$target$files[0];\n          if (f) uploadVariantImage(v, f);\n          e.target.value = \"\";\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 698,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 677,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n      children: /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn-delete\",\n        onClick: () => handleDeleteVariant(v.variant_id || v.temp_id),\n        children: \"\\uD83D\\uDDD1\\uFE0F \\u0E25\\u0E1A\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 711,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 710,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 635,\n    columnNumber: 5\n  }, this);\n};\n_s4(VariantRow, \"4UJHyBFm9OsKaahfnaT9HCATB1E=\");\n_c3 = VariantRow;\nconst renderVariantTable = () => /*#__PURE__*/_jsxDEV(\"div\", {\n  className: \"variant-table-wrap\",\n  children: [/*#__PURE__*/_jsxDEV(\"table\", {\n    className: \"variant-table\",\n    children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n      children: /*#__PURE__*/_jsxDEV(\"tr\", {\n        children: [/*#__PURE__*/_jsxDEV(\"th\", {\n          children: \"\\u0E15\\u0E31\\u0E27\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01 1\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 729,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n          children: \"\\u0E15\\u0E31\\u0E27\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01 2\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 730,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n          children: \"\\u0E15\\u0E31\\u0E27\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01 3\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 731,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n          children: \"SKU\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 732,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n          children: \"\\u0E23\\u0E32\\u0E04\\u0E32\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 733,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n          children: \"\\u0E2A\\u0E15\\u0E47\\u0E2D\\u0E01\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 734,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n          children: \"\\uD83D\\uDCF8 \\u0E23\\u0E39\\u0E1B\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 735,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n          children: \"\\u0E25\\u0E1A\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 736,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 728,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 727,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n      children: variants.length ? variants.map(v => /*#__PURE__*/_jsxDEV(VariantRow, {\n        v: v\n      }, v.variant_id || v.temp_id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 742,\n        columnNumber: 13\n      }, this)) : /*#__PURE__*/_jsxDEV(\"tr\", {\n        children: /*#__PURE__*/_jsxDEV(\"td\", {\n          colSpan: 8,\n          className: \"muted\",\n          children: \"\\u0E22\\u0E31\\u0E07\\u0E44\\u0E21\\u0E48\\u0E21\\u0E35\\u0E23\\u0E32\\u0E22\\u0E01\\u0E32\\u0E23\\u0E15\\u0E31\\u0E27\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 746,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 745,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 739,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 726,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"variant-save\",\n    children: /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn-primary lg\",\n      disabled: !variants.length || savingVariants,\n      onClick: saveAllVariants,\n      children: \"\\uD83D\\uDCBE \\u0E1A\\u0E31\\u0E19\\u0E17\\u0E36\\u0E01\\u0E15\\u0E31\\u0E27\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\\u0E17\\u0E31\\u0E49\\u0E07\\u0E2B\\u0E21\\u0E14\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 755,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 754,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 725,\n  columnNumber: 3\n}, this);\n\n// ---- Entrypoint renderer for Variant Manager block ----\nconst renderVariantManager = () => {\n  if (!selectedProduct) return null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"variant-manager\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"section-head\",\n      children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n        children: \"\\u0E08\\u0E31\\u0E14\\u0E01\\u0E32\\u0E23\\u0E15\\u0E31\\u0E27\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 772,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"hint\",\n        children: \"\\u0E23\\u0E2D\\u0E07\\u0E23\\u0E31\\u0E1A\\u0E2A\\u0E39\\u0E07\\u0E2A\\u0E38\\u0E14 3 \\u0E15\\u0E31\\u0E27\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01 (\\u0E40\\u0E0A\\u0E48\\u0E19 \\u0E2A\\u0E35 / \\u0E02\\u0E19\\u0E32\\u0E14 / \\u0E27\\u0E31\\u0E2A\\u0E14\\u0E38)\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 773,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 771,\n      columnNumber: 7\n    }, this), renderOptionsEditor(), renderVariantTable()]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 770,\n    columnNumber: 5\n  }, this);\n};\n/* === ProductManagement.js (Part 3/4) END === */\n/* === ProductManagement.js (Part 4/4) START === */\n\n/* =========================\r\n   Bottom Actions (publish / archive / unarchive)\r\n========================= */\n\n// generic route try\nasync function tryRoutes(method, routes, body) {\n  let lastErr;\n  for (const r of routes) {\n    try {\n      const res = await api[method](r, body);\n      if (res && (res.ok || res.success || res.id || res.product_id)) return res;\n      if (res && res.data !== undefined) return res;\n    } catch (e) {\n      lastErr = e;\n    }\n  }\n  if (lastErr) throw lastErr;\n  throw new Error(\"No route matched\");\n}\nfunction updateProductLocal(setter, id, patch) {\n  setter(prev => prev.map(p => {\n    var _p$product_id;\n    return String((_p$product_id = p.product_id) !== null && _p$product_id !== void 0 ? _p$product_id : p.id) === String(id) ? {\n      ...p,\n      ...patch\n    } : p;\n  }));\n}\nasync function togglePublish(productId, nextPublished, {\n  setProducts,\n  toast\n}) {\n  try {\n    updateProductLocal(setProducts, productId, {\n      is_published: !!nextPublished\n    });\n    await tryRoutes(\"patch\", [path(`admin/products/${productId}/publish`), path(`admin/products/${productId}`)], {\n      is_published: !!nextPublished,\n      published: !!nextPublished\n    });\n    toast(nextPublished ? \"เผยแพร่สินค้าแล้ว\" : \"ปิดการขายแล้ว\");\n  } catch (e) {\n    updateProductLocal(setProducts, productId, {\n      is_published: !nextPublished\n    });\n    toast(\"อัปเดตสถานะไม่สำเร็จ\", \"error\");\n    console.error(e);\n  }\n}\nasync function archiveProduct(productId, {\n  setProducts,\n  toast\n}) {\n  try {\n    updateProductLocal(setProducts, productId, {\n      is_archived: true\n    });\n    await tryRoutes(\"patch\", [path(`admin/products/${productId}/archive`), path(`admin/products/${productId}`)], {\n      is_archived: true,\n      archived: true,\n      status: \"archived\"\n    });\n    toast(\"เก็บสินค้าเข้าคลังแล้ว\");\n  } catch (e) {\n    updateProductLocal(setProducts, productId, {\n      is_archived: false\n    });\n    toast(\"เก็บเข้าคลังไม่สำเร็จ\", \"error\");\n    console.error(e);\n  }\n}\nasync function unarchiveProduct(productId, {\n  setProducts,\n  toast\n}) {\n  try {\n    updateProductLocal(setProducts, productId, {\n      is_archived: false\n    });\n    await tryRoutes(\"patch\", [path(`admin/products/${productId}/unarchive`), path(`admin/products/${productId}`)], {\n      is_archived: false,\n      archived: false,\n      status: \"active\"\n    });\n    toast(\"คืนสินค้าจากคลังแล้ว\");\n  } catch (e) {\n    updateProductLocal(setProducts, productId, {\n      is_archived: true\n    });\n    toast(\"คืนจากคลังไม่สำเร็จ\", \"error\");\n    console.error(e);\n  }\n}\nconst renderBottomActions = () => {\n  if (!selectedProduct) return null;\n  const pid = selectedProduct.product_id;\n  const published = !!selectedProduct.is_published;\n  const archived = !!selectedProduct.is_archived;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"bottom-actions\",\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      className: published ? \"btn-outline\" : \"btn-green\",\n      onClick: () => togglePublish(pid, !published, {\n        setProducts,\n        toast: addToast\n      }),\n      children: published ? \"ปิดการขาย\" : \"เผยแพร่สินค้า\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 866,\n      columnNumber: 7\n    }, this), !archived ? /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn-outline\",\n      onClick: () => archiveProduct(pid, {\n        setProducts,\n        toast: addToast\n      }),\n      children: \"\\uD83D\\uDCE6 \\u0E40\\u0E01\\u0E47\\u0E1A\\u0E40\\u0E02\\u0E49\\u0E32\\u0E04\\u0E25\\u0E31\\u0E07\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 876,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn-outline\",\n      onClick: () => unarchiveProduct(pid, {\n        setProducts,\n        toast: addToast\n      }),\n      children: \"\\u267B\\uFE0F \\u0E04\\u0E37\\u0E19\\u0E08\\u0E32\\u0E01\\u0E04\\u0E25\\u0E31\\u0E07\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 883,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 865,\n    columnNumber: 5\n  }, this);\n};\n\n/* === ProductManagement.js (Part 4/4) END === */\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"ProductManagement\");\n$RefreshReg$(_c2, \"OptionRow\");\n$RefreshReg$(_c3, \"VariantRow\");","map":{"version":3,"names":["React","useState","useEffect","useCallback","useRef","useMemo","Link","api","path","useLookups","jsxDEV","_jsxDEV","asStr","v","undefined","String","pickStatusName","x","_ref","_ref2","_x$status_name","status_name","StatusName","name","toInt","n","parseInt","trim","Number","isFinite","toNum","replace","useToasts","_s","toasts","setToasts","addToast","text","type","id","Math","random","toString","slice","prev","setTimeout","filter","t","Toasts","className","children","map","fileName","_jsxFileName","lineNumber","columnNumber","ProductManagement","_s2","products","setProducts","statuses","setStatuses","selectedProduct","setSelectedProduct","variants","setVariants","options","setOptions","loading","setLoading","search","setSearch","addingProduct","setAddingProduct","units","categories","fetchStatuses","res","get","err","console","error","fetchProducts","handleSelectProduct","p","product_id","filteredProducts","s","toLowerCase","product_name","includes","newProduct","setNewProduct","category_id","price","unit_id","description","handleAddProduct","post","renderTable","_p$stock","category_name","stock","status","onClick","renderPanel","renderVariantManager","renderBottomActions","placeholder","value","onChange","e","target","disabled","c","u","_c","normalizeOptionName","normalizeValue","cartesianProduct","arrays","length","reduce","acc","cur","y","concat","a","b","makeTempId","variantLoading","setVariantLoading","savingVariants","setSavingVariants","imageInputMap","maxOptions","addOption","values","removeOption","idx","_","i","updateOptionName","o","addOptionValue","Array","from","Set","removeOptionValue","generateCombinations","valid","Boolean","combos","makeKey","combo","join","existingMap","Map","opt1","opt2","opt3","next","_selectedProduct","c1","c2","c3","k","ex","temp_id","sku","images","is_published","saveAllVariants","_selectedProduct2","_toNum","_toInt","body","published","handleDeleteVariant","variantIdOrTemp","isTemp","startsWith","window","confirm","delete","variant_id","uploadVariantImage","file","_selectedProduct3","_v$variant_id","fd","FormData","append","upload","img","image_id","url","image_url","alt_text","row","removeVariantImage","image","im","OptionRow","data","_s3","valueInput","setValueInput","val","title","onKeyDown","key","_c2","renderOptionsEditor","VariantRow","_s4","_v$price","_v$stock","fileRef","src","alt","_fileRef$current","current","click","accept","ref","style","display","_e$target$files","f","files","_c3","renderVariantTable","colSpan","tryRoutes","method","routes","lastErr","r","ok","success","Error","updateProductLocal","setter","patch","_p$product_id","togglePublish","productId","nextPublished","toast","archiveProduct","is_archived","archived","unarchiveProduct","pid","$RefreshReg$"],"sources":["D:/project19/frontend/src/admin/ProductManagement.js"],"sourcesContent":["/* === ProductManagement.js (Part 1/4) START === */\r\nimport React, {\r\n  useState,\r\n  useEffect,\r\n  useCallback,\r\n  useRef,\r\n  useMemo,\r\n} from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport \"./ProductManagement.css\";\r\nimport { api, path } from \"../lib/api\";\r\nimport { useLookups } from \"../lib/lookups\";\r\n\r\n/* =========================\r\n   Helper Functions\r\n========================= */\r\nconst asStr = (v) =>\r\n  v === null || v === undefined ? \"\" : String(v);\r\nconst pickStatusName = (x) =>\r\n  x?.status_name ?? x?.StatusName ?? x?.name ?? \"\";\r\nconst toInt = (v) => {\r\n  const n = parseInt(String(v ?? \"\").trim(), 10);\r\n  return Number.isFinite(n) ? n : null;\r\n};\r\nconst toNum = (v) => {\r\n  if (v === null || v === undefined) return null;\r\n  const n = Number(String(v).replace(/[,\\s฿]/g, \"\"));\r\n  return Number.isFinite(n) ? n : null;\r\n};\r\n\r\n/* =========================\r\n   Tiny Toast (in-file)\r\n========================= */\r\nfunction useToasts() {\r\n  const [toasts, setToasts] = useState([]);\r\n\r\n  const addToast = useCallback((text, type = \"info\") => {\r\n    const id = Math.random().toString(36).slice(2);\r\n    setToasts((prev) => [...prev, { id, text, type }]);\r\n    setTimeout(() => {\r\n      setToasts((prev) => prev.filter((t) => t.id !== id));\r\n    }, 2800);\r\n  }, []);\r\n\r\n  const Toasts = useMemo(\r\n    () => (\r\n      <div className=\"toast-container\">\r\n        {toasts.map((t) => (\r\n          <div key={t.id} className={`toast ${t.type}`}>\r\n            {t.text}\r\n          </div>\r\n        ))}\r\n      </div>\r\n    ),\r\n    [toasts]\r\n  );\r\n\r\n  return { addToast, Toasts };\r\n}\r\n\r\n/* =========================\r\n   ProductManagement Component\r\n========================= */\r\nexport default function ProductManagement() {\r\n  const { addToast, Toasts } = useToasts();\r\n\r\n  // ─── State ─────────────────────────────\r\n  const [products, setProducts] = useState([]);\r\n  const [statuses, setStatuses] = useState([]);\r\n  const [selectedProduct, setSelectedProduct] = useState(null);\r\n  const [variants, setVariants] = useState([]);\r\n  const [options, setOptions] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [search, setSearch] = useState(\"\");\r\n  const [addingProduct, setAddingProduct] = useState(false);\r\n\r\n  const { units, categories } = useLookups();\r\n\r\n  /* =========================\r\n     Fetch Products / Status\r\n  ========================= */\r\n  const fetchStatuses = useCallback(async () => {\r\n    try {\r\n      const res = await api.get(path(\"statuses\"));\r\n      setStatuses(res || []);\r\n    } catch (err) {\r\n      console.error(err);\r\n      addToast(\"โหลดสถานะไม่สำเร็จ\", \"error\");\r\n    }\r\n  }, [addToast]);\r\n\r\n  const fetchProducts = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await api.get(path(\"admin/products\"));\r\n      setProducts(res || []);\r\n    } catch (err) {\r\n      console.error(err);\r\n      addToast(\"โหลดสินค้าล้มเหลว\", \"error\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [addToast]);\r\n\r\n  useEffect(() => {\r\n    fetchStatuses();\r\n    fetchProducts();\r\n  }, [fetchStatuses, fetchProducts]);\r\n\r\n  /* =========================\r\n     Select Product to Manage\r\n  ========================= */\r\n  const handleSelectProduct = useCallback((p) => {\r\n    setSelectedProduct((prev) =>\r\n      prev && prev.product_id === p.product_id ? null : p\r\n    );\r\n    setVariants([]);\r\n    setOptions([]);\r\n  }, []);\r\n\r\n  /* =========================\r\n     Search Filter\r\n  ========================= */\r\n  const filteredProducts = useMemo(() => {\r\n    const s = search.trim().toLowerCase();\r\n    if (!s) return products;\r\n    return products.filter((p) =>\r\n      (p.product_name || \"\").toLowerCase().includes(s)\r\n    );\r\n  }, [search, products]);\r\n\r\n  /* =========================\r\n     Add New Product\r\n  ========================= */\r\n  const [newProduct, setNewProduct] = useState({\r\n    product_name: \"\",\r\n    category_id: \"\",\r\n    price: \"\",\r\n    unit_id: \"\",\r\n    description: \"\",\r\n  });\r\n\r\n  const handleAddProduct = async () => {\r\n    try {\r\n      if (!newProduct.product_name) {\r\n        addToast(\"กรุณากรอกชื่อสินค้า\", \"warn\");\r\n        return;\r\n      }\r\n      setAddingProduct(true);\r\n      const res = await api.post(path(\"admin/products\"), newProduct);\r\n      addToast(\"เพิ่มสินค้าใหม่แล้ว\", \"ok\");\r\n      setNewProduct({\r\n        product_name: \"\",\r\n        category_id: \"\",\r\n        price: \"\",\r\n        unit_id: \"\",\r\n        description: \"\",\r\n      });\r\n      fetchProducts();\r\n    } catch (err) {\r\n      console.error(err);\r\n      addToast(\"เพิ่มสินค้าไม่สำเร็จ\", \"error\");\r\n    } finally {\r\n      setAddingProduct(false);\r\n    }\r\n  };\r\n/* === ProductManagement.js (Part 1/4) END === */\r\n/* === ProductManagement.js (Part 2/4) START === */\r\n\r\n/* =========================\r\n   Table of Products\r\n========================= */\r\n  const renderTable = () => (\r\n    <div className=\"product-table-wrapper\">\r\n      <table className=\"product-table\">\r\n        <thead>\r\n          <tr>\r\n            <th>ชื่อสินค้า</th>\r\n            <th>หมวดหมู่</th>\r\n            <th>ราคา</th>\r\n            <th>คงเหลือ</th>\r\n            <th>สถานะ</th>\r\n            <th>จัดการ</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {filteredProducts.map((p) => (\r\n            <tr\r\n              key={p.product_id}\r\n              className={\r\n                selectedProduct &&\r\n                selectedProduct.product_id === p.product_id\r\n                  ? \"selected\"\r\n                  : \"\"\r\n              }\r\n            >\r\n              <td>{p.product_name}</td>\r\n              <td>{p.category_name || \"-\"}</td>\r\n              <td>{p.price ? `${p.price}฿` : \"-\"}</td>\r\n              <td>{p.stock ?? 0}</td>\r\n              <td>{pickStatusName(p.status)}</td>\r\n              <td>\r\n                <button\r\n                  className=\"btn-manage\"\r\n                  onClick={() => handleSelectProduct(p)}\r\n                >\r\n                  {selectedProduct &&\r\n                  selectedProduct.product_id === p.product_id\r\n                    ? \"ซ่อน\"\r\n                    : \"จัดการ\"}\r\n                </button>\r\n              </td>\r\n            </tr>\r\n          ))}\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  );\r\n\r\n/* =========================\r\n   Render Selected Product Panel\r\n========================= */\r\n  const renderPanel = () => {\r\n    if (!selectedProduct) return null;\r\n    const p = selectedProduct;\r\n\r\n    return (\r\n      <div className=\"product-panel\">\r\n        <h3>รายละเอียดสินค้า: {p.product_name}</h3>\r\n        <div className=\"product-detail\">\r\n          <div>\r\n            <strong>หมวดหมู่:</strong> {p.category_name}\r\n          </div>\r\n          <div>\r\n            <strong>ราคา:</strong> {p.price}฿\r\n          </div>\r\n          <div>\r\n            <strong>สถานะ:</strong> {pickStatusName(p.status)}\r\n          </div>\r\n          <div>\r\n            <strong>รายละเอียด:</strong>{\" \"}\r\n            {p.description || \"ไม่มีรายละเอียด\"}\r\n          </div>\r\n        </div>\r\n\r\n        {/* ────────────── Variant Manager ────────────── */}\r\n        {renderVariantManager()}\r\n        {/* ────────────── Action Buttons ────────────── */}\r\n        {renderBottomActions()}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  /* =========================\r\n     Main Render\r\n  ========================= */\r\n  return (\r\n    <div className=\"product-page\">\r\n      <h2>จัดการสินค้า (Full Mode)</h2>\r\n\r\n      {/* Search & Add */}\r\n      <div className=\"toolbar\">\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"🔍 ค้นหาสินค้า...\"\r\n          value={search}\r\n          onChange={(e) => setSearch(e.target.value)}\r\n        />\r\n        <button\r\n          className=\"btn-add\"\r\n          onClick={handleAddProduct}\r\n          disabled={addingProduct}\r\n        >\r\n          ➕ เพิ่มสินค้าใหม่\r\n        </button>\r\n      </div>\r\n\r\n      {/* Add Product Form */}\r\n      <div className=\"new-product-form\">\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"ชื่อสินค้า\"\r\n          value={newProduct.product_name}\r\n          onChange={(e) =>\r\n            setNewProduct({ ...newProduct, product_name: e.target.value })\r\n          }\r\n        />\r\n        <select\r\n          value={newProduct.category_id}\r\n          onChange={(e) =>\r\n            setNewProduct({ ...newProduct, category_id: e.target.value })\r\n          }\r\n        >\r\n          <option value=\"\">เลือกหมวดหมู่</option>\r\n          {categories.map((c) => (\r\n            <option key={c.id} value={c.id}>\r\n              {c.name}\r\n            </option>\r\n          ))}\r\n        </select>\r\n        <input\r\n          type=\"number\"\r\n          placeholder=\"ราคา (฿)\"\r\n          value={newProduct.price}\r\n          onChange={(e) =>\r\n            setNewProduct({ ...newProduct, price: e.target.value })\r\n          }\r\n        />\r\n        <select\r\n          value={newProduct.unit_id}\r\n          onChange={(e) =>\r\n            setNewProduct({ ...newProduct, unit_id: e.target.value })\r\n          }\r\n        >\r\n          <option value=\"\">เลือกหน่วย</option>\r\n          {units.map((u) => (\r\n            <option key={u.id} value={u.id}>\r\n              {u.name}\r\n            </option>\r\n          ))}\r\n        </select>\r\n        <textarea\r\n          placeholder=\"รายละเอียดสินค้า\"\r\n          value={newProduct.description}\r\n          onChange={(e) =>\r\n            setNewProduct({ ...newProduct, description: e.target.value })\r\n          }\r\n        ></textarea>\r\n      </div>\r\n\r\n      {/* Table */}\r\n      {loading ? <p>กำลังโหลดสินค้า...</p> : renderTable()}\r\n\r\n      {/* Panel */}\r\n      {renderPanel()}\r\n\r\n      {/* Toasts */}\r\n      {Toasts}\r\n    </div>\r\n  );\r\n}\r\n/* === ProductManagement.js (Part 2/4) END === */\r\n/* === ProductManagement.js (Part 3/4) START === */\r\n\r\n/* =========================\r\n   VARIANT MANAGER (3 levels)\r\n   - Options (up to 3): e.g., สี / ขนาด / วัสดุ\r\n   - Values per option\r\n   - Auto-generate combinations\r\n   - Per-variant: SKU, price, stock, images, delete\r\n========================= */\r\n\r\n// ---- Local helpers for variants ----\r\nconst normalizeOptionName = (s) => asStr(s).trim();\r\nconst normalizeValue = (s) => asStr(s).trim();\r\n\r\nfunction cartesianProduct(arrays) {\r\n  // arrays: [ [a,b], [c,d], [e] ] → [[a,c,e],[a,d,e],[b,c,e],[b,d,e]]\r\n  if (!arrays.length) return [];\r\n  return arrays.reduce(\r\n    (acc, cur) =>\r\n      acc\r\n        .map((x) => cur.map((y) => x.concat([y])))\r\n        .reduce((a, b) => a.concat(b), []),\r\n    [[]]\r\n  );\r\n}\r\n\r\nfunction makeTempId() {\r\n  return \"tmp_\" + Math.random().toString(36).slice(2, 10);\r\n}\r\n\r\n// ---- State & loaders for variant manager ----\r\nconst [variantLoading, setVariantLoading] = useState(false);\r\nconst [savingVariants, setSavingVariants] = useState(false);\r\nconst [imageInputMap] = useState({}); // refs-in-object for per-row file inputs\r\n\r\n// options = [ { name:'สี', values:['เขียว','ดำ'] }, { name:'ขนาด', values:['S','M'] }, ... ]\r\nconst maxOptions = 3;\r\n\r\n// ---- Add/Remove Option Rows ----\r\nconst addOption = () => {\r\n  if (options.length >= maxOptions) {\r\n    addToast(\"รองรับสูงสุด 3 ตัวเลือก\", \"warn\");\r\n    return;\r\n  }\r\n  setOptions((prev) => [...prev, { name: \"\", values: [] }]);\r\n};\r\n\r\nconst removeOption = (idx) => {\r\n  setOptions((prev) => prev.filter((_, i) => i !== idx));\r\n};\r\n\r\nconst updateOptionName = (idx, name) => {\r\n  setOptions((prev) => prev.map((o, i) => (i === idx ? { ...o, name } : o)));\r\n};\r\n\r\nconst addOptionValue = (idx, value) => {\r\n  const v = normalizeValue(value);\r\n  if (!v) return;\r\n  setOptions((prev) =>\r\n    prev.map((o, i) =>\r\n      i === idx\r\n        ? { ...o, values: Array.from(new Set([...(o.values || []), v])) }\r\n        : o\r\n    )\r\n  );\r\n};\r\n\r\nconst removeOptionValue = (idx, value) => {\r\n  setOptions((prev) =>\r\n    prev.map((o, i) =>\r\n      i === idx ? { ...o, values: (o.values || []).filter((x) => x !== value) } : o\r\n    )\r\n  );\r\n};\r\n\r\n// ---- Generate Variant rows (combinations) ----\r\nconst generateCombinations = () => {\r\n  const valid = options\r\n    .map((o) => ({\r\n      name: normalizeOptionName(o.name),\r\n      values: (o.values || []).map((v) => normalizeValue(v)).filter(Boolean),\r\n    }))\r\n    .filter((o) => o.name && o.values.length);\r\n\r\n  if (valid.length === 0) {\r\n    addToast(\"กรุณาเพิ่มตัวเลือกและค่าอย่างน้อย 1 ชุด\", \"warn\");\r\n    return;\r\n  }\r\n\r\n  const arrays = valid.map((o) => o.values);\r\n  const combos = cartesianProduct(arrays);\r\n\r\n  // map combo → key & row\r\n  const makeKey = (combo) => combo.join(\"||\").toLowerCase();\r\n\r\n  // keep existing edits (price/stock/sku/images) if same combo appears\r\n  const existingMap = new Map(\r\n    (variants || []).map((v) => [makeKey([v.opt1, v.opt2, v.opt3].filter(Boolean)), v])\r\n  );\r\n\r\n  const next = combos.map((combo) => {\r\n    const [c1, c2, c3] = combo;\r\n    const k = makeKey(combo);\r\n    const ex = existingMap.get(k);\r\n    return (\r\n      ex || {\r\n        temp_id: makeTempId(),\r\n        product_id: selectedProduct?.product_id,\r\n        opt1: c1 ?? null,\r\n        opt2: c2 ?? null,\r\n        opt3: c3 ?? null,\r\n        sku: \"\",\r\n        price: \"\",\r\n        stock: \"\",\r\n        images: [], // [{image_id, url, alt_text}]\r\n        is_published: true,\r\n      }\r\n    );\r\n  });\r\n\r\n  setVariants(next);\r\n  addToast(\"สร้างรายการตัวเลือกอัตโนมัติแล้ว\", \"ok\");\r\n};\r\n\r\n// ---- Save all variants (upsert) ----\r\nconst saveAllVariants = async () => {\r\n  if (!selectedProduct?.product_id) {\r\n    addToast(\"กรุณาเลือกสินค้าก่อน\", \"warn\");\r\n    return;\r\n  }\r\n  if (!variants.length) {\r\n    addToast(\"ไม่มีรายการตัวเลือกให้บันทึก\", \"warn\");\r\n    return;\r\n  }\r\n  setSavingVariants(true);\r\n  try {\r\n    // upsert one-by-one to be robust with most APIs\r\n    for (const v of variants) {\r\n      const body = {\r\n        product_id: selectedProduct.product_id,\r\n        options: [v.opt1, v.opt2, v.opt3].filter(Boolean),\r\n        sku: asStr(v.sku),\r\n        price: toNum(v.price) ?? 0,\r\n        stock: toInt(v.stock) ?? 0,\r\n        published: !!v.is_published,\r\n      };\r\n      await api.post(path(\"variants/upsert-single\"), body);\r\n    }\r\n    addToast(\"บันทึกตัวเลือกสำเร็จ\", \"ok\");\r\n    // Optionally, reload from backend if you want fresh IDs\r\n  } catch (err) {\r\n    console.error(err);\r\n    addToast(\"บันทึกตัวเลือกไม่สำเร็จ\", \"error\");\r\n  } finally {\r\n    setSavingVariants(false);\r\n  }\r\n};\r\n\r\n// ---- Delete single variant ----\r\nconst handleDeleteVariant = async (variantIdOrTemp) => {\r\n  // if no real id → just remove from state\r\n  const isTemp = String(variantIdOrTemp || \"\").startsWith(\"tmp_\");\r\n  if (isTemp || !variantIdOrTemp) {\r\n    setVariants((prev) => prev.filter((x) => x.temp_id !== variantIdOrTemp));\r\n    addToast(\"ลบตัวเลือกออกแล้ว\", \"ok\");\r\n    return;\r\n  }\r\n  if (!window.confirm(\"คุณต้องการลบตัวเลือกนี้จริงหรือไม่?\")) return;\r\n  try {\r\n    await api.delete(path(`variants/${variantIdOrTemp}`));\r\n    setVariants((prev) => prev.filter((x) => x.variant_id !== variantIdOrTemp));\r\n    addToast(\"ลบตัวเลือกเรียบร้อย\", \"ok\");\r\n  } catch (err) {\r\n    console.error(err);\r\n    addToast(\"ลบตัวเลือกไม่สำเร็จ\", \"error\");\r\n  }\r\n};\r\n\r\n// ---- Image: upload / remove per variant ----\r\nconst uploadVariantImage = async (v, file) => {\r\n  if (!file || !selectedProduct?.product_id) return;\r\n  try {\r\n    const fd = new FormData();\r\n    fd.append(\"file\", file);\r\n    fd.append(\"product_id\", selectedProduct.product_id);\r\n    if (v?.variant_id) fd.append(\"variant_id\", v.variant_id);\r\n\r\n    // You can adjust this path to your productImages route\r\n    const res = await api.upload(path(\"product-images/upload\"), fd);\r\n    const img = {\r\n      image_id: res?.image_id || makeTempId(),\r\n      url: res?.url || res?.image_url,\r\n      alt_text: res?.alt_text || null,\r\n      variant_id: v?.variant_id ?? null,\r\n    };\r\n    setVariants((prev) =>\r\n      prev.map((row) =>\r\n        row === v\r\n          ? { ...row, images: [...(row.images || []), img] }\r\n          : row\r\n      )\r\n    );\r\n    addToast(\"อัปโหลดรูปสำเร็จ\", \"ok\");\r\n  } catch (err) {\r\n    console.error(err);\r\n    addToast(\"อัปโหลดรูปไม่สำเร็จ\", \"error\");\r\n  }\r\n};\r\n\r\nconst removeVariantImage = async (v, image) => {\r\n  try {\r\n    if (image?.image_id && !String(image.image_id).startsWith(\"tmp_\")) {\r\n      await api.delete(path(`product-images/${image.image_id}`));\r\n    }\r\n    setVariants((prev) =>\r\n      prev.map((row) =>\r\n        row === v\r\n          ? { ...row, images: (row.images || []).filter((im) => im !== image) }\r\n          : row\r\n      )\r\n    );\r\n    addToast(\"ลบรูปแล้ว\", \"ok\");\r\n  } catch (err) {\r\n    console.error(err);\r\n    addToast(\"ลบรูปไม่สำเร็จ\", \"error\");\r\n  }\r\n};\r\n\r\n// ---- Renderers: Options form & Variant table ----\r\nconst OptionRow = ({ idx, data }) => {\r\n  const [valueInput, setValueInput] = useState(\"\");\r\n  return (\r\n    <div className=\"option-row\">\r\n      <input\r\n        className=\"input\"\r\n        placeholder={`ชื่อตัวเลือกที่ ${idx + 1} (เช่น สี / ขนาด / วัสดุ)`}\r\n        value={data.name}\r\n        onChange={(e) => updateOptionName(idx, e.target.value)}\r\n      />\r\n      <div className=\"values\">\r\n        {(data.values || []).map((val) => (\r\n          <span key={val} className=\"chip\">\r\n            {val}\r\n            <button\r\n              className=\"chip-x\"\r\n              onClick={() => removeOptionValue(idx, val)}\r\n              title=\"ลบค่านี้\"\r\n            >\r\n              ×\r\n            </button>\r\n          </span>\r\n        ))}\r\n        <input\r\n          className=\"input small\"\r\n          placeholder=\"เพิ่มค่าใหม่ (Enter)\"\r\n          value={valueInput}\r\n          onChange={(e) => setValueInput(e.target.value)}\r\n          onKeyDown={(e) => {\r\n            if (e.key === \"Enter\") {\r\n              addOptionValue(idx, valueInput);\r\n              setValueInput(\"\");\r\n            }\r\n          }}\r\n        />\r\n      </div>\r\n      <button className=\"btn-ghost\" onClick={() => removeOption(idx)}>\r\n        ลบตัวเลือก\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst renderOptionsEditor = () => (\r\n  <div className=\"variant-options\">\r\n    <div className=\"section-title\">ตัวเลือกสินค้า (สูงสุด 3 ตัวเลือก)</div>\r\n    {options.map((o, i) => (\r\n      <OptionRow key={i} idx={i} data={o} />\r\n    ))}\r\n    <div className=\"option-actions\">\r\n      <button className=\"btn-green\" onClick={addOption}>\r\n        ➕ เพิ่มตัวเลือกสินค้า\r\n      </button>\r\n      <button className=\"btn-primary\" onClick={generateCombinations}>\r\n        ⚙️ สร้างรายการตัวเลือกอัตโนมัติ\r\n      </button>\r\n    </div>\r\n  </div>\r\n);\r\n\r\nconst VariantRow = ({ v }) => {\r\n  const fileRef = useRef(null);\r\n  return (\r\n    <tr>\r\n      <td>{v.opt1 || \"-\"}</td>\r\n      <td>{v.opt2 || \"-\"}</td>\r\n      <td>{v.opt3 || \"-\"}</td>\r\n      <td>\r\n        <input\r\n          className=\"input small\"\r\n          placeholder=\"SKU\"\r\n          value={v.sku || \"\"}\r\n          onChange={(e) =>\r\n            setVariants((prev) =>\r\n              prev.map((x) => (x === v ? { ...x, sku: e.target.value } : x))\r\n            )\r\n          }\r\n        />\r\n      </td>\r\n      <td>\r\n        <input\r\n          type=\"number\"\r\n          className=\"input small\"\r\n          placeholder=\"ราคา\"\r\n          value={v.price ?? \"\"}\r\n          onChange={(e) =>\r\n            setVariants((prev) =>\r\n              prev.map((x) => (x === v ? { ...x, price: e.target.value } : x))\r\n            )\r\n          }\r\n        />\r\n      </td>\r\n      <td>\r\n        <input\r\n          type=\"number\"\r\n          className=\"input small\"\r\n          placeholder=\"สต็อก\"\r\n          value={v.stock ?? \"\"}\r\n          onChange={(e) =>\r\n            setVariants((prev) =>\r\n              prev.map((x) => (x === v ? { ...x, stock: e.target.value } : x))\r\n            )\r\n          }\r\n        />\r\n      </td>\r\n      <td className=\"v-images\">\r\n        <div className=\"images\">\r\n          {(v.images || []).map((im) => (\r\n            <div className=\"img\" key={im.image_id || im.url}>\r\n              <img src={im.url} alt={im.alt_text || \"\"} />\r\n              <button\r\n                className=\"img-x\"\r\n                onClick={() => removeVariantImage(v, im)}\r\n                title=\"ลบรูปนี้\"\r\n              >\r\n                ×\r\n              </button>\r\n            </div>\r\n          ))}\r\n        </div>\r\n        <button\r\n          className=\"btn-ghost\"\r\n          onClick={() => fileRef.current?.click()}\r\n        >\r\n          📸 เพิ่มรูป\r\n        </button>\r\n        <input\r\n          type=\"file\"\r\n          accept=\"image/*\"\r\n          ref={fileRef}\r\n          style={{ display: \"none\" }}\r\n          onChange={(e) => {\r\n            const f = e.target.files?.[0];\r\n            if (f) uploadVariantImage(v, f);\r\n            e.target.value = \"\";\r\n          }}\r\n        />\r\n      </td>\r\n      <td>\r\n        <button\r\n          className=\"btn-delete\"\r\n          onClick={() =>\r\n            handleDeleteVariant(v.variant_id || v.temp_id)\r\n          }\r\n        >\r\n          🗑️ ลบ\r\n        </button>\r\n      </td>\r\n    </tr>\r\n  );\r\n};\r\n\r\nconst renderVariantTable = () => (\r\n  <div className=\"variant-table-wrap\">\r\n    <table className=\"variant-table\">\r\n      <thead>\r\n        <tr>\r\n          <th>ตัวเลือก 1</th>\r\n          <th>ตัวเลือก 2</th>\r\n          <th>ตัวเลือก 3</th>\r\n          <th>SKU</th>\r\n          <th>ราคา</th>\r\n          <th>สต็อก</th>\r\n          <th>📸 รูป</th>\r\n          <th>ลบ</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        {variants.length ? (\r\n          variants.map((v) => (\r\n            <VariantRow key={v.variant_id || v.temp_id} v={v} />\r\n          ))\r\n        ) : (\r\n          <tr>\r\n            <td colSpan={8} className=\"muted\">\r\n              ยังไม่มีรายการตัวเลือก\r\n            </td>\r\n          </tr>\r\n        )}\r\n      </tbody>\r\n    </table>\r\n\r\n    <div className=\"variant-save\">\r\n      <button\r\n        className=\"btn-primary lg\"\r\n        disabled={!variants.length || savingVariants}\r\n        onClick={saveAllVariants}\r\n      >\r\n        💾 บันทึกตัวเลือกทั้งหมด\r\n      </button>\r\n    </div>\r\n  </div>\r\n);\r\n\r\n// ---- Entrypoint renderer for Variant Manager block ----\r\nconst renderVariantManager = () => {\r\n  if (!selectedProduct) return null;\r\n  return (\r\n    <div className=\"variant-manager\">\r\n      <div className=\"section-head\">\r\n        <h4>จัดการตัวเลือกสินค้า</h4>\r\n        <div className=\"hint\">\r\n          รองรับสูงสุด 3 ตัวเลือก (เช่น สี / ขนาด / วัสดุ)\r\n        </div>\r\n      </div>\r\n      {renderOptionsEditor()}\r\n      {renderVariantTable()}\r\n    </div>\r\n  );\r\n};\r\n/* === ProductManagement.js (Part 3/4) END === */\r\n/* === ProductManagement.js (Part 4/4) START === */\r\n\r\n/* =========================\r\n   Bottom Actions (publish / archive / unarchive)\r\n========================= */\r\n\r\n// generic route try\r\nasync function tryRoutes(method, routes, body) {\r\n  let lastErr;\r\n  for (const r of routes) {\r\n    try {\r\n      const res = await api[method](r, body);\r\n      if (res && (res.ok || res.success || res.id || res.product_id)) return res;\r\n      if (res && res.data !== undefined) return res;\r\n    } catch (e) { lastErr = e; }\r\n  }\r\n  if (lastErr) throw lastErr;\r\n  throw new Error(\"No route matched\");\r\n}\r\n\r\nfunction updateProductLocal(setter, id, patch) {\r\n  setter((prev) =>\r\n    prev.map((p) =>\r\n      String(p.product_id ?? p.id) === String(id) ? { ...p, ...patch } : p\r\n    )\r\n  );\r\n}\r\n\r\nasync function togglePublish(productId, nextPublished, { setProducts, toast }) {\r\n  try {\r\n    updateProductLocal(setProducts, productId, { is_published: !!nextPublished });\r\n    await tryRoutes(\"patch\", [path(`admin/products/${productId}/publish`), path(`admin/products/${productId}`)], {\r\n      is_published: !!nextPublished,\r\n      published: !!nextPublished,\r\n    });\r\n    toast(nextPublished ? \"เผยแพร่สินค้าแล้ว\" : \"ปิดการขายแล้ว\");\r\n  } catch (e) {\r\n    updateProductLocal(setProducts, productId, { is_published: !nextPublished });\r\n    toast(\"อัปเดตสถานะไม่สำเร็จ\", \"error\");\r\n    console.error(e);\r\n  }\r\n}\r\n\r\nasync function archiveProduct(productId, { setProducts, toast }) {\r\n  try {\r\n    updateProductLocal(setProducts, productId, { is_archived: true });\r\n    await tryRoutes(\"patch\", [path(`admin/products/${productId}/archive`), path(`admin/products/${productId}`)], {\r\n      is_archived: true,\r\n      archived: true,\r\n      status: \"archived\",\r\n    });\r\n    toast(\"เก็บสินค้าเข้าคลังแล้ว\");\r\n  } catch (e) {\r\n    updateProductLocal(setProducts, productId, { is_archived: false });\r\n    toast(\"เก็บเข้าคลังไม่สำเร็จ\", \"error\");\r\n    console.error(e);\r\n  }\r\n}\r\n\r\nasync function unarchiveProduct(productId, { setProducts, toast }) {\r\n  try {\r\n    updateProductLocal(setProducts, productId, { is_archived: false });\r\n    await tryRoutes(\"patch\", [path(`admin/products/${productId}/unarchive`), path(`admin/products/${productId}`)], {\r\n      is_archived: false,\r\n      archived: false,\r\n      status: \"active\",\r\n    });\r\n    toast(\"คืนสินค้าจากคลังแล้ว\");\r\n  } catch (e) {\r\n    updateProductLocal(setProducts, productId, { is_archived: true });\r\n    toast(\"คืนจากคลังไม่สำเร็จ\", \"error\");\r\n    console.error(e);\r\n  }\r\n}\r\n\r\nconst renderBottomActions = () => {\r\n  if (!selectedProduct) return null;\r\n  const pid = selectedProduct.product_id;\r\n  const published = !!selectedProduct.is_published;\r\n  const archived = !!selectedProduct.is_archived;\r\n\r\n  return (\r\n    <div className=\"bottom-actions\">\r\n      <button\r\n        className={published ? \"btn-outline\" : \"btn-green\"}\r\n        onClick={() =>\r\n          togglePublish(pid, !published, { setProducts, toast: addToast })\r\n        }\r\n      >\r\n        {published ? \"ปิดการขาย\" : \"เผยแพร่สินค้า\"}\r\n      </button>\r\n\r\n      {!archived ? (\r\n        <button\r\n          className=\"btn-outline\"\r\n          onClick={() => archiveProduct(pid, { setProducts, toast: addToast })}\r\n        >\r\n          📦 เก็บเข้าคลัง\r\n        </button>\r\n      ) : (\r\n        <button\r\n          className=\"btn-outline\"\r\n          onClick={() =>\r\n            unarchiveProduct(pid, { setProducts, toast: addToast })\r\n          }\r\n        >\r\n          ♻️ คืนจากคลัง\r\n        </button>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\n/* === ProductManagement.js (Part 4/4) END === */\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}